!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Bronze",[],e):"object"==typeof exports?exports.Bronze=e():t.Bronze=e()}(window,function(){return function(i){var n={};function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=i,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/dist",o(o.s=0)}([function(t,e,i){"use strict";function s(t,e,i){var n,o=t;if("fragment"==e)n=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!=e)return console.log("Wrong shader type"),null;n=i.createShader(i.VERTEX_SHADER)}if(i.shaderSource(n,o),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw"Could not compile shader:"+i.getShaderInfoLog(n);return n}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function u(t){var n="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,i)}function i(){return o(t,arguments,h(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),l(i,t)})(t)}function o(t,e,i){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return i&&l(o,i.prototype),o}).apply(null,arguments)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.r(e);var c=function(t){function o(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=a(this,h(o).call(this))).src=t,null!=e&&null!=i&&(n.width=e,n.height=i),n.coords=[],n.addEventListener("load",function(){n.loaded=!0}),n.color=new Uint8Array([255,255,255,255]),n._textureBlockLocation=null,n}var e,i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(o,u(Image)),e=o,(i=[{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,n){this.color=new Uint8Array([t,e,i,n])}}])&&r(e.prototype,i),n&&r(e,n),o}();function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e,i){return e&&b(t.prototype,e),i&&b(t,i),t}var y=function(){function t(){return f(this,t),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return m(t,[{key:"perspective",value:function(t,e,i,n,o){var r=Math.tan(.5*Math.PI-.5*t),a=1/(n-o);return this.matrix=[r/(e/i),0,0,0,0,r,0,0,0,0,(n+o)*a,-1,0,0,n*o*a*2,0],this}},{key:"multiply",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],o=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],p=this.matrix[15],w=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],_=t[6],G=t[7],R=t[8],T=t[9],A=t[10],k=t[11],E=t[12],P=t[13],F=t[14],B=t[15];this.matrix=[w*e+y*r+d*l+L*b,w*i+y*a+d*h+L*m,w*n+y*s+d*c+L*v,w*o+y*u+d*f+L*p,x*e+g*r+_*l+G*b,x*i+g*a+_*h+G*m,x*n+g*s+_*c+G*v,x*o+g*u+_*f+G*p,R*e+T*r+A*l+k*b,R*i+T*a+A*h+k*m,R*n+T*s+A*c+k*v,R*o+T*u+A*f+k*p,E*e+P*r+F*l+B*b,E*i+P*a+F*h+B*m,E*n+P*s+F*c+B*v,E*o+P*u+F*f+B*p]}},{key:"multiply_",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],o=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],p=this.matrix[15],w=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],_=t[6],G=t[7],R=t[8],T=t[9],A=t[10],k=t[11],E=t[12],P=t[13],F=t[14],B=t[15];return[w*e+y*r+d*l+L*b,w*i+y*a+d*h+L*m,w*n+y*s+d*c+L*v,w*o+y*u+d*f+L*p,x*e+g*r+_*l+G*b,x*i+g*a+_*h+G*m,x*n+g*s+_*c+G*v,x*o+g*u+_*f+G*p,R*e+T*r+A*l+k*b,R*i+T*a+A*h+k*m,R*n+T*s+A*c+k*v,R*o+T*u+A*f+k*p,E*e+P*r+F*l+B*b,E*i+P*a+F*h+B*m,E*n+P*s+F*c+B*v,E*o+P*u+F*f+B*p]}},{key:"translate",value:function(t,e,i){this.multiply(d.translation(t,e,i))}},{key:"translate_",value:function(t,e,i){return this.multiply_(d.translation(t,e,i))}},{key:"rotateX",value:function(t){this.multiply(d.rotationX(t))}},{key:"rotateY",value:function(t){this.multiply(d.rotationY(t))}},{key:"rotateZ",value:function(t){this.multiply(d.rotationZ(t))}},{key:"scale",value:function(t,e,i){this.multiply(d.scaling(t,e,i))}}]),t}(),d=new(function(){function t(){f(this,t)}return m(t,[{key:"unit",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"translation",value:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}},{key:"rotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}},{key:"rotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}},{key:"rotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}},{key:"scaling",value:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}},{key:"multiply",value:function(t,e){var i=t[0],n=t[1],o=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],p=t[14],w=t[15],y=e[0],d=e[1],L=e[2],x=e[3],g=e[4],_=e[5],G=e[6],R=e[7],T=e[8],A=e[9],k=e[10],E=e[11],P=e[12],F=e[13],B=e[14],C=e[15];return[y*i+d*a+L*h+x*m,y*n+d*s+L*c+x*v,y*o+d*u+L*f+x*p,y*r+d*l+L*b+x*w,g*i+_*a+G*h+R*m,g*n+_*s+G*c+R*v,g*o+_*u+G*f+R*p,g*r+_*l+G*b+R*w,T*i+A*a+k*h+E*m,T*n+A*s+k*c+E*v,T*o+A*u+k*f+E*p,T*r+A*l+k*b+E*w,P*i+F*a+B*h+C*m,P*n+F*s+B*c+C*v,P*o+F*u+B*f+C*p,P*r+F*l+B*b+C*w]}},{key:"vec3Multiply",value:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}},{key:"transformVector",value:function(t,e){for(var i=new Float32Array(4),n=0;n<4;++n)for(var o=i[n]=0;o<4;++o)i[n]+=e[o]*t[4*o+n];return i}},{key:"inverse",value:function(t){var e=new Float32Array(16),i=t[0],n=t[1],o=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],p=t[14],w=t[15],y=f*w,d=p*b,L=u*w,x=p*l,g=u*b,_=f*l,G=o*w,R=p*r,T=o*b,A=f*r,k=o*l,E=u*r,P=h*v,F=m*c,B=a*v,C=m*s,O=a*c,U=h*s,M=i*v,j=m*n,D=i*c,S=h*n,I=i*s,X=a*n,Y=y*s+x*c+g*v-(d*s+L*c+_*v),N=d*n+G*c+A*v-(y*n+R*c+T*v),V=L*n+R*s+k*v-(x*n+G*s+E*v),W=_*n+T*s+E*c-(g*n+A*s+k*c),z=1/(i*Y+a*N+h*V+m*W);return e[0]=z*Y,e[1]=z*N,e[2]=z*V,e[3]=z*W,e[4]=z*(d*a+L*h+_*m-(y*a+x*h+g*m)),e[5]=z*(y*i+R*h+T*m-(d*i+G*h+A*m)),e[6]=z*(x*i+G*a+E*m-(L*i+R*a+k*m)),e[7]=z*(g*i+A*a+k*h-(_*i+T*a+E*h)),e[8]=z*(P*l+C*b+O*w-(F*l+B*b+U*w)),e[9]=z*(F*r+M*b+S*w-(P*r+j*b+D*w)),e[10]=z*(B*r+j*l+I*w-(C*r+M*l+X*w)),e[11]=z*(U*r+D*l+X*b-(O*r+S*l+I*b)),e[12]=z*(B*f+U*p+F*u-(O*p+P*u+C*f)),e[13]=z*(D*p+P*o+j*f-(M*f+S*p+F*o)),e[14]=z*(M*u+X*p+C*o-(I*p+B*o+j*u)),e[15]=z*(I*f+O*o+S*u-(D*u+X*f+U*o)),e}}]),t}());function v(t){return t*Math.PI/180}function p(t){return 0==(t&t-1)}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var L=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.objects.push(this),this.webGL=t.webGL,this.camera=t.camera,this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.faces=[],this.collisionBoxes=[]}var t,i,n;return t=e,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"moveRelativeToTheCamera",value:function(t,e,i){var n=[t,e,i,1];n=d.vec3Multiply(this.camera.inventedMatrix,n),this.position[0]+=n[0],this.position[1]+=n[1],this.position[2]+=n[2]}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"compile",value:function(t){var c=this,f=[],b=[],m=[],e=t.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};e.forEach(function(t){for(var h=t.split(" "),e=h.length;e--;)""!=h[e]&&"\r"!=h[e]||h.splice(e,1);if("v"==h[0]){var i=parseFloat(h[1]),n=parseFloat(h[2]),o=parseFloat(h[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<n&&(s.y[1]=n),s.z[1]<o&&(s.z[1]=o),s.x[0]>i&&(s.x[0]=i),s.y[0]>n&&(s.y[0]=n),s.z[0]>o&&(s.z[0]=o),f.push([i,n,o])}else if("vn"==h[0])m.push([parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])]);else if("vt"==h[0])b.push([parseFloat(h[1]),parseFloat(h[2])]);else if("f"==h[0])for(var r=function(t){var e=h[t].split("/");if("\r"==e[length-1])return"break";for(var i=null,n=null,o=void 0,r=0;r<c.faces.length;r++){var a=c.faces[r];a.vertexesCount==h.length-1&&(i=a.vertexes,n=a.textureCoords,o=a.normals)}null==i&&(c.faces.push({vertexesCount:h.length-1,vertexes:[],textureCoords:[],normals:[]}),i=c.faces[c.faces.length-1].vertexes,n=c.faces[c.faces.length-1].textureCoords,o=c.faces[c.faces.length-1].normals);var s=parseFloat(e[0]);s<0&&(s=f.length+s+1);var u=parseFloat(e[1]);u<0&&(u=b.length+u+1);var l=parseFloat(e[2]);l<0&&(l=m.length+l+1),f[s-1].forEach(function(t){i.push(t)}),0<b.length&&b[u-1].forEach(function(t){n.push(t)}),null!=e[2]?m[l-1].forEach(function(t){o.push(t)}):o.push(0,0,0)},a=1;a<h.length;a++){if("break"===r(a))break}});for(var i=0;i<this.faces.length;i++){var n=this.faces[i];n.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.vertexes),this.webGL.STATIC_DRAW),n.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.textureCoords),this.webGL.STATIC_DRAW),n.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.normals),this.webGL.STATIC_DRAW)}this.collisionBoxes.push(s)}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&e.compile(i.responseText)},i.send()}}])&&w(t.prototype,i),n&&w(t,n),e}();function x(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var g=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.engine=t,this.objects=[],this.lands=[],this.camera}var t,i,n;return t=e,(i=[{key:"createObject",value:function(){var t=new L(engine);return this.engine.objects.push(t),t}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"removeObject",value:function(t){var e=this.objects.indexOf(t);return-1!=e&&(this.objects.splice(e,1),!0)}},{key:"removeObjectByName",value:function(e){var i=this;return this.objects.forEach(function(t){if(t.name==e)return i.removeObject(t),!0}),!1}}])&&x(t.prototype,i),n&&x(t,n),e}();function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var G,R=function(){function n(t){var e,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.webGL=(i=(e=t).getContext("experimental-webgl"),window.addEventListener("resize",function(){e.width=e.offsetWidth,e.height=e.offsetHeight}),i),this.canvas=t,this.width=t.width,this.height=t.height,this.polygons=[],this.objects=[],this.textures=[],this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._globalPositionBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalPositionBuffer),this._globalTextureBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalTextureBuffer),this._initShaders(),this.noTexture=new c,this.noTexture.setColorRGBA(219,58,52,255),this.bindTexture(this.noTexture)}var t,e,i;return t=n,(e=[{key:"_initShaders",value:function(){var t,e,i,n,o,r=s("attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition; // - surfaceWorldPosition;\r\n}","vertex",this.webGL),a=s("precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    // float light = dot(normal, u_reverseLightDirection);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < 0.2)\r\n        discard;\r\n}","fragment",this.webGL);this.shaderProgram=(t=this.webGL,e=r,i=a,n=!1,o=t.createProgram(),t.attachShader(o,e),t.attachShader(o,i),t.linkProgram(o),t.useProgram(o),n&&(t.deleteShader(e),t.deleteShader(i)),o),this.positionLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_position"),this.textureCoordinatesLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_texcoord"),this.textureLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_texture"),this.matrixLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_matrix"),this.objectRotationLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_objectRotation"),this.normalLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_normal"),this.reverseLightDirectionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_reverseLightDirection"),this.lightWorldPositionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_lightWorldPosition"),this.cameraLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_cameraMatrix"),this.webGL.useProgram(this.shaderProgram),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST)}},{key:"setCamera",value:function(t){this.camera=t}},{key:"canvasResized",value:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.webGL.viewport(0,0,this.width,this.height)}},{key:"bindTexture",value:function(t){var e=this;t._textureBlockLocation=this.textures.length,this.textures.push(t),t._WebGLtexture=this.webGL.createTexture(),this.webGL.activeTexture(this.webGL.TEXTURE0+t._textureBlockLocation),this.webGL.bindTexture(this.webGL.TEXTURE_2D,t._WebGLtexture),t.loaded?(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t),this.webGL.generateMipmap(this.webGL.TEXTURE_2D),p(image.width)&&p(image.height)?this.webGL.generateMipmap(this.webGL.TEXTURE_2D):(this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_S,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_T,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR))):(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,1,1,0,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t.color),t.addEventListener("load",function(){e.webGL.activeTexture(e.webGL.TEXTURE0+t._textureBlockLocation),e.webGL.texImage2D(e.webGL.TEXTURE_2D,0,e.webGL.RGBA,e.webGL.RGBA,e.webGL.UNSIGNED_BYTE,t),p(t.width)&&p(t.height)?e.webGL.generateMipmap(e.webGL.TEXTURE_2D):(e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_S,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_T,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_MIN_FILTER,e.webGL.LINEAR))}))}},{key:"_update",value:function(){var v,e,i,n,p=this;null!=this.camera._controlFunction&&this.camera._controlFunction(),this.selectedObject=null,this.polygons.forEach(function(t){(v=new y).perspective(p.camera.fieldOfViewRad,p.width,p.height,1,2e4),v.multiply(p.camera.inventedMatrix),(n=new y).multiply(d.inverse(d.translation(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]))),n.translate(t.position[0],t.position[1],t.position[2]),e=d.multiply(d.rotationX(t.rotation[0]),d.rotationY(t.rotation[1])),e=d.multiply(e,d.rotationZ(t.rotation[2])),null!=t.parentRotation&&(i=d.multiply(d.rotationX(t.parentRotation[0]),d.rotationY(t.parentRotation[1])),i=d.multiply(i,d.rotationZ(t.parentRotation[2])),t._world=i,e=d.multiply(i,e)),n.multiply(e),n.translate(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]),n.scale(1,1,1),v.multiply(n.matrix),t._matrix=v.matrix,t._rotationMatrix=e});var w=null;this.objects.forEach(function(b){(v=new y).perspective(p.camera.fieldOfViewRad,p.width,p.height,1,2e4),v.multiply(p.camera.inventedMatrix),(n=new y).multiply(d.inverse(d.translation(b.rotationPoint[0],b.rotationPoint[1],b.rotationPoint[2]))),n.translate(b.position[0],b.position[1],b.position[2]),e=d.multiply(d.rotationX(b.rotation[0]),d.rotationY(b.rotation[1])),e=d.multiply(e,d.rotationZ(b.rotation[2])),i=d.multiply(d.rotationX(b.parentRotation[0]),d.rotationY(b.parentRotation[1])),i=d.multiply(i,d.rotationZ(b.parentRotation[2])),b._world=i,e=d.multiply(i,e),n.multiply(e),n.translate(b.rotationPoint[0],b.rotationPoint[1],b.rotationPoint[2]),n.scale(b.scaling[0],b.scaling[1],b.scaling[2]),v.multiply(n.matrix);var m=!1;b.collisionBoxes.forEach(function(t){for(var e=[],i=0;i<t.x.length;i++)for(var n=t.x[i],o=0;o<t.y.length;o++)for(var r=t.y[o],a=0;a<t.z.length;a++){var s=t.z[a],u=d.transformVector(v.matrix,[n,r,s,1]);u[0]=u[0]/u[3],u[1]=u[1]/u[3],u[0]=(.5*u[0]+.5)*p.width,u[1]=(-.5*u[1]+.5)*p.height,u[0]=u[0]<0?0:u[0],u[1]=u[1]<0?0:u[1],u[0]=u[0]>p.width?p.width:u[0],u[1]=u[1]>p.height?p.height:u[1],0<=u[2]&&e.push(u)}for(var l=[1e4,1e4,-1e3],h=[-1e4,-1e4],c=0;c<e.length;c++){var f=e[c];f[0]<l[0]?l[0]=f[0]:f[0]>h[0]&&(h[0]=f[0]),f[1]<l[1]?l[1]=f[1]:f[1]>h[1]&&(h[1]=f[1]),f[2]>l[2]&&(l[2]=f[2])}b.relativeCameraPosition={x:{left:l[0],right:h[0]},y:{top:h[1],bottom:l[1]},depth:l[2]},p.controls.mouse.x>l[0]&&p.controls.mouse.x<h[0]&&p.controls.mouse.y>l[1]&&p.controls.mouse.y<h[1]&&(m=!0);p.controls.mouse;m&&(null==w&&(w=b),w.relativeCameraPosition.depth>=l[2]&&(w=b))}),p.selectedObject=w,b._matrix=v.matrix,b._rotationMatrix=e})}},{key:"_draw",value:function(){var t,e,i,n=this;this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.webGL.uniform3fv(this.reverseLightDirectionLocation,(t=[-.1,.5,1],e=new Float32Array(3),1e-5<(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i,e))),this.webGL.uniform3fv(this.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.cameraLocation,!1,this.camera.matrix),this.polygons.forEach(function(t){n.webGL.enableVertexAttribArray(n.positionLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._vertexesBuffer),n.webGL.vertexAttribPointer(n.positionLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.textureCoordinatesLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._coordsBuffer),n.webGL.vertexAttribPointer(n.textureCoordinatesLocation,2,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.normalLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._normalBuffer),n.webGL.vertexAttribPointer(n.normalLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.uniform1i(n.textureLocation,t.texture._textureBlockLocation),n.webGL.uniformMatrix4fv(n.matrixLocation,!1,t._matrix),n.webGL.uniformMatrix4fv(n.objectRotationLocation,!1,t._world),n.webGL.drawArrays(n.webGL.TRIANGLES,0,3)}),this.objects.forEach(function(e){e.faces.forEach(function(t){n.webGL.enableVertexAttribArray(n.positionLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.vertexesBuffer),n.webGL.vertexAttribPointer(n.positionLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.textureCoordinatesLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.coordsBuffer),n.webGL.vertexAttribPointer(n.textureCoordinatesLocation,2,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.normalLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.normalBuffer),n.webGL.vertexAttribPointer(n.normalLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.uniform1i(n.textureLocation,e.texture._textureBlockLocation),n.webGL.uniformMatrix4fv(n.matrixLocation,!1,e._matrix),n.webGL.uniformMatrix4fv(n.objectRotationLocation,!1,e._world),n.webGL.drawArrays(n.webGL.TRIANGLES,0,t.vertexes.length/t.vertexesCount)})}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"render",value:function(){this._update(),this._draw()}},{key:"run",value:function(){G=this,T()}}])&&_(t.prototype,e),i&&_(t,i),n}();function T(){requestAnimationFrame(T),G.render()}function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}!function(){for(var r=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-r)),o=window.setTimeout(function(){t(i+n)},n);return r=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var k=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=v(90),this.matrix=d.unit(),this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null}var e,i,n;return e=t,(i=[{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=v(t)}},{key:"setCollisions",value:function(t){this._collisions=t}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.computeMatrix()}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation=[t,e,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=d.unit(),this.matrix=d.multiply(this.matrix,d.translation(this.position[0],this.position[1],this.position[2]));var t=new y;t.multiply(d.rotationY(v(this.rotation[1]))),t.multiply(d.rotationX(v(this.rotation[0]))),t.multiply(d.rotationZ(v(this.rotation[2]))),this.matrix=d.multiply(this.matrix,t.matrix),null!=this._lookUpMatrix&&(this.matrix=d.multiply(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=d.inverse(t.matrix),this.inventedMatrix=d.inverse(this.matrix)}},{key:"setControl",value:function(t){this._controlFunction=t}},{key:"setLookUp",value:function(t,e,i){this._lookUpMatrix=null!=t?[t,e,i]:null}},{key:"lookAt",value:function(t,e){if(null==t)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var i=normalize(subVec3(this.position,t)),n=normalize(cross(e,i)),o=normalize(cross(i,n));return[n[0],n[1],n[2],0,o[0],o[1],o[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}}])&&A(e.prototype,i),n&&A(e,n),t}();function E(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var P=function(){function e(o){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o.controls=this).engine=o,this.keys=[],this._handlers=[],this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1]};for(var t=0;t<255;t++)this.keys[t]=!1,this._handlers[t]=null;window.onkeydown=function(t){return r.keys[t.keyCode]=!0,null!=r._handlers[t.keyCode]&&r._handlers[t.keyCode](),!1},window.onkeyup=function(t){return r.keys[t.keyCode]=!1},o.canvas.addEventListener("mousemove",function(t){var e=o.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;r.mouse.x=i,r.mouse.y=n},!1),window.onmousedown=function(t){return r.mouse.buttons[t.button]=!0,null!=r._mouseHandlers[2+t.button]&&r._mouseHandlers[2+t.button](),!1},window.onmouseup=function(t){return r.mouse.buttons[t.button]=!1},o.canvas.oncontextmenu=function(){return!1}}var t,i,n;return t=e,(i=[{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){this.engine.canvas.addEventListener("mousemove",t,!1)}},{key:"onContextMenu",value:function(t){this.engine.canvas.oncontextmenu=t}}])&&E(t.prototype,i),n&&E(t,n),e}();function F(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var B=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t.debugger=this).logArray=[],this.element=null}var t,i,n;return t=e,(i=[{key:"setElement",value:function(t){this.element=t}},{key:"addLog",value:function(t,e,i,n,o){o=o||this.defaultOutput,this.logArray.push({name:t,object:e,value:i,view:n,output:o}),this.addView(n)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"defaultOutput",value:function(t){return null!=object?t.name+" : "+t.object[t.value]:"log.name"}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}}])&&F(t.prototype,i),n&&F(t,n),e}();function C(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var O=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t&&t.polygons.push(this),this.webGL=t.webGL,this.texture=null,this.vertexes=[],this.position=[0,0,0],this.rotation=[0,0,0],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.normals=[0,1,0,0,1,0,0,1,0],this._vertexesBuffer=null}var t,i,n;return t=e,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setTextureCoords",value:function(t){this.textureCoords=t,this._coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setVertexes",value:function(t){this.vertexes=t,this._vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"update",value:function(){}},{key:"setNormals",value:function(t){this.normals=t,this._normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}}])&&C(t.prototype,i),n&&C(t,n),e}();function U(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var M=function(){function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0];var e=new O(t);e.setVertexes([0,0,0,100,100,0,0,100,0]),e.setTextureCoords([0,1,1,0,0,0]),this.polygons[0]=e,(e=new O(t)).setVertexes([100,100,0,0,0,0,100,0,0]),e.setTextureCoords([1,0,0,1,1,1]),this.polygons[1]=e,this.setNormals([0,0,1,0,0,1,0,0,1])}var t,e,n;return t=i,(e=[{key:"setTexture",value:function(t){this.polygons[0].setTexture(t),this.polygons[1].setTexture(t)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.polygons[0].setVertexes([0,0,0,t,e,0,0,e,0]),this.polygons[1].setVertexes([t,e,0,0,0,0,t,0,0])}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.polygons[0].setPosition(t,e,i),this.polygons[1].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){var n=v(t),o=v(e),r=v(i);this.polygons[0].rotate(n,o,r),this.polygons[1].rotate(n,o,r)}},{key:"setParentRotation",value:function(t,e,i){this.polygons[0].setParentRotation(t,e,i),this.polygons[1].setParentRotation(t,e,i)}},{key:"setRotationPoint",value:function(t,e,i){this.polygons[0].setRotationPoint(t,e,i),this.polygons[1].setRotationPoint(t,e,i)}},{key:"setNormals",value:function(t){this.polygons[0].setNormals(t),this.polygons[1].setNormals(t)}}])&&U(t.prototype,e),n&&U(t,n),i}();function j(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var D=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.faces=[new M(t),new M(t),new M(t),new M(t),new M(t),new M(t)],this.position=[0,0,0],this.rotation=[0,0,0],this.faces[0].rotate(0,0,0),this.faces[0].setRotationPoint(-100,-100,100),this.faces[0].setPosition(0,0,0),this.faces[0].setNormals([0,0,1,0,0,1,0,0,1]),this.faces[1].rotate(0,90,0),this.faces[1].setRotationPoint(-100,-100,100),this.faces[1].position=[0,0,0],this.faces[1].setNormals([1,0,0,1,0,0,1,0,0]),this.faces[2].rotate(0,-180,0),this.faces[2].setRotationPoint(-100,-100,100),this.faces[2].position=[0,0,0],this.faces[2].setNormals([0,0,-1,0,0,-1,0,0,-1]),this.faces[3].rotate(0,270,0),this.faces[3].setRotationPoint(-100,-100,100),this.faces[3].position=[0,0,0],this.faces[3].setNormals([-1,0,0,-1,0,0,-1,0,0]),this.faces[4].rotate(-90,0,0),this.faces[4].setRotationPoint(-100,-100,100),this.faces[4].position=[0,0,0],this.faces[4].setNormals([0,1,0,0,1,0,0,1,0]),this.faces[5].rotate(90,0,0),this.faces[5].setRotationPoint(-100,-100,100),this.faces[5].position=[0,0,0],this.faces[5].setNormals([0,-1,0,0,-1,0,0,-1,0])}var t,i,n;return t=e,(i=[{key:"_updateFaces",value:function(){this.faces[0].setPosition(this.position[0],this.position[1],this.position[2])}},{key:"setTexture",value:function(t,e,i,n,o,r){this.faces[0].setTexture(t),this.faces[1].setTexture(e),this.faces[2].setTexture(i),this.faces[3].setTexture(n),this.faces[4].setTexture(o),this.faces[5].setTexture(r)}},{key:"setSize",value:function(e,i,n){this.width=e,this.height=i,this.depth=n,this.faces.forEach(function(t){t.setSize(e,i),t.setRotationPoint(-e/2,-i/2,n/2)})}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.faces[0].setPosition(t,e,i),this.faces[1].setPosition(t,e,i),this.faces[2].setPosition(t,e,i),this.faces[3].setPosition(t,e,i),this.faces[4].setPosition(t,e,i),this.faces[5].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i;var n=v(this.rotation[0]),o=v(this.rotation[1]),r=v(this.rotation[2]);this.faces.forEach(function(t){t.setParentRotation(n,o,r)})}},{key:"setRotation",value:function(t,e,i){var n=v(t),o=v(e),r=v(i);this.faces.forEach(function(t){t.setParentRotation(n,o,r)})}},{key:"animation",value:function(){this.rotate(1,1,1)}},{key:"animate",value:function(t,e){e=e||this.animation,this._animationInterval=setInterval(e,1e3/t)}},{key:"removeAnimation",value:function(){clearInterval(this._animationInterval)}}])&&j(t.prototype,i),n&&j(t,n),e}();i.d(e,"Engine",function(){return R}),i.d(e,"Camera",function(){return k}),i.d(e,"Controls",function(){return P}),i.d(e,"Debugger",function(){return B}),i.d(e,"Texture",function(){return c}),i.d(e,"Rect",function(){return M}),i.d(e,"Cube",function(){return D}),i.d(e,"Object",function(){return L}),i.d(e,"Map",function(){return g})}])});