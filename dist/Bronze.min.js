!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Bronze",[],t):"object"==typeof exports?exports.Bronze=t():e.Bronze=t()}(window,function(){return function(i){var n={};function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist",r(r.s=15)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}t.exports=i},function(e,t,i){var n=i(12),r=i(6);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?r(e):t}},function(e,t,i){var n=i(5);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(i,e){function n(e,t){return i.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}i.exports=n},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,i){e.exports=i(10)},function(e,t){function h(e,t,i,n,r,o,a){try{var s=e[o](a),h=s.value}catch(e){return void i(e)}s.done?t(h):Promise.resolve(h).then(n,r)}e.exports=function(s){return function(){var e=this,a=arguments;return new Promise(function(t,i){var n=s.apply(e,a);function r(e){h(n,t,i,r,o,"next",e)}function o(e){h(n,t,i,r,o,"throw",e)}r(void 0)})}}},function(t,e,i){var n=i(2),r=i(5),o=i(13),a=i(14);function s(e){var i="function"==typeof Map?new Map:void 0;return t.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return a(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)},s(e)}t.exports=s},function(e,t,i){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),o=r&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=i(11),r)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(F,e){!function(e){"use strict";var h,t=Object.prototype,u=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag",a="object"==typeof F,s=e.regeneratorRuntime;if(s)a&&(F.exports=s);else{(s=e.regeneratorRuntime=a?F.exports:{}).wrap=L;var l="suspendedStart",f="suspendedYield",d="executing",m="completed",g={},c={};c[r]=function(){return this};var b=Object.getPrototypeOf,v=b&&b(b(k([])));v&&v!==t&&u.call(v,r)&&(c=v);var w=_.prototype=p.prototype=Object.create(c);G.prototype=w.constructor=_,_.constructor=G,_[o]=G.displayName="GeneratorFunction",s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===G||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(w),e},s.awrap=function(e){return{__await:e}},y(E.prototype),E.prototype[n]=function(){return this},s.AsyncIterator=E,s.async=function(e,t,i,n){var r=new E(L(e,t,i,n));return s.isGeneratorFunction(t)?r:r.next().then(function(e){return e.done?e.value:r.next()})},y(w),w[o]="Generator",w[r]=function(){return this},w.toString=function(){return"[object Generator]"},s.keys=function(i){var n=[];for(var e in i)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in i)return e.value=t,e.done=!1,e}return e.done=!0,e}},s.values=k,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=h)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function e(e,t){return o.type="throw",o.arg=i,n.next=e,t&&(n.method="next",n.arg=h),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t],o=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var a=u.call(r,"catchLoc"),s=u.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),R(i),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;R(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:k(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=h),g}}}function L(e,t,i,n){var o,a,s,h,r=t&&t.prototype instanceof p?t:p,u=Object.create(r.prototype),c=new P(n||[]);return u._invoke=(o=e,a=i,s=c,h=l,function(e,t){if(h===d)throw new Error("Generator is already running");if(h===m){if("throw"===e)throw t;return B()}for(s.method=e,s.arg=t;;){var i=s.delegate;if(i){var n=A(i,s);if(n){if(n===g)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(h===l)throw h=m,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);h=d;var r=x(o,a,s);if("normal"===r.type){if(h=s.done?m:f,r.arg===g)continue;return{value:r.arg,done:s.done}}"throw"===r.type&&(h=m,s.method="throw",s.arg=r.arg)}}),u}function x(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function p(){}function G(){}function _(){}function y(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function E(h){var t;this._invoke=function(i,n){function e(){return new Promise(function(e,t){!function t(e,i,n,r){var o=x(h[e],h,i);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,n,r)},function(e){t("throw",e,n,r)}):Promise.resolve(s).then(function(e){a.value=e,n(a)},function(e){return t("throw",e,n,r)})}r(o.arg)}(i,n,e,t)})}return t=t?t.then(e,e):e()}}function A(e,t){var i=e.iterator[t.method];if(i===h){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=h,A(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var n=x(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,g;var r=n.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=h),t.delegate=null,g):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function k(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(u.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=h,e.done=!0,e};return n.next=n}}return{next:B}}function B(){return{value:h,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(t,e){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?t.exports=n=function(e){return i(e)}:t.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)},n(e)}t.exports=n},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(n,e,t){var o=t(5);function r(e,t,i){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?n.exports=r=function(e,t,i){var n=[null];n.push.apply(n,t);var r=new(Function.bind.apply(e,n));return i&&o(r,i.prototype),r}:n.exports=r=Reflect.construct,r.apply(null,arguments)}n.exports=r},function(e,t,i){"use strict";function n(e){return 180*e/Math.PI}function a(e){return e*Math.PI/180}function o(e){return 0==(e&e-1)}function r(e){return Math.abs(e)}i.r(t);var s=i(0),l=i.n(s),h=i(1),u=i.n(h),c=function(){function e(){return l()(this,e),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return u()(e,[{key:"perspective",value:function(e,t,i,n,r){var o=Math.tan(.5*Math.PI-.5*e),a=1/(n-r);return this.matrix=[o/(t/i),0,0,0,0,o,0,0,0,0,(n+r)*a,-1,0,0,n*r*a*2,0],this}},{key:"projection",value:function(e,t,i,n,r){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1],this.matrix=[2/t,0,0,0,0,-2/i,0,0,0,0,2/r,0,0,0,0,1],this}},{key:"multiply",value:function(e){var t=this.matrix[0],i=this.matrix[1],n=this.matrix[2],r=this.matrix[3],o=this.matrix[4],a=this.matrix[5],s=this.matrix[6],h=this.matrix[7],u=this.matrix[8],c=this.matrix[9],l=this.matrix[10],f=this.matrix[11],d=this.matrix[12],m=this.matrix[13],g=this.matrix[14],b=this.matrix[15],v=e[0],w=e[1],L=e[2],x=e[3],p=e[4],G=e[5],_=e[6],y=e[7],E=e[8],A=e[9],T=e[10],R=e[11],P=e[12],k=e[13],B=e[14],F=e[15];this.matrix=[v*t+w*o+L*u+x*d,v*i+w*a+L*c+x*m,v*n+w*s+L*l+x*g,v*r+w*h+L*f+x*b,p*t+G*o+_*u+y*d,p*i+G*a+_*c+y*m,p*n+G*s+_*l+y*g,p*r+G*h+_*f+y*b,E*t+A*o+T*u+R*d,E*i+A*a+T*c+R*m,E*n+A*s+T*l+R*g,E*r+A*h+T*f+R*b,P*t+k*o+B*u+F*d,P*i+k*a+B*c+F*m,P*n+k*s+B*l+F*g,P*r+k*h+B*f+F*b]}},{key:"multiply_",value:function(e){var t=this.matrix[0],i=this.matrix[1],n=this.matrix[2],r=this.matrix[3],o=this.matrix[4],a=this.matrix[5],s=this.matrix[6],h=this.matrix[7],u=this.matrix[8],c=this.matrix[9],l=this.matrix[10],f=this.matrix[11],d=this.matrix[12],m=this.matrix[13],g=this.matrix[14],b=this.matrix[15],v=e[0],w=e[1],L=e[2],x=e[3],p=e[4],G=e[5],_=e[6],y=e[7],E=e[8],A=e[9],T=e[10],R=e[11],P=e[12],k=e[13],B=e[14],F=e[15];return[v*t+w*o+L*u+x*d,v*i+w*a+L*c+x*m,v*n+w*s+L*l+x*g,v*r+w*h+L*f+x*b,p*t+G*o+_*u+y*d,p*i+G*a+_*c+y*m,p*n+G*s+_*l+y*g,p*r+G*h+_*f+y*b,E*t+A*o+T*u+R*d,E*i+A*a+T*c+R*m,E*n+A*s+T*l+R*g,E*r+A*h+T*f+R*b,P*t+k*o+B*u+F*d,P*i+k*a+B*c+F*m,P*n+k*s+B*l+F*g,P*r+k*h+B*f+F*b]}},{key:"translate",value:function(e,t,i){this.multiply(b(e,t,i))}},{key:"translate_",value:function(e,t,i){return this.multiply_(b(e,t,i))}},{key:"rotateX",value:function(e){this.multiply(v(e))}},{key:"rotateY",value:function(e){this.multiply(w(e))}},{key:"rotateZ",value:function(e){this.multiply(L(e))}},{key:"scale",value:function(e,t,i){this.multiply(d(e,t,i))}}]),e}();function f(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b(e,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1]}function v(e){var t=Math.cos(e),i=Math.sin(e);return[1,0,0,0,0,t,i,0,0,-i,t,0,0,0,0,1]}function w(e){var t=Math.cos(e),i=Math.sin(e);return[t,0,-i,0,0,1,0,0,i,0,t,0,0,0,0,1]}function L(e){var t=Math.cos(e),i=Math.sin(e);return[t,i,0,0,-i,t,0,0,0,0,1,0,0,0,0,1]}function d(e,t,i){return[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1]}function x(e,t){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],d=e[11],m=e[12],g=e[13],b=e[14],v=e[15],w=t[0],L=t[1],x=t[2],p=t[3],G=t[4],_=t[5],y=t[6],E=t[7],A=t[8],T=t[9],R=t[10],P=t[11],k=t[12],B=t[13],F=t[14],C=t[15];return[w*i+L*a+x*c+p*m,w*n+L*s+x*l+p*g,w*r+L*h+x*f+p*b,w*o+L*u+x*d+p*v,G*i+_*a+y*c+E*m,G*n+_*s+y*l+E*g,G*r+_*h+y*f+E*b,G*o+_*u+y*d+E*v,A*i+T*a+R*c+P*m,A*n+T*s+R*l+P*g,A*r+T*h+R*f+P*b,A*o+T*u+R*d+P*v,k*i+B*a+F*c+C*m,k*n+B*s+F*l+C*g,k*r+B*h+F*f+C*b,k*o+B*u+F*d+C*v]}function m(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]}function p(e,t){for(var i=new Float32Array(4),n=0;n<4;++n)for(var r=i[n]=0;r<4;++r)i[n]+=t[r]*e[4*r+n];return i}function G(e){var t=new Float32Array(16),i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],d=e[11],m=e[12],g=e[13],b=e[14],v=e[15],w=f*v,L=b*d,x=h*v,p=b*u,G=h*d,_=f*u,y=r*v,E=b*o,A=r*d,T=f*o,R=r*u,P=h*o,k=c*g,B=m*l,F=a*g,C=m*s,I=a*l,U=c*s,M=i*g,S=m*n,D=i*l,O=c*n,N=i*s,j=a*n,Y=w*s+p*l+G*g-(L*s+x*l+_*g),z=L*n+y*l+T*g-(w*n+E*l+A*g),X=x*n+E*s+R*g-(p*n+y*s+P*g),V=_*n+A*s+P*l-(G*n+T*s+R*l),W=1/(i*Y+a*z+c*X+m*V);return t[0]=W*Y,t[1]=W*z,t[2]=W*X,t[3]=W*V,t[4]=W*(L*a+x*c+_*m-(w*a+p*c+G*m)),t[5]=W*(w*i+E*c+A*m-(L*i+y*c+T*m)),t[6]=W*(p*i+y*a+P*m-(x*i+E*a+R*m)),t[7]=W*(G*i+T*a+R*c-(_*i+A*a+P*c)),t[8]=W*(k*u+C*d+I*v-(B*u+F*d+U*v)),t[9]=W*(B*o+M*d+O*v-(k*o+S*d+D*v)),t[10]=W*(F*o+S*u+N*v-(C*o+M*u+j*v)),t[11]=W*(U*o+D*u+j*d-(I*o+O*u+N*d)),t[12]=W*(F*f+U*b+B*h-(I*b+k*h+C*f)),t[13]=W*(D*b+k*r+S*f-(M*f+O*b+B*r)),t[14]=W*(M*h+j*b+C*r-(N*b+F*r+S*h)),t[15]=W*(N*f+I*r+O*h-(D*h+j*f+U*r)),t}function g(e){var t=new Float32Array(3),i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return 1e-5<i&&(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t)}function _(e){var t=Math.cos(e),i=Math.sin(e);return[1,0,0,0,t,i,0,-i,t]}function y(e){var t=Math.cos(e),i=Math.sin(e);return[t,0,-i,0,1,0,i,0,t]}function E(e){var t=Math.cos(e),i=Math.sin(e);return[t,i,0,-i,t,0,0,0,1]}function A(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}function T(e,t){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=t[0],f=t[1],d=t[2],m=t[3],g=t[4],b=t[5],v=t[6],w=t[7],L=t[8];return[l*i+f*o+d*h,l*n+f*a+d*u,l*r+f*s+d*c,m*i+g*o+b*h,m*n+g*a+b*u,m*r+g*s+b*c,v*i+w*o+L*h,v*n+w*a+L*u,v*r+w*s+L*c]}var R=i(7),P=i.n(R),k=i(8),B=i.n(k);var F,C=i(3),I=i.n(C),U=i(2),M=i.n(U),S=i(4),D=i.n(S),O=i(9),N=function(e){function r(e,t,i){var n;return l()(this,r),(n=I()(this,M()(r).call(this))).src=e,null!=t&&null!=i&&(n.width=t,n.height=i),n.coords=[],n.addEventListener("load",function(){n.loaded=!0}),n.color=new Uint8Array([255,255,255,255]),n._textureBlockLocation=null,n.mipmapFilter="LINEAR",n.mipmap=[],n.mips=null,n.onTextureLoad=[],n.alpha=!1,n}return D()(r,e),u()(r,[{key:"generateMipmap",value:function(e){this.mips=e}},{key:"logImage",value:function(e,t,i){var n=new Image;n.onload=function(){console.log("%c+","padding: "+Math.floor(t/2)+"px "+Math.floor(i/2)+"px; line-height: "+t+"px;background: url("+n+"); background-size: "+i+"px "+t+"px; color: transparent;")},n.src=e.toDataURL()}},{key:"autoGenerateMipmap",value:function(e){e._autoGenerateMipmap=!0}},{key:"quickGenerateMipmap",value:function(e){if(e.width/e.height!=2)return console.warn("Wrong image sizes for quick generation mipmap.");for(var t=e.height,i=0;;){var n=document.createElement("canvas");if(n.width=t,n.height=t,n.getContext("2d").drawImage(e,i,0,t,t,0,0,t,t),e.mipmap.push(n),1==t)break;i+=t,t/=2}}},{key:"_generateMipmaps",value:function(e){e=e||this.mips;for(var t=this.width,i=[],n=0;1!=t;)if(t/=2,n>e.length-1){var r=e[n-1].image;r.width=t,r.height=t,i.push(r)}else if(e[n].size==t){var o=e[n].image;o.width=t,o.height=t,i.push(o),n++}else this.setSize(t,t),i.push(this);this.mipmap=i}},{key:"setSize",value:function(e,t){this.width=e,this.height=t}},{key:"scale",value:function(e,t){this.width=width*e,this.height=height*t}},{key:"setCoords",value:function(e){this.coords=e}},{key:"setColorRGBA",value:function(e,t,i,n){this.color=new Uint8Array([e,t,i,n])}},{key:"bind",value:function(e){var n=this;this.engine=e,this._textureBlockLocation=this.engine.textures.length,this.engine.textures.push(this),this._WebGLTexture=this.engine.webGL.createTexture(),this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this.engine.webGL.bindTexture(this.engine.webGL.TEXTURE_2D,this._WebGLTexture),this.engine.webGL.texImage2D(this.engine.webGL.TEXTURE_2D,0,this.engine.webGL.RGBA,1,1,0,this.engine.webGL.RGBA,this.engine.webGL.UNSIGNED_BYTE,this.color),this.addEventListener("load",function(){var e,t=n;n.onTextureLoad.forEach(function(e){e(t)}),n.engine.textureLoaded(n),n.engine.webGL.activeTexture(n.engine.webGL.TEXTURE0+n._textureBlockLocation);var i=!0;switch(n.mipmapFilter){case"NEAREST":e=n.engine.webGL.NEAREST,i=!1;break;case"LINEAR":e=n.engine.webGL.LINEAR,i=!1;break;case"NEAREST_MIPMAP_NEAREST":e=n.engine.webGL.NEAREST_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_NEAREST":case"NEAREST_MIPMAP_LINEAR":e=n.engine.webGL.LINEAR_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_LINEAR":e=n.engine.webGL.LINEAR_MIPMAP_LINEAR;break;default:i=!1,e=n.engine.webGL.LINEAR}n.WebGLMipmapFilter=e,n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_MIN_FILTER,e),n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_MAG_FILTER,n.engine.webGL.LINEAR),i&&!n._autoGenerateMipmap?0<n.mipmap.length?n.mipmap.forEach(function(e,t){n.engine.webGL.texImage2D(n.engine.webGL.TEXTURE_2D,t,n.engine.webGL.RGBA,n.engine.webGL.RGBA,n.engine.webGL.UNSIGNED_BYTE,e)}):(console.warn("Need to generate mipmaps for texture:"),console.warn(n)):n.engine.webGL.texImage2D(n.engine.webGL.TEXTURE_2D,0,n.engine.webGL.RGBA,n.engine.webGL.RGBA,n.engine.webGL.UNSIGNED_BYTE,n),(i||n._autoGenerateMipmap)&&o(n.width)&&o(n.height)?n.engine.webGL.generateMipmap(n.engine.webGL.TEXTURE_2D):(n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_WRAP_S,n.engine.webGL.CLAMP_TO_EDGE),n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_WRAP_T,n.engine.webGL.CLAMP_TO_EDGE))})}}]),r}(i.n(O)()(Image)),j=function(){function t(e){return l()(this,t),this.webGL=e,this.VERTEX_SHADER="vertex",this.FRAGMENT_SHADER="fragment",this.ATTRIBUTE="attribute",this.UNIFORM="uniform",this}return u()(t,[{key:"addShader",value:function(e,t){var i;switch(e){case"vertex":i=this.webGL.createShader(this.webGL.VERTEX_SHADER),this.vertexShader=i;break;case"fragment":i=this.webGL.createShader(this.webGL.FRAGMENT_SHADER),this.fragmentShader=i;break;default:throw new Y("Wrong shader type")}if(this.webGL.shaderSource(i,t),this.webGL.compileShader(i),!this.webGL.getShaderParameter(i,this.webGL.COMPILE_STATUS))throw console.error(this.webGL.getShaderInfoLog(i)),"Could not compile shader:"}},{key:"create",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this.webGL.createProgram();return this.webGL.attachShader(t,this.vertexShader),this.webGL.attachShader(t,this.fragmentShader),this.webGL.linkProgram(t),this.webGL.useProgram(t),e&&(this.webGL.deleteShader(this.vertexShader),this.webGL.deleteShader(this.fragmentShader)),this.program=t}},{key:"linkVariable",value:function(e,t,i){switch(void 0!==this[i=i||t]&&(console.warn("Shader program: Custom name for uniform was switched from "+i+" to "+i+"1"),i+="1"),e){case this.ATTRIBUTE:this[i]=this.webGL.getAttribLocation(this.program,t);break;case this.UNIFORM:this[i]=this.webGL.getUniformLocation(this.program,t);break;default:throw"Wrong variable type"}return this[i]}},{key:"linkAttribute",value:function(e,t){return null!=this[t=t||e]&&(console.warn("Shader program: Custom name for uniform was switched from "+t+" to "+t+"1"),t+="1"),this[t]=this.webGL.getAttribLocation(this.program,e),this[t]}},{key:"linkUniform",value:function(e,t){return null!=this[t=t||e]&&(console.warn("Shader program: Custom name for attribute was switched from "+t+" to "+t+"1"),t+=""),this[t]=this.webGL.getUniformLocation(this.program,e),this[t]}},{key:"use",value:function(){this.webGL.useProgram(this.program)}},{key:"useIn",value:function(e){e.useProgram(this.program)}}]),t}(),Y=function e(t){l()(this,e),this.message=t,this.name="Bronze shader error"},z=function(){function t(e){l()(this,t),this.webGL=e,this.extensions={}}return u()(t,[{key:"addProgram",value:function(e,t,i,n){var r=new j(this.webGL);r.addShader("vertex",t),r.addShader("fragment",i),r.create(),r=this._linkAllAttributesFromSource(r,t,n),r=this._linkAllAttributesFromSource(r,i,n),this[e]=r}},{key:"_linkAllAttributesFromSource",value:function(n,e,r){var o;return e.split(";").join("\r").split("\r").forEach(function(e){for(var t=(e=(e=e.replace(new RegExp("\r","g"),"")).replace(new RegExp("\n","g"),"")).split(" "),i=t.length-1;i--;)""===t[i]&&t.splice(i,1);t[0].toLowerCase().includes("attribute")?(o=t[2],r&&r.removePrefixes&&(o=o.slice(2,o.length)),r&&r.addLocationMarker&&(o+="Location"),n.linkAttribute(t[2],o)):t[0].toLowerCase().includes("uniform")&&(o=t[2],r&&r.removePrefixes&&(o=o.slice(2,o.length)),r&&r.addLocationMarker&&(o+="Location"),n.linkUniform(t[2],o))}),n}},{key:"addExtension",value:function(e,t){this.extensions[e]=this.webGL.getExtension(t)}}]),t}(),X=function(){function n(e){var t,i;l()(this,n),this.infoConsoleLog(),this.div=e,this.div.style="position: relative;",this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,e.appendChild(this.canvas),this.webGL=(t=this.canvas,i=t.getContext("experimental-webgl"),window.addEventListener("resize",function(){t.width=t.offsetWidth,t.height=t.offsetHeight}),i),this.width=e.width,this.height=e.height,this.polygons=[],this.objects=[],this.objectsWithAlphaTexture=[],this.ui=null,this.textures=[],this.loadedTexturesCount=0,this.texturesLoaded=!1,this.onTexturesLoadedHandlers=[],this.noTexture=new N,this.noTexture.setColorRGBA(219,58,52,255),this.noTexture.bind(this),this.textureLoaded(this.noTexture),this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._objectSelectHandler,this.drawCalls=0,this.drawCallsPerFrame=0,this.onrun=[],this.reflectionQuality=2048,this.shaders=new z(this.webGL),this._initShaders(),this.shaders.default.use(),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST)}var e;return u()(n,[{key:"infoConsoleLog",value:function(){console.log(),console.log("     %c%s","color: rgba(247, 137, 74, 1); text-align: center; font-size: 16px; font-weight: 700","Bronze Engine is running"),console.log(),console.info("     Version : 0.0.1"),console.info("     Docs    : http://m0ksem.design/Bronze-Engine/docs/global"),console.info("     GitHub  : https://github.com/m0ksem/Bronze-Engine"),console.log()}},{key:"_initShaders",value:function(){var e={removePrefixes:!0,addLocationMarker:!0};this.shaders.addExtension("anisotropic","EXT_texture_filter_anisotropic"),this.shaders.addExtension("standard","OES_standard_derivatives"),this.shaders.addProgram("default","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\r\n}","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n    gl_FragColor.rgb *= (light);\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}",e),this.shaders.addProgram("cube","attribute vec4 a_position;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_world;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_normal = vec3(u_world * a_normal);\r\n    v_normalTex = normalize(a_position.xyz);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition;\r\n}","precision mediump float;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\n\r\nuniform samplerCube u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = textureCube(u_texture, v_normalTex);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < .9)\r\n        discard;\r\n}\r\n",e),this.shaders.addProgram("grid","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\n\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_moving;\r\nuniform vec2 u_cellSize;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    v_texcoord = vec2(a_texcoord.x + u_moving.x / u_cellSize.x, a_texcoord.y + (u_moving.y / u_cellSize.x));\r\n}","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n}",e),this.shaders.addProgram("reflection","attribute vec4 a_position;\r\nattribute vec3 a_normal;\r\n    \r\nuniform mat4 u_matrix;\r\nuniform mat4 u_rotationMatrix;\r\n    \r\nvarying vec3 v_worldPosition;\r\nvarying vec3 v_worldNormal;\r\n    \r\nvoid main() {\r\n    // Multiply the position by the matrix.\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    // send the view position to the fragment shader\r\n    v_worldPosition = (u_rotationMatrix * a_position).xyz;\r\n    \r\n    // orient the normals and pass to the fragment shader\r\n    v_worldNormal =  vec3(a_normal); // mat3(u_rotationMatrix) *\r\n}","precision highp float;\r\n    \r\n// Passed in from the vertex shader.\r\nvarying vec3 v_worldPosition;\r\nvarying vec3 v_worldNormal;\r\n    \r\n// The texture.\r\nuniform samplerCube u_texture;\r\nuniform vec3 u_worldCameraPosition;\r\n        \r\nvoid main() {\r\n    vec3 worldNormal = normalize(v_worldNormal);\r\n    vec3 eyeToSurfaceDir = normalize(v_worldPosition);\r\n    vec3 direction = reflect(eyeToSurfaceDir, vec3(0.0, 0.0, -1.0));\r\n    \r\n    gl_FragColor = textureCube(u_texture, direction);\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}",e),this.shaders.default.use(),this.webGL.enable(this.webGL.BLEND),this.webGL.blendFunc(this.webGL.ONE,this.webGL.ONE_MINUS_SRC_ALPHA)}},{key:"setCamera",value:function(e){this.camera=e}},{key:"canvasResized",value:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.webGL.viewport(0,0,this.width,this.height)}},{key:"onObjectSelect",value:function(e){this._objectSelectHandler=e}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"_update",value:function(){var i=this;null!=this.camera._controlFunction&&(this.camera._controlFunction(),this.controls.mouse.movement.x=0,this.controls.mouse.movement.y=0),this.selectedObject=null,this.objects.forEach(function(e,t){e.update(),e.texture.alpha&&(i.objectsWithAlphaTexture.push(e),i.objects.splice(t,1))}),this.objectsWithAlphaTexture.sort(function(e,t){return e.position[2]-t.position[2]}),this.objectsWithAlphaTexture.forEach(function(e){e.update()}),this.selectedObject||null==this._objectSelectHandler||this._objectSelectHandler(this.selectedObject)}},{key:"_draw",value:function(){this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.shaders.default.use(),this.webGL.uniform3fv(this.shaders.default.lightWorldPositionLocation,this.camera.position),this.webGL.uniformMatrix4fv(this.shaders.default.cameraMatrixLocation,!1,this.camera.matrix),this.drawCallsPerFrame=0,this.polygons.forEach(function(e){e.draw()}),this.objects.forEach(function(e){e.draw()}),this.objectsWithAlphaTexture.forEach(function(e){e.draw()}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"captureFrame",value:function(e,t){var i=this.camera,n=[this.canvas.width,this.canvas.height],r=!1,o=128,a=128,s="rgba(0, 0, 0, 0)",h=1,u=1,c=[];null!=t&&(r=t.drawUI||r,o=t.height||o,a=t.width||a,s=t.backgroundColor||s,h=t.backgroundAlpha||h,u=t.imageAlpha||u,c=t.noDrawObjects||[]),this.canvas.width=a,this.canvas.height=o,this.canvasResized(),this.camera=e,this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.shaders.default.use(),this.webGL.uniform3fv(this.shaders.default.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaders.default.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaders.default.cameraLocation,!1,this.camera.matrix),this.drawCallsPerFrame=0,this._update(),this.polygons.forEach(function(e){e.draw()});for(var l=0;l<this.objects.length;l++){var f=this.objects[l];-1==c.indexOf(f)&&(!r&&f.UIElement||f.draw())}this.objectsWithAlphaTexture.forEach(function(e){-1==c.indexOf(e)&&e.draw()});var d=document.createElement("canvas");d.height=this.canvas.height,d.width=this.canvas.width;var m=d.getContext("2d");return m.globalAlpha=h,m.fillStyle=s,m.fillRect(0,0,this.canvas.width,this.canvas.height),m.globalAlpha=u,m.drawImage(this.canvas,0,0),this.camera=i,this.canvas.width=n[0],this.canvas.height=n[1],this.canvasResized(),d}},{key:"setDrawingRange",value:function(e){if(null==this.camera)throw"Failed to set drawing range. Camera wasn't set.";this.camera.range=e}},{key:"render",value:(e=B()(P.a.mark(function e(){return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._update();case 2:return e.next=4,this._draw();case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"run",value:function(){F=this,V(),this.onrun.forEach(function(e){e()})}},{key:"addOnRunFunction",value:function(e){this.onrun.push(e)}},{key:"textureLoaded",value:function(e){var t=this;this.loadedTexturesCount+=1,this.loadedTexturesCount==this.textures.length&&(this.texturesLoaded=!0,this.onTexturesLoadedHandlers.forEach(function(e){e(t.textures.length)}))}},{key:"addOnTexturesLoaded",value:function(e){this.onTexturesLoadedHandlers.push(e)}}]),n}();function V(){requestAnimationFrame(V),F.render()}!function(){for(var o=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),n=Math.max(0,16-(i-o)),r=window.setTimeout(function(){e(i+n)},n);return o=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var W=function(){function e(){l()(this,e),this._position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=a(90),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null,this.range=2e4,this.rotationMatrix=null,this.inverseMatrix=null,this.inverseRotationMatrix}return u()(e,[{key:"setFieldOfView",value:function(e){this.fieldOfView=e,this.fieldOfViewRad=a(e)}},{key:"setCollisions",value:function(e){this._collisions=e}},{key:"setPosition",value:function(e,t,i){this.position=[e,t,i]}},{key:"move",value:function(e,t,i){this.position[0]+=e,this.position[1]+=t,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(e,t,i){this.rotation[0]+=e,this.rotation[1]+=t,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(e,t,i){this.rotation=[e,t,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.matrix=x(this.matrix,b(this.position[0],this.position[1],this.position[2]));var e=new c;e.multiply(w(a(this.rotation[1]))),e.multiply(v(a(this.rotation[0]))),e.multiply(L(a(this.rotation[2]))),this.matrix=x(this.matrix,e.matrix),null!=this._lookUpMatrix&&(this.matrix=x(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=e.matrix,this.inverseRotationMatrix=G(e.matrix),this.inverseMatrix=G(this.matrix)}},{key:"setControl",value:function(e){this._controlFunction=e}},{key:"setLookUp",value:function(e,t,i){this._lookUpMatrix=null!=e?[e,t,i]:null}},{key:"lookAt",value:function(e,t){if(null==e)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var i=normalize(subVec3(this.position,e)),n=normalize(cross(t,i)),r=normalize(cross(i,n));return[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}},{key:"position",get:function(){return this._position},set:function(e){this._position=e,this.computeMatrix()}}]),e}(),H=function(){function n(a){var s=this;l()(this,n),(a.controls=this).engine=a,this.mouseOverCanvas=!1,this._lockPointer=!0,this.pointerLocked=!1,this._rebind=!0,this._globalRebind=!1,this.keys=[],this._handlers=[],this._focusHandlers=[],this._blurHandlers=[],this._focusOnlyIfClick=!0,this.isFocused=!1,this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1],movement:{x:0,y:0},sensitivity:1},this.touch={x:0,y:0,movement:{x:0,y:0},click:!1,longClick:!1,duration:null,actionBeforeMove:null},this.longTouchTime=500,this.touchDuration;for(var e=0;e<255;e++)this.keys[e]=!1,this._handlers[e]=null;if(window.onkeydown=function(e){return s.isFocused?(s.keys[e.keyCode]=!0,null!=s._handlers[e.keyCode]&&s._handlers[e.keyCode](e),!s._rebind):!s._globalRebind||!s._rebind},window.onkeyup=function(e){return s.keys[e.keyCode]=!1,!s._rebind},a.div.setAttribute("tabindex","0"),a.div.onblur=function(){s.isFocused=!1;for(var e=0;e<s._focusHandlers.length;e++)s._blurHandlers[e]()},a.div.onfocus=function(){s.isFocused=!0;for(var e=0;e<s._focusHandlers.length;e++)s._focusHandlers[e]()},a.div.onclick=function(){s._focusOnlyIfClick&&!s.isFocused&&a.div.focus(),s._lockPointer&&a.div.requestPointerLock()},a.div.oncontextmenu=function(){return!1},function(){var e=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var t=["(",e.join("touch-enabled),("),"heartz",")"].join("");return i=t,window.matchMedia(i).matches;var i}()){var t,h,i=function(){s.touch.duration=(new Date).getTime()-t,s.touch.duration>s.longTouchTime&&(s.touch.longClick=!0,s.touch.click=!1,clearInterval())},u=!1;a.div.addEventListener("touchstart",function(e){return null!=s._mouseHandlers[2]&&s._mouseHandlers[2](e),h=setInterval(i,100),t=(new Date).getTime(),s.touch.duration=0,u=!1},!1),a.div.addEventListener("touchend",function(e){return!u&&s.touch.duration<s.longTouchTime?(s.touch.click=!0,setTimeout(function(){s.touch.click=!1},100)):s.touch.actionBeforeMove=!1,c=null,s.touch.longClick=!1,clearInterval(h),!1},!1);var c=null;a.div.addEventListener("touchmove",function(e){var t=a.div.getBoundingClientRect(),i=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top;s.mouse.x=i,s.mouse.y=n,null==c&&(c={x:i,y:n});var r=(i-c.x)*s.mouse.sensitivity,o=(n-c.y)*s.mouse.sensitivity;s.mouse.movement.x=r,s.mouse.movement.y=o,c.x=i,c.y=n,s.touch.x=i,s.touch.y=n,s.touch.movement.x=r,s.touch.movement.y=o,u||(s.touch.duration>s.longTouchTime?(s.touch.actionBeforeMove="long click",s.touch.longClick=!1):(s.touch.actionBeforeMove="click",s.touch.click=!1)),u=!0,clearInterval(h)},!1)}else{var r=null;a.div.addEventListener("mousemove",function(e){if(s.pointerLocked)s.mouse.movement.x=-e.movementX*s.mouse.sensitivity,s.mouse.movement.y=-e.movementY*s.mouse.sensitivity,s.mouse.x=s.engine.width/2,s.mouse.y=s.engine.height/2;else{var t=a.div.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;s.mouse.x=i,s.mouse.y=n,null==r&&(r={x:i,y:n}),s.mouse.movement.x=(i-r.x)*s.mouse.sensitivity,s.mouse.movement.y=(n-r.y)*s.mouse.sensitivity,r.x=i,r.y=n}},!1),window.addEventListener("mousemove",function(e){var t=a.div.getBoundingClientRect(),i=e.clientX,n=e.clientY;i<t.right&&i>t.left&&n<t.bottom&&n>t.top?(s.mouseOverCanvas=!0,s._focusOnlyIfClick||s.isFocused||a.div.focus()):(s.mouseOverCanvas=!1,s._focusOnlyIfClick||a.div.blur())}),a.div.onmousedown=function(e){return s.mouse.buttons[e.button]=!0,null!=s._mouseHandlers[2+e.button]&&s._mouseHandlers[2+e.button](e),!1},a.div.onmouseup=function(e){return s.mouse.buttons[e.button]=!1},document.addEventListener("pointerlockchange",function(){document.pointerLockElement===a.div?s.pointerLocked=!0:s.pointerLocked=!1},!1)}}return u()(n,[{key:"clickForFocus",value:function(e){e=e||!this._focusOnlyIfClick,this._focusOnlyIfClick=e}},{key:"setSensitivity",value:function(e){this.mouse.sensitivity=e}},{key:"rebindDefaultBrowserActions",value:function(e){e=e||!this._rebind,this._rebind=e}},{key:"globalRebind",value:function(e){e=e||!this._globalRebind,this._globalRebind=e}},{key:"addOnFocusHandler",value:function(e){this._focusHandlers.push(e)}},{key:"addOnBlurHandler",value:function(e){this._blurHandlers.push(e)}},{key:"onKeyDown",value:function(e,t){this._handlers[e]=t}},{key:"onMouseDown",value:function(e,t){this._mouseHandlers[2+e]=t}},{key:"onMouseMove",value:function(e){this.engine.div.addEventListener("mousemove",e,!1)}},{key:"onContextMenu",value:function(e){this.engine.div.oncontextmenu=e}},{key:"lockPointer",value:function(e){e=e||!this._lockPointer,this._lockPointer=e}}]),n}();var Z=function(){function t(e){l()(this,t),(e.debugger=this).logArray=[],this.element=null}return u()(t,[{key:"setElement",value:function(e){this.element=e}},{key:"addLog",value:function(e,t){this.logArray.push({view:e,output:t}),this.addView(e)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"addView",value:function(e){this.element.appendChild(e)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(e){e.view.innerText=e.output(e)})}},{key:"logObject",value:function(e){var t="{\n";for(var i in e)"_"!=i[0]&&(t+=i+": "+e[i]+",");return t.slice(-1,1),t+="}\n"}}]),t}(),q=function(){function e(){l()(this,e),this.color=new Uint8Array([255,255,255,255]),this._textureBlockLocation=null,this.onTextureLoad=[],this.loaded=!1,this.textures={positiveX:null,negativeX:null,positiveY:null,negativeY:null,positiveZ:null,negativeZ:null},this._loadedTextureCount=0}return u()(e,[{key:"setImagesFromPath",value:function(e,t,i,n,r,o){var a=this;this.textures.positiveX=new Image,this.textures.positiveX.crossOrigin="",this.textures.positiveX.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())},this.textures.positiveX.src=e,this.textures.negativeX=new Image,this.textures.negativeX.crossOrigin="",this.textures.negativeX.src=t,this.textures.negativeX.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())},this.textures.positiveY=new Image,this.textures.positiveY.crossOrigin="",this.textures.positiveY.src=i,this.textures.positiveY.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())},this.textures.negativeY=new Image,this.textures.negativeY.crossOrigin="",this.textures.negativeY.src=n,this.textures.negativeY.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())},this.textures.positiveZ=new Image,this.textures.positiveZ.crossOrigin="",this.textures.positiveZ.src=r,this.textures.positiveZ.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())},this.textures.negativeZ=new Image,this.textures.negativeZ.crossOrigin="",this.textures.negativeZ.src=o,this.textures.negativeZ.onload=function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}}},{key:"setLoadingImages",value:function(e,t,i,n,r,o){for(var a=this,s=0;s<arguments.length-1;s++)if(arguments[s].width!=arguments[s].height||arguments[s].height!=arguments[s+1].height||arguments[s+1].width!=arguments[s+1].height)throw"Sizes of textures not are the same or texture isnt square.";this.textures.positiveX=this.engine.noTexture,e.addEventListener("load",function(){a.textures.positiveX=e,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}),this.textures.negativeX=this.engine.noTexture,t.addEventListener("load",function(){a.textures.negativeX=t,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}),this.textures.positiveY=this.engine.noTexture,i.addEventListener("load",function(){a.textures.positiveY=i,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}),this.textures.negativeY=this.engine.noTexture,n.addEventListener("load",function(){a.textures.negativeY=n,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}),this.textures.positiveZ=this.engine.noTexture,r.addEventListener("load",function(){a.textures.positiveZ=r,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())}),this.textures.negativeZ=this.engine.noTexture,o.addEventListener("load",function(){a.textures.negativeZ=o,a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(e){e(a)}),a.bindCubeTexture())})}},{key:"setLoadedImages",value:function(e,t,i,n,r,o){this.textures.positiveX=e,this.textures.negativeX=t,this.textures.positiveY=i,this.textures.negativeY=n,this.textures.positiveZ=r,this.textures.negativeZ=o,this.loaded=!0,this.bindCubeTexture()}},{key:"setSize",value:function(e,t){this.width=e,this.height=t}},{key:"scale",value:function(e,t){this.width=width*e,this.height=height*t}},{key:"setCoords",value:function(e){this.coords=e}},{key:"setColorRGBA",value:function(e,t,i,n){this.color=new Uint8Array([e,t,i,n])}},{key:"bind",value:function(e){this.engine=e,this.engine.textures.push(this),this.webGL=e.webGL,this._textureBlockLocation=this.engine.textures.length,this._WebGLTexture=this.engine.webGL.createTexture(),this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this.engine.webGL.bindTexture(this.engine.webGL.TEXTURE_2D,this._WebGLTexture),this.engine.webGL.texImage2D(this.engine.webGL.TEXTURE_2D,0,this.engine.webGL.RGBA,1,1,0,this.engine.webGL.RGBA,this.engine.webGL.UNSIGNED_BYTE,this.color)}},{key:"bindCubeTexture",value:function(){this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this._WebGLTexture=this.webGL.createTexture(),this.webGL.bindTexture(this.webGL.TEXTURE_CUBE_MAP,this._WebGLTexture),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveZ),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeZ),this.webGL.generateMipmap(this.webGL.TEXTURE_CUBE_MAP),this.webGL.texParameteri(this.webGL.TEXTURE_CUBE_MAP,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR_MIPMAP_LINEAR),this.engine.textureLoaded(this)}}]),e}(),Q=i(6),K=i.n(Q),J=function(e){function h(e,t,i,n){var r;if(l()(this,h),(r=I()(this,M()(h).call(this))).engine=e,r.webGL=e.webGL,r.background=t||"rgba(0, 0, 0, 0)",r.quality=i||r.engine.reflectionQuality,n)r.reflectionAlpha=n;else{var o=t.replace("rgba(","");alpha.replace(")",""),o=alpha.split(","),r.reflectionAlpha=o[3]}r.reflectionAlpha<1?r.alpha=!0:r.alpha=!1,r._object=null;var a=document.createElement("canvas");a.width=16,a.height=16;var s=a.getContext("2d");return s.fillStyle=t,s.fillRect(0,0,16,16),r._WebGLTexture=r.webGL.createTexture(),r.webGL.bindTexture(r.webGL.TEXTURE_CUBE_MAP,r._WebGLTexture),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_POSITIVE_X,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.texImage2D(r.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r.webGL.RGBA,r.webGL.RGBA,r.webGL.UNSIGNED_BYTE,a),r.webGL.generateMipmap(r.webGL.TEXTURE_CUBE_MAP),r.webGL.texParameteri(r.webGL.TEXTURE_CUBE_MAP,r.webGL.TEXTURE_MIN_FILTER,r.webGL.LINEAR_MIPMAP_LINEAR),r.engine.textureLoaded(K()(r)),r.engine.addOnTexturesLoaded(function(){null!=r.object&&r.generate()}),r.camera=new W,r.camera.fieldOfViewRad=r.engine.camera.fieldOfViewRad,r.camera.range=r.engine.camera.range,r}return D()(h,e),u()(h,[{key:"generate",value:function(){this.camera.position=this.object.position,this.camera.setRotation(0,270,0);var e=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.camera.setRotation(0,90,0);var t=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.camera.setRotation(-90,0,0);var i=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.camera.setRotation(90,0,0);var n=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.camera.setRotation(0,0,0);var r=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.camera.setRotation(0,180,0);var o=this.engine.captureFrame(this.camera,{backgroundColor:this.background,width:this.quality,height:this.quality,imageAlpha:this.reflectionAlpha,noDrawObjects:[this.object]});this.bind(this.engine),this.setLoadedImages(e,t,n,i,r,o)}},{key:"bindCubeTexture",value:function(){this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this._WebGLTexture=this.webGL.createTexture(),this.webGL.bindTexture(this.webGL.TEXTURE_CUBE_MAP,this._WebGLTexture),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveZ),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeZ),this.webGL.generateMipmap(this.webGL.TEXTURE_CUBE_MAP),this.webGL.texParameteri(this.webGL.TEXTURE_CUBE_MAP,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR_MIPMAP_LINEAR)}},{key:"object",get:function(){return this._object},set:function(e){this._object=e,this.engine.texturesLoaded&&this.generate()}}]),h}(q),$=function(){function t(e){l()(this,t),e&&e.addObject(this),this.engine=e,this.camera=e.camera,this.webGL=e.webGL,this.shaderProgram=e.shaders.default,this.position=[0,0,0],this.rotationPoint=[0,0,0],this.vertexes=[0,0,0,100,100,0,0,100,0,100,100,0,0,0,0,100,0,0],this.textureCoords=[0,1,1,0,0,0,1,0,0,1,1,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],this.texture=e.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null},this.UIElement=!1,this.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW),this.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW),this.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW),this._matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._world=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}return u()(t,[{key:"setTexture",value:function(e){this.texture=e}},{key:"useShader",value:function(e){this.shaderProgram=e}},{key:"setTextureRepeating",value:function(e,t){this.textureCoords=[0,t,e,0,0,0,e,0,0,t,e,t],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setSize",value:function(e,t){this.width=e,this.height=t,this.vertexes=[0,0,0,e,t,0,0,t,0,e,t,0,0,0,0,e,0,0],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(e,t,i){this.position=[e,t,i]}},{key:"scale",value:function(e,t,i){this.scale=[e,t,i]}},{key:"rotate",value:function(e,t,i){var n=a(e),r=a(t),o=a(i);this.rotationDeg=[e,t,i],this.rotation=[n,r,o]}},{key:"setParentRotation",value:function(e,t,i){this.parentRotation=[e,t,i]}},{key:"setRotationPoint",value:function(e,t,i){this.rotationPoint=[e,t,i]}},{key:"setNormals",value:function(e){this.normals=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"setNormal",value:function(e){this.normals=[e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"autoGenerateNormals",value:function(){var e=[0,0,1],t=_(this.rotationDeg[0]);e=A(t=T(t=T(t,y(this.rotationDeg[1])),E(this.rotationDeg[2])),e),this.normals=[e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"setAsUIElement",value:function(e){this.UIElement=e}},{key:"draw",value:function(){this.shaderProgram.use(),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.texcoordLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.coordsBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.texcoordLocation,2,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.normalBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.objectRotationLocation,!1,this._world),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"update",value:function(){var e=new c;this.UIElement?e.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(e.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),e.multiply(this.engine.camera.inverseMatrix));var t=new c;t.multiply(G(b(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),t.translate(this.position[0],this.position[1],this.position[2]);var i=x(v(this.rotation[0]),w(this.rotation[1]));i=x(i,L(this.rotation[2]));var n=x(v(this.parentRotation[0]),w(this.parentRotation[1]));i=x(n=x(n,L(this.parentRotation[2])),this._world=i),t.multiply(i),t.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),t.scale(this.scaling[0],this.scaling[1],this.scaling[2]),e.multiply(t.matrix),this._matrix=e.matrix,this._rotationMatrix=i}},{key:"animate",value:function(e,t){t=t||this.animation,this._animationInterval=setInterval(t,1e3/e)}}]),t}(),ee=function(){function t(e){l()(this,t),e&&e.objects.push(this),this.engine=e,this.camera=e.camera,this.webGL=e.webGL,this.shaderProgram=e.shaders.cube,this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0],this.vertexes=[-100,-100,-100,-100,100,-100,100,-100,-100,-100,100,-100,100,100,-100,100,-100,-100,-100,-100,100,100,-100,100,-100,100,100,-100,100,100,100,-100,100,100,100,100,-100,100,-100,-100,100,100,100,100,-100,-100,100,100,100,100,100,100,100,-100,-100,-100,-100,100,-100,-100,-100,-100,100,-100,-100,100,100,-100,-100,100,-100,100,-100,-100,-100,-100,-100,100,-100,100,-100,-100,-100,100,-100,100,100,-100,100,-100,100,-100,-100,100,100,-100,100,-100,100,100,-100,100,100,100,-100,100,100,100],this.normals=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],this.texture=e.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null},this.UIElement=!1,this.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW),this.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW),this._matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._rotationMatrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}return u()(t,[{key:"useShader",value:function(e){this.shaderProgram=e}},{key:"setTexture",value:function(e){(this.texture=e).object=this}},{key:"setSize",value:function(e,t,i){this.width=e,this.height=t,this.depth=i,this.vertexes=[-e,-t,-i,-e,t,-i,e,-t,-i,-e,t,-i,e,t,-i,e,-t,-i,-e,-t,i,e,-t,i,-e,t,i,-e,t,i,e,-t,i,e,t,i,-e,t,-i,-e,t,i,e,t,-i,-e,t,i,e,t,i,e,t,-i,-e,-t,-i,e,-t,-i,-e,-t,i,-e,-t,i,e,-t,-i,e,-t,i,-e,-t,-i,-e,-t,i,-e,t,-i,-e,-t,i,-e,t,i,-e,t,-i,e,-t,-i,e,t,-i,e,-t,i,e,-t,i,e,t,-i,e,t,i],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(e,t,i){this.position=[e,t,i]}},{key:"scale",value:function(e,t,i){this.scale=[e,t,i]}},{key:"setRotate",value:function(e,t,i){var n=a(e),r=a(t),o=a(i);this.rotation=[n,r,o]}},{key:"rotate",value:function(e,t,i){var n=a(e),r=a(t),o=a(i);this.rotation[0]+=n,this.rotation[1]+=r,this.rotation[2]+=o}},{key:"setParentRotation",value:function(e,t,i){this.parentRotation=[e,t,i]}},{key:"setRotationPoint",value:function(e,t,i){this.rotationPoint=[e,t,i]}},{key:"setNormals",value:function(e){this.normals=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"setAsUIElement",value:function(e){this.UIElement=e}},{key:"animate",value:function(e,t){t=t||this.animation,this._animationInterval=setInterval(t,1e3/e)}},{key:"draw",value:function(){this.shaderProgram.use(),this.webGL.uniform3fv(this.shaderProgram.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaderProgram.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.engine.camera.matrix),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.normalBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.worldLocation,!1,this._rotationMatrix),this.engine.webGL.uniform3fv(this.shaderProgram.worldCameraPositionLocation,new Float32Array(this.engine.camera.position)),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"update",value:function(){var e=new c;this.UIElement?e.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(e.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),e.multiply(this.engine.camera.inverseMatrix));var t=new c;t.multiply(G(b(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),t.translate(this.position[0],this.position[1],this.position[2]);var i=x(v(this.rotation[0]),w(this.rotation[1]));i=x(i,L(this.rotation[2]));var n=x(v(this.parentRotation[0]),w(this.parentRotation[1]));i=x(n=x(n,L(this.parentRotation[2])),i),t.multiply(i),this._rotationMatrix=i,t.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),t.scale(this.scaling[0],this.scaling[1],this.scaling[2]),this._world=t,e.multiply(t.matrix),this._matrix=e.matrix,this._rotationMatrix=i}},{key:"useMaterial",value:function(e){var t=this;this._draw=this.draw,(e.object=this).draw=function(){e.drawCube(t)}}}]),t}(),te=function(){function t(e){l()(this,t),e.objects.push(this),this.engine=e,this.shaderProgram=e.shaders.default,this.webGL=e.webGL,this.camera=e.camera,this.texture=e.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.faces=[],this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null}}return u()(t,[{key:"useShader",value:function(e){this.shaderProgram=e}},{key:"setTexture",value:function(e){((this.texture=e).object=this).alpha=e.alpha||!1}},{key:"setPosition",value:function(e,t,i){this.UIElement?(this.position[0]=this.engine.width/2*e/100,this.position[1]=this.engine.height/2*t/100):(this.position[0]=e,this.position[1]=t),this.position[2]=i}},{key:"move",value:function(e,t,i){this.position[0]+=e,this.position[1]+=t,this.position[2]+=i}},{key:"moveRelativeToTheCamera",value:function(e,t,i){var n=[e,t,i,1];n=m(this.camera.inventedMatrix,n),this.position[0]+=n[0],this.position[1]+=n[1],this.position[2]+=n[2]}},{key:"rotate",value:function(e,t,i){this.rotation[0]+=e,this.rotation[1]+=t,this.rotation[2]+=i}},{key:"setRotation",value:function(e,t,i){this.rotation[0]=a(e),this.rotation[1]=a(t),this.rotation[2]=a(i)}},{key:"setRotationPoint",value:function(e,t,i){this.rotationPoint=[e,t,i]}},{key:"setParentRotation",value:function(e,t,i){this.parentRotation=[e,t,i]}},{key:"scale",value:function(e,t,i){this.scaling=[e,t,i]}},{key:"getSize",value:function(){var e=[0,0,0];return e[0]=r(this.maxSizes.x.smallest-this.maxSizes.x.biggest),e[1]=r(this.maxSizes.y.smallest-this.maxSizes.y.biggest),e[2]=r(this.maxSizes.z.smallest-this.maxSizes.z.biggest),e}},{key:"scaleToPixels",value:function(e,t,i){this.scaling=[e/this.size[0],t/this.size[1],i/this.size[2]]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(e,t){t=t||this.animation,setInterval(t,1e3/e)}},{key:"destroy",value:function(){this.engine.splice(this.engine.objects.indexOf(this),1)}},{key:"compile",value:function(e){var l=this,f=[],d=[],m=[],t=e.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};this.faceCount=0,t.forEach(function(e){for(var c=e.split(" "),t=c.length;t--;)""!=c[t]&&"\r"!=c[t]||c.splice(t,1);if("v"==c[0]){var i=parseFloat(c[1]),n=parseFloat(c[2]),r=parseFloat(c[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<n&&(s.y[1]=n),s.z[1]<r&&(s.z[1]=r),s.x[0]>i&&(s.x[0]=i),s.y[0]>n&&(s.y[0]=n),s.z[0]>r&&(s.z[0]=r),f.push([i,n,r])}else if("vn"==c[0])m.push([parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])]);else if("vt"==c[0])d.push([parseFloat(c[1]),parseFloat(c[2])]);else if("f"==c[0]){l.faceCount++;for(var o=function(e){var t=c[e].split("/");if("\r"==t[length-1])return"break";for(var i=null,n=null,r=void 0,o=0;o<l.faces.length;o++){var a=l.faces[o];a.vertexesCount==c.length-1&&(i=a.vertexes,n=a.textureCoords,r=a.normals)}null==i&&(l.faces.push({vertexesCount:c.length-1,vertexes:[],textureCoords:[],normals:[]}),i=l.faces[l.faces.length-1].vertexes,n=l.faces[l.faces.length-1].textureCoords,r=l.faces[l.faces.length-1].normals);var s=parseFloat(t[0]);s<0&&(s=f.length+s+1);var h=parseFloat(t[1]);h<0&&(h=d.length+h+1);var u=parseFloat(t[2]);u<0&&(u=m.length+u+1),f[s-1].forEach(function(e){i.push(e)}),0<d.length&&d[h-1].forEach(function(e){n.push(e)}),null!=t[2]?m[u-1].forEach(function(e){r.push(e)}):r.push(0,0,1)},a=1;a<c.length;a++){if("break"===o(a))break}}});for(var i=0;i<this.faces.length;i++){var n=this.faces[i];n.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.vertexes),this.webGL.STATIC_DRAW),n.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.textureCoords),this.webGL.STATIC_DRAW),n.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.normals),this.webGL.STATIC_DRAW)}this.maxSizes.x.smallest=s.x[0],this.maxSizes.x.biggest=s.x[1],this.maxSizes.y.smallest=s.y[0],this.maxSizes.y.biggest=s.y[1],this.maxSizes.z.smallest=s.z[0],this.maxSizes.z.biggest=s.z[1],this.collisionBoxes.push(s),this.size=this.getSize()}},{key:"loadFromObj",value:function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.onreadystatechange=function(){4==i.readyState&&(t.compile(i.responseText),t.onload())},i.send()}},{key:"draw",value:function(){var t=this;this.shaderProgram.use(),this.behindTheCamera||this.faces.forEach(function(e){t.engine.webGL.enableVertexAttribArray(t.shaderProgram.positionLocation),t.engine.webGL.bindBuffer(t.engine.webGL.ARRAY_BUFFER,e.vertexesBuffer),t.engine.webGL.vertexAttribPointer(t.shaderProgram.positionLocation,3,t.engine.webGL.FLOAT,!1,0,0),t.engine.webGL.enableVertexAttribArray(t.shaderProgram.texcoordLocation),t.engine.webGL.bindBuffer(t.engine.webGL.ARRAY_BUFFER,e.coordsBuffer),t.engine.webGL.vertexAttribPointer(t.shaderProgram.texcoordLocation,2,t.engine.webGL.FLOAT,!1,0,0),t.engine.webGL.enableVertexAttribArray(t.shaderProgram.normalLocation),t.engine.webGL.bindBuffer(t.engine.webGL.ARRAY_BUFFER,e.normalBuffer),t.engine.webGL.vertexAttribPointer(t.shaderProgram.normalLocation,3,t.engine.webGL.FLOAT,!1,0,0),t.engine.webGL.uniform1i(t.shaderProgram.textureLocation,t.texture._textureBlockLocation),t.engine.webGL.uniformMatrix4fv(t.shaderProgram.matrixLocation,!1,t._matrix),t.engine.webGL.uniformMatrix4fv(t.shaderProgram.objectRotationLocation,!1,t._rotationMatrix),t.engine.webGL.drawArrays(t.engine.webGL.TRIANGLES,0,e.vertexes.length/3),t.engine.drawCallsPerFrame++,t.engine.drawCalls++})}},{key:"update",value:function(){var d=this,m=new c;this.UIElement?m.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(m.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),m.multiply(this.engine.camera.inverseMatrix));var e=new c;e.multiply(G(b(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),e.translate(this.position[0],this.position[1],this.position[2]);var t=x(v(this.rotation[0]),w(this.rotation[1]));t=x(t,L(this.rotation[2]));var i=x(v(this.parentRotation[0]),w(this.parentRotation[1]));if(t=x(i=x(i,L(this.parentRotation[2])),t),e.multiply(t),this._rotationMatrix=t,e.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),e.scale(this.scaling[0],this.scaling[1],this.scaling[2]),this._world=e,m.multiply(e.matrix),!this.UIElement){var g=!1;this.collisionBoxes.forEach(function(e){for(var t=[],i=0;i<e.x.length;i++)for(var n=e.x[i],r=0;r<e.y.length;r++)for(var o=e.y[r],a=0;a<e.z.length;a++){var s=e.z[a],h=p(m.matrix,[n,o,s,1]);h[0]=h[0]/h[3],h[1]=h[1]/h[3],h[0]=(.5*h[0]+.5)*d.engine.width,h[1]=(-.5*h[1]+.5)*d.engine.height,h[0]=h[0]<0?0:h[0],h[1]=h[1]<0?0:h[1],h[0]=h[0]>d.engine.width?d.engine.width:h[0],h[1]=h[1]>d.engine.height?d.engine.height:h[1],0<=h[2]&&t.push(h)}for(var u=[1e4,1e4,-1e3],c=[-1e4,-1e4],l=0;l<t.length;l++){var f=t[l];f[0]<u[0]?u[0]=f[0]:f[0]>c[0]&&(c[0]=f[0]),f[1]<u[1]?u[1]=f[1]:f[1]>c[1]&&(c[1]=f[1]),f[2]>u[2]&&(u[2]=f[2])}d.relativeCameraPosition={x:{left:u[0],right:c[0]},y:{top:u[1],bottom:c[1]},depth:u[2]},d.relativeCameraPosition.x.left>=d.engine.width||d.relativeCameraPosition.x.right<=0||d.relativeCameraPosition.y.top>=d.engine.height||d.relativeCameraPosition.x.bottom<=0?d.behindTheCamera=!0:d.behindTheCamera=!1,d.engine.controls.mouse.x>u[0]&&d.engine.controls.mouse.x<c[0]&&d.engine.controls.mouse.y>u[1]&&d.engine.controls.mouse.y<c[1]&&(g=!0),g&&(null==d.engine.selectedObject&&(d.engine.selectedObject=d),d.engine.selectedObject.relativeCameraPosition.depth>=u[2]&&(d.engine.selectedObject=d))})}this._matrix=m.matrix,this._rotationMatrix=t}},{key:"useMaterial",value:function(e){var t=this;this._draw=this.draw,(e.object=this).draw=function(){e.drawObject(t)}}}]),t}(),ie=function(e){function i(e){var t;return l()(this,i),(t=I()(this,M()(i).call(this,e))).shaderProgram=t.engine.shaders.grid,t.cellSize=[1e3,1e3],t}return D()(i,e),u()(i,[{key:"draw",value:function(){this.shaderProgram.use(),this.engine.webGL.texParameteri(this.engine.webGL.TEXTURE_2D,this.engine.shaders.extensions.anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,16),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.texcoordLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.coordsBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.texcoordLocation,2,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.uniform2fv(this.shaderProgram.movingLocation,this._moving),this.engine.webGL.uniform2fv(this.shaderProgram.cellSizeLocation,this.cellSize),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"update",value:function(){var e=new c;e.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range);var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t=x(t=x(t,b(0,this.engine.camera.position[1],0)),this.engine.camera.rotationMatrix),e.multiply(G(t));var i=new c;i.multiply(G(b(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),i.translate(this.position[0],this.position[1],this.position[2]);var n=x(v(this.rotation[0]),w(this.rotation[1]));n=x(n,L(this.rotation[2]));var r=x(v(this.parentRotation[0]),w(this.parentRotation[1]));n=x(r=x(r,L(this.parentRotation[2])),n),i.multiply(n),i.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),i.scale(this.scaling[0],this.scaling[1],this.scaling[2]),this._world=i,e.multiply(i.matrix),this._moving=[this.engine.camera.position[0],this.engine.camera.position[2]],this._matrix=e.matrix,this._rotationMatrix=n}},{key:"setCellSize",value:function(e,t){this.cellSize=[e,t],this.setTextureRepeating(this.width/e,this.height/t)}},{key:"setSize",value:function(e,t){this.width=e,this.height=t,this.vertexes=[0,0,0,e,t,0,0,t,0,e,t,0,0,0,0,e,0,0],this.setCellSize(this.cellSize[0],this.cellSize[1]),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}}]),i}($),ne=function(){function t(e){l()(this,t),this.engine=e,this.objects=[],this.lands=[],this.camera}return u()(t,[{key:"createObject",value:function(){var e=new te(engine);return this.engine.objects.push(e),e}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"removeObject",value:function(e){var t=this.objects.indexOf(e);return-1!=t&&(this.objects.splice(t,1),!0)}},{key:"removeObjectByName",value:function(t){var i=this;return this.objects.forEach(function(e){if(e.name==t)return i.removeObject(e),!0}),!1}}]),t}(),re=function(){function t(e){l()(this,t),this.canvas=document.createElement("canvas"),this.canvas.width=e.div.width,this.canvas.height=e.div.height,this.canvas.style="position: absolute; height: 100%; width: 100%; z-index: 999999; left: 0; right: 0; top: 0;",this.div=document.createElement("div"),this.div.style="position: absolute; height: 100%; width: 100%; z-index: 999999; left: 0; right: 0; top: 0;",e.div.appendChild(this.canvas),e.div.appendChild(this.div),this.context=this.canvas.getContext("2d"),this.elements=[],e.ui=this}return u()(t,[{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.elements.indexOf(e);this.elements.removeAt(t)}},{key:"appendDOMElement",value:function(e,t){var i="";for(var n in t)i+=n+":  "+t[n]+";";e.style=i,this.div.appendChild(e)}},{key:"_draw",value:function(){this.elements.forEach(function(e){e.draw()})}}]),t}(),oe=function(e){function n(e,t){var i;return l()(this,n),(i=I()(this,M()(n).call(this,e,t))).shaderProgram=e.shaders.reflection,i}return D()(n,e),u()(n,[{key:"setShaderProgram",value:function(e){this.shaderProgram=e}},{key:"drawCube",value:function(e){this.shaderProgram.use(),this.webGL.uniform3fv(this.shaderProgram.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaderProgram.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.engine.camera.matrix),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,e.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,e.normalBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,e.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,e._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.rotationMatrixLocation,!1,e._rotationMatrix),this.engine.webGL.uniform3fv(this.shaderProgram.worldCameraPositionLocation,new Float32Array(this.engine.camera.position)),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,e.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"drawObject",value:function(e){var t=this;this.shaderProgram.use(),this.webGL.uniform3fv(this.shaderProgram.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaderProgram.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.engine.camera.matrix),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,e.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,e._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.rotationMatrixLocation,!1,e._rotationMatrix),this.engine.webGL.uniform3fv(this.shaderProgram.worldCameraPositionLocation,new Float32Array(this.engine.camera.position)),e.behindTheCamera||e.faces.forEach(function(e){t.engine.webGL.enableVertexAttribArray(t.shaderProgram.positionLocation),t.engine.webGL.bindBuffer(t.engine.webGL.ARRAY_BUFFER,e.vertexesBuffer),t.engine.webGL.vertexAttribPointer(t.shaderProgram.positionLocation,3,t.engine.webGL.FLOAT,!1,0,0),t.engine.webGL.enableVertexAttribArray(t.shaderProgram.normalLocation),t.engine.webGL.bindBuffer(t.engine.webGL.ARRAY_BUFFER,e.normalBuffer),t.engine.webGL.vertexAttribPointer(t.shaderProgram.normalLocation,3,t.engine.webGL.FLOAT,!1,0,0),t.engine.webGL.drawArrays(t.engine.webGL.TRIANGLES,0,e.vertexes.length/3),t.engine.drawCallsPerFrame++,t.engine.drawCalls++})}}]),n}(function(){function i(e,t){l()(this,i),this.engine=e,this.object=t||null,this.webGL=e.webGL}return u()(i,[{key:"setShaderProgram",value:function(e){this.shaderProgram=e}},{key:"drawObject",value:function(e){}}]),i}());i.d(t,"radToDeg",function(){return n}),i.d(t,"degToRad",function(){return a}),i.d(t,"isPowerOf2",function(){return o}),i.d(t,"abs",function(){return r}),i.d(t,"Matrix",function(){return c}),i.d(t,"unit",function(){return f}),i.d(t,"translation",function(){return b}),i.d(t,"rotationX",function(){return v}),i.d(t,"rotationY",function(){return w}),i.d(t,"rotationZ",function(){return L}),i.d(t,"scaling",function(){return d}),i.d(t,"multiply",function(){return x}),i.d(t,"vec3Multiply",function(){return m}),i.d(t,"transformVector",function(){return p}),i.d(t,"inverse",function(){return G}),i.d(t,"normalize",function(){return g}),i.d(t,"rotationX",function(){return _}),i.d(t,"rotationY",function(){return y}),i.d(t,"rotationZ",function(){return E}),i.d(t,"vecMultiply",function(){return A}),i.d(t,"multiply",function(){return T}),i.d(t,"Engine",function(){return X}),i.d(t,"Camera",function(){return W}),i.d(t,"Controls",function(){return H}),i.d(t,"Debugger",function(){return Z}),i.d(t,"SimpleTexture",function(){return N}),i.d(t,"CubeTexture",function(){return q}),i.d(t,"ReflectionTexture",function(){return J}),i.d(t,"Rect",function(){return $}),i.d(t,"Cube",function(){return ee}),i.d(t,"Object",function(){return te}),i.d(t,"Grid",function(){return ie}),i.d(t,"Map",function(){return ne}),i.d(t,"UI",function(){return re}),i.d(t,"Glass",function(){return oe})}])});