!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Bronze",[],e):"object"==typeof exports?exports.Bronze=e():t.Bronze=e()}(window,function(){return function(i){var n={};function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=i,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist",r(r.s=16)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(e,t){function i(t){return e.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}e.exports=i},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ShaderProgram});var _babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_1__),ShaderProgram=function(){function ShaderProgram(t){return _babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default()(this,ShaderProgram),this.webGL=t,this.VERTEX_SHADER="vertex",this.FRAGMENT_SHADER="fragment",this.ATTRIBUTE="attribute",this.UNIFORM="uniform",this}return _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_1___default()(ShaderProgram,[{key:"addShader",value:function(t,e){var i;switch(t){case"vertex":i=this.webGL.createShader(this.webGL.VERTEX_SHADER),this.vertexShader=i;break;case"fragment":i=this.webGL.createShader(this.webGL.FRAGMENT_SHADER),this.fragmentShader=i;break;default:throw new BronzeShaderException("Wrong shader type")}if(this.webGL.shaderSource(i,e),this.webGL.compileShader(i),!this.webGL.getShaderParameter(i,this.webGL.COMPILE_STATUS))throw console.error(this.webGL.getShaderInfoLog(i)),"Could not compile shader:"}},{key:"create",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.webGL.createProgram();return this.webGL.attachShader(e,this.vertexShader),this.webGL.attachShader(e,this.fragmentShader),this.webGL.linkProgram(e),this.webGL.useProgram(e),t&&(this.webGL.deleteShader(this.vertexShader),this.webGL.deleteShader(this.fragmentShader)),this.program=e}},{key:"linkVariable",value:function linkVariable(type,name,customName){switch(customName=customName||name,type){case this.ATTRIBUTE:eval("this."+customName+" = this.webGL.getAttribLocation(this.program, "+name+")");break;case this.UNIFORM:eval("this."+customName+" = this.webGL.getUniformLocation(this.program, "+name+")");break;default:throw"Wrong variable type"}eval("return this."+customName)}},{key:"linkAttribute",value:function linkAttribute(name,customName){return customName=customName||name,eval("this."+customName+" = this.webGL.getAttribLocation(this.program, '"+name+"')"),eval("this."+customName)}},{key:"linkUniform",value:function linkUniform(name,customName){return customName=customName||name,eval("this."+customName+" = this.webGL.getUniformLocation(this.program, '"+name+"')"),eval("this."+customName)}},{key:"use",value:function(){this.webGL.useProgram(this.program)}},{key:"useIn",value:function(t){t.useProgram(this.program)}}]),ShaderProgram}(),BronzeShaderException=function t(e){_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default()(this,t),this.message=e,this.name="Bronze shader error"}},function(t,e,i){var n=i(12),r=i(13);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?r(t):e}},function(t,e,i){var n=i(6);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(i,t){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}i.exports=n},function(t,e,i){t.exports=i(10)},function(t,e){function h(t,e,i,n,r,o,a){try{var s=t[o](a),h=s.value}catch(t){return void i(t)}s.done?e(h):Promise.resolve(h).then(n,r)}t.exports=function(s){return function(){var t=this,a=arguments;return new Promise(function(e,i){var n=s.apply(t,a);function r(t){h(n,e,i,r,o,"next",t)}function o(t){h(n,e,i,r,o,"throw",t)}r(void 0)})}}},function(e,t,i){var n=i(2),r=i(6),o=i(14),a=i(15);function s(t){var i="function"==typeof Map?new Map:void 0;return e.exports=s=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return a(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},s(t)}e.exports=s},function(t,e,i){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),o=r&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=i(11),r)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},function(C,t){!function(t){"use strict";var h,e=Object.prototype,u=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag",a="object"==typeof C,s=t.regeneratorRuntime;if(s)a&&(C.exports=s);else{(s=t.regeneratorRuntime=a?C.exports:{}).wrap=p;var l="suspendedStart",f="suspendedYield",m="executing",d="completed",g={},c={};c[r]=function(){return this};var v=Object.getPrototypeOf,b=v&&v(v(P([])));b&&b!==e&&u.call(b,r)&&(c=b);var w=y.prototype=x.prototype=Object.create(c);L.prototype=w.constructor=y,y.constructor=L,y[o]=L.displayName="GeneratorFunction",s.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===L||"GeneratorFunction"===(e.displayName||e.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(w),t},s.awrap=function(t){return{__await:t}},G(E.prototype),E.prototype[n]=function(){return this},s.AsyncIterator=E,s.async=function(t,e,i,n){var r=new E(p(t,e,i,n));return s.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},G(w),w[o]="Generator",w[r]=function(){return this},w.toString=function(){return"[object Generator]"},s.keys=function(i){var n=[];for(var t in i)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},s.values=P,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=h)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function t(t,e){return o.type="throw",o.arg=i,n.next=t,e&&(n.method="next",n.arg=h),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=u.call(r,"catchLoc"),s=u.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),T(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;T(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:P(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=h),g}}}function p(t,e,i,n){var o,a,s,h,r=e&&e.prototype instanceof x?e:x,u=Object.create(r.prototype),c=new k(n||[]);return u._invoke=(o=t,a=i,s=c,h=l,function(t,e){if(h===m)throw new Error("Generator is already running");if(h===d){if("throw"===t)throw e;return B()}for(s.method=t,s.arg=e;;){var i=s.delegate;if(i){var n=R(i,s);if(n){if(n===g)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(h===l)throw h=d,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);h=m;var r=_(o,a,s);if("normal"===r.type){if(h=s.done?d:f,r.arg===g)continue;return{value:r.arg,done:s.done}}"throw"===r.type&&(h=d,s.method="throw",s.arg=r.arg)}}),u}function _(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function x(){}function L(){}function y(){}function G(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function E(h){var e;this._invoke=function(i,n){function t(){return new Promise(function(t,e){!function e(t,i,n,r){var o=_(h[t],h,i);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,n,r)},function(t){e("throw",t,n,r)}):Promise.resolve(s).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,r)})}r(o.arg)}(i,n,t,e)})}return e=e?e.then(t,t):t()}}function R(t,e){var i=t.iterator[e.method];if(i===h){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=h,R(t,e),"throw"===e.method))return g;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var n=_(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,g;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=h),e.delegate=null,g):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function P(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(u.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=h,t.done=!0,t};return n.next=n}}return{next:B}}function B(){return{value:h,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(n,t,e){var o=e(6);function r(t,e,i){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?n.exports=r=function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&o(r,i.prototype),r}:n.exports=r=Reflect.construct,r.apply(null,arguments)}n.exports=r},function(t,e,i){"use strict";function n(t){return 180*t/Math.PI}function a(t){return t*Math.PI/180}function o(t){return 0==(t&t-1)}function r(t){return Math.abs(t)}i.r(e);var s=i(0),l=i.n(s),h=i(1),u=i.n(h),c=function(){function t(){return l()(this,t),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return u()(t,[{key:"perspective",value:function(t,e,i,n,r){var o=Math.tan(.5*Math.PI-.5*t),a=1/(n-r);return this.matrix=[o/(e/i),0,0,0,0,o,0,0,0,0,(n+r)*a,-1,0,0,n*r*a*2,0],this}},{key:"projection",value:function(t,e,i,n,r){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1],this.matrix=[2/e,0,0,0,0,-2/i,0,0,0,0,2/r,0,0,0,0,1],this}},{key:"multiply",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],r=this.matrix[3],o=this.matrix[4],a=this.matrix[5],s=this.matrix[6],h=this.matrix[7],u=this.matrix[8],c=this.matrix[9],l=this.matrix[10],f=this.matrix[11],m=this.matrix[12],d=this.matrix[13],g=this.matrix[14],v=this.matrix[15],b=t[0],w=t[1],p=t[2],_=t[3],x=t[4],L=t[5],y=t[6],G=t[7],E=t[8],R=t[9],A=t[10],T=t[11],k=t[12],P=t[13],B=t[14],C=t[15];this.matrix=[b*e+w*o+p*u+_*m,b*i+w*a+p*c+_*d,b*n+w*s+p*l+_*g,b*r+w*h+p*f+_*v,x*e+L*o+y*u+G*m,x*i+L*a+y*c+G*d,x*n+L*s+y*l+G*g,x*r+L*h+y*f+G*v,E*e+R*o+A*u+T*m,E*i+R*a+A*c+T*d,E*n+R*s+A*l+T*g,E*r+R*h+A*f+T*v,k*e+P*o+B*u+C*m,k*i+P*a+B*c+C*d,k*n+P*s+B*l+C*g,k*r+P*h+B*f+C*v]}},{key:"multiply_",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],r=this.matrix[3],o=this.matrix[4],a=this.matrix[5],s=this.matrix[6],h=this.matrix[7],u=this.matrix[8],c=this.matrix[9],l=this.matrix[10],f=this.matrix[11],m=this.matrix[12],d=this.matrix[13],g=this.matrix[14],v=this.matrix[15],b=t[0],w=t[1],p=t[2],_=t[3],x=t[4],L=t[5],y=t[6],G=t[7],E=t[8],R=t[9],A=t[10],T=t[11],k=t[12],P=t[13],B=t[14],C=t[15];return[b*e+w*o+p*u+_*m,b*i+w*a+p*c+_*d,b*n+w*s+p*l+_*g,b*r+w*h+p*f+_*v,x*e+L*o+y*u+G*m,x*i+L*a+y*c+G*d,x*n+L*s+y*l+G*g,x*r+L*h+y*f+G*v,E*e+R*o+A*u+T*m,E*i+R*a+A*c+T*d,E*n+R*s+A*l+T*g,E*r+R*h+A*f+T*v,k*e+P*o+B*u+C*m,k*i+P*a+B*c+C*d,k*n+P*s+B*l+C*g,k*r+P*h+B*f+C*v]}},{key:"translate",value:function(t,e,i){this.multiply(v(t,e,i))}},{key:"translate_",value:function(t,e,i){return this.multiply_(v(t,e,i))}},{key:"rotateX",value:function(t){this.multiply(b(t))}},{key:"rotateY",value:function(t){this.multiply(w(t))}},{key:"rotateZ",value:function(t){this.multiply(p(t))}},{key:"scale",value:function(t,e,i){this.multiply(m(t,e,i))}}]),t}();function f(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function v(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}function b(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}function w(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}function p(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}function m(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}function _(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],h=t[6],u=t[7],c=t[8],l=t[9],f=t[10],m=t[11],d=t[12],g=t[13],v=t[14],b=t[15],w=e[0],p=e[1],_=e[2],x=e[3],L=e[4],y=e[5],G=e[6],E=e[7],R=e[8],A=e[9],T=e[10],k=e[11],P=e[12],B=e[13],C=e[14],F=e[15];return[w*i+p*a+_*c+x*d,w*n+p*s+_*l+x*g,w*r+p*h+_*f+x*v,w*o+p*u+_*m+x*b,L*i+y*a+G*c+E*d,L*n+y*s+G*l+E*g,L*r+y*h+G*f+E*v,L*o+y*u+G*m+E*b,R*i+A*a+T*c+k*d,R*n+A*s+T*l+k*g,R*r+A*h+T*f+k*v,R*o+A*u+T*m+k*b,P*i+B*a+C*c+F*d,P*n+B*s+C*l+F*g,P*r+B*h+C*f+F*v,P*o+B*u+C*m+F*b]}function d(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}function x(t,e){for(var i=new Float32Array(4),n=0;n<4;++n)for(var r=i[n]=0;r<4;++r)i[n]+=e[r]*t[4*r+n];return i}function L(t){var e=new Float32Array(16),i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],h=t[6],u=t[7],c=t[8],l=t[9],f=t[10],m=t[11],d=t[12],g=t[13],v=t[14],b=t[15],w=f*b,p=v*m,_=h*b,x=v*u,L=h*m,y=f*u,G=r*b,E=v*o,R=r*m,A=f*o,T=r*u,k=h*o,P=c*g,B=d*l,C=a*g,F=d*s,S=a*l,U=c*s,I=i*g,M=d*n,O=i*l,D=c*n,j=i*s,N=a*n,z=w*s+x*l+L*g-(p*s+_*l+y*g),Y=p*n+G*l+A*g-(w*n+E*l+R*g),X=_*n+E*s+T*g-(x*n+G*s+k*g),W=y*n+R*s+k*l-(L*n+A*s+T*l),V=1/(i*z+a*Y+c*X+d*W);return e[0]=V*z,e[1]=V*Y,e[2]=V*X,e[3]=V*W,e[4]=V*(p*a+_*c+y*d-(w*a+x*c+L*d)),e[5]=V*(w*i+E*c+R*d-(p*i+G*c+A*d)),e[6]=V*(x*i+G*a+k*d-(_*i+E*a+T*d)),e[7]=V*(L*i+A*a+T*c-(y*i+R*a+k*c)),e[8]=V*(P*u+F*m+S*b-(B*u+C*m+U*b)),e[9]=V*(B*o+I*m+D*b-(P*o+M*m+O*b)),e[10]=V*(C*o+M*u+j*b-(F*o+I*u+N*b)),e[11]=V*(U*o+O*u+N*m-(S*o+D*u+j*m)),e[12]=V*(C*f+U*v+B*h-(S*v+P*h+F*f)),e[13]=V*(O*v+P*r+M*f-(I*f+D*v+B*r)),e[14]=V*(I*h+N*v+F*r-(j*v+C*r+M*h)),e[15]=V*(j*f+S*r+D*h-(O*h+N*f+U*r)),e}function g(t){var e=new Float32Array(3),i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return 1e-5<i&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i,e)}var y=i(7),G=i.n(y),E=i(8),R=i.n(E);var A,T=i(4),k=i.n(T),P=i(2),B=i.n(P),C=i(5),F=i.n(C),S=i(9),U=function(t){function r(t,e,i){var n;return l()(this,r),(n=k()(this,B()(r).call(this))).src=t,null!=e&&null!=i&&(n.width=e,n.height=i),n.coords=[],n.addEventListener("load",function(){n.loaded=!0}),n.color=new Uint8Array([255,255,255,255]),n._textureBlockLocation=null,n.mipmapFilter="LINEAR",n.mipmap=[],n.mips=null,n.onTextureLoad=[],n.alpha=!1,n}return F()(r,t),u()(r,[{key:"generateMipmap",value:function(t){this.mips=t}},{key:"logImage",value:function(t,e,i){var n=new Image;n.onload=function(){console.log("%c+","padding: "+Math.floor(e/2)+"px "+Math.floor(i/2)+"px; line-height: "+e+"px;background: url("+n+"); background-size: "+i+"px "+e+"px; color: transparent;")},n.src=t.toDataURL()}},{key:"autoGenerateMipmap",value:function(t){t._autoGenerateMipmap=!0}},{key:"quickGenerateMipmap",value:function(t){if(t.width/t.height!=2)return console.warn("Wrong image sizes for quick generation mipmap.");for(var e=t.height,i=0;;){var n=document.createElement("canvas");if(n.width=e,n.height=e,n.getContext("2d").drawImage(t,i,0,e,e,0,0,e,e),t.mipmap.push(n),1==e)break;i+=e,e/=2}}},{key:"_generateMipmaps",value:function(t){t=t||this.mips;for(var e=this.width,i=[],n=0;1!=e;)if(e/=2,n>t.length-1){var r=t[n-1].image;r.width=e,r.height=e,i.push(r)}else if(t[n].size==e){var o=t[n].image;o.width=e,o.height=e,i.push(o),n++}else this.setSize(e,e),i.push(this);this.mipmap=i}},{key:"setSize",value:function(t,e){this.width=t,this.height=e}},{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,n){this.color=new Uint8Array([t,e,i,n])}},{key:"bind",value:function(t){var n=this;this.engine=t,this._textureBlockLocation=this.engine.textures.length,this.engine.textures.push(this),this._WebGLTexture=this.engine.webGL.createTexture(),this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this.engine.webGL.bindTexture(this.engine.webGL.TEXTURE_2D,this._WebGLTexture),this.engine.webGL.texImage2D(this.engine.webGL.TEXTURE_2D,0,this.engine.webGL.RGBA,1,1,0,this.engine.webGL.RGBA,this.engine.webGL.UNSIGNED_BYTE,this.color),this.addEventListener("load",function(){var t,e=n;n.onTextureLoad.forEach(function(t){t(e)}),n.engine.webGL.activeTexture(n.engine.webGL.TEXTURE0+n._textureBlockLocation);var i=!0;switch(n.mipmapFilter){case"NEAREST":t=n.engine.webGL.NEAREST,i=!1;break;case"LINEAR":t=n.engine.webGL.LINEAR,i=!1;break;case"NEAREST_MIPMAP_NEAREST":t=n.engine.webGL.NEAREST_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_NEAREST":case"NEAREST_MIPMAP_LINEAR":t=n.engine.webGL.LINEAR_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_LINEAR":t=n.engine.webGL.LINEAR_MIPMAP_LINEAR;break;default:i=!1,t=n.engine.webGL.LINEAR}n.WebGLMipmapFilter=t,n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_MIN_FILTER,t),n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_MAG_FILTER,n.engine.webGL.LINEAR),i&&!n._autoGenerateMipmap?0<n.mipmap.length?n.mipmap.forEach(function(t,e){n.engine.webGL.texImage2D(n.engine.webGL.TEXTURE_2D,e,n.engine.webGL.RGBA,n.engine.webGL.RGBA,n.engine.webGL.UNSIGNED_BYTE,t)}):(console.warn("Need to generate mipmaps for texture:"),console.warn(n)):n.engine.webGL.texImage2D(n.engine.webGL.TEXTURE_2D,0,n.engine.webGL.RGBA,n.engine.webGL.RGBA,n.engine.webGL.UNSIGNED_BYTE,n),(i||n._autoGenerateMipmap)&&o(n.width)&&o(n.height)?n.engine.webGL.generateMipmap(n.engine.webGL.TEXTURE_2D):(n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_WRAP_S,n.engine.webGL.CLAMP_TO_EDGE),n.engine.webGL.texParameteri(n.engine.webGL.TEXTURE_2D,n.engine.webGL.TEXTURE_WRAP_T,n.engine.webGL.CLAMP_TO_EDGE))})}}]),r}(i.n(S)()(Image)),I=i(3),M=function(){function n(t){var e,i;l()(this,n),this.infoConsoleLog(),this.div=t,this.div.style="position: relative;",this.canvas=document.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,t.appendChild(this.canvas),this.webGL=(e=this.canvas,i=e.getContext("experimental-webgl"),window.addEventListener("resize",function(){e.width=e.offsetWidth,e.height=e.offsetHeight}),i),this.width=t.width,this.height=t.height,this.polygons=[],this.objects=[],this.objectsWithAlphaTexture=[],this.ui=null,this.textures=[],this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._initShaders(),this.shaderProgram.use(),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST),this.noTexture=new U,this.noTexture.setColorRGBA(219,58,52,255),this.noTexture.bind(this),this._objectSelectHandler,this.drawCalls=0,this.drawCallsPerFrame=0}var t;return u()(n,[{key:"infoConsoleLog",value:function(){console.log(),console.log("     %c%s","color: rgba(247, 137, 74, 1); text-align: center; font-size: 16px; font-weight: 700","Bronze Engine is running"),console.log(),console.info("     Version : 0.0.1"),console.info("     Docs    : http://m0ksem.design/Bronze-Engine/docs/global"),console.info("     GitHub  : https://github.com/m0ksem/Bronze-Engine"),console.log()}},{key:"_initShaders",value:function(){var t=new I.a(this.webGL);t.addShader("vertex","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition; // - surfaceWorldPosition;\r\n}"),t.addShader("fragment","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    // float light = dot(normal, u_reverseLightDirection);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    gl_FragColor.rgb *= (light);\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}"),t.create(),t.linkAttribute("a_position","positionLocation"),t.linkAttribute("a_texcoord","textureCoordinatesLocation"),t.linkAttribute("a_normal","normalLocation"),t.linkUniform("u_texture","textureLocation"),t.linkUniform("u_matrix","matrixLocation"),t.linkUniform("u_objectRotation","objectRotationLocation"),t.linkUniform("u_lightWorldPosition","lightWorldPositionLocation"),this.shaderProgram=t,(t=new I.a(this.webGL)).addShader("vertex","attribute vec4 a_position;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n    v_normalTex = normalize(a_position.xyz);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition;\r\n}"),t.addShader("fragment","precision mediump float;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\n\r\nuniform samplerCube u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = textureCube(u_texture, v_normalTex);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < .9)\r\n        discard;\r\n}\r\n"),t.create(),t.linkAttribute("a_position","positionLocation"),t.linkAttribute("a_normal","normalLocation"),t.linkUniform("u_texture","textureLocation"),t.linkUniform("u_matrix","matrixLocation"),t.linkUniform("u_objectRotation","objectRotationLocation"),t.linkUniform("u_lightWorldPosition","lightWorldPositionLocation"),this.cubeTextureShaderProgram=t,(t=new I.a(this.webGL)).anisotropyExtension=this.webGL.getExtension("EXT_texture_filter_anisotropic"),this.webGL.texParameteri(this.webGL.TEXTURE_2D,t.anisotropyExtension.TEXTURE_MAX_ANISOTROPY_EXT,16),this.webGL.getExtension("OES_standard_derivatives"),t.addShader("vertex","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_position;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_moving;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    v_texcoord = a_texcoord;\r\n}"),t.addShader("fragment","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n}"),t.create(),t.linkAttribute("a_position","positionLocation"),t.linkAttribute("a_texcoord","textureCoordinatesLocation"),t.linkUniform("u_texture","textureLocation"),t.linkUniform("u_matrix","matrixLocation"),t.linkUniform("u_position","positionMatrixLocation"),this.gridTextureShaderProgram=t,this.shaderProgram.use(),this.webGL.enable(this.webGL.BLEND),this.webGL.blendFunc(this.webGL.ONE,this.webGL.ONE_MINUS_SRC_ALPHA)}},{key:"setCamera",value:function(t){this.camera=t}},{key:"canvasResized",value:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.webGL.viewport(0,0,this.width,this.height)}},{key:"onObjectSelect",value:function(t){this._objectSelectHandler=t}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"_update",value:function(){var i=this;null!=this.camera._controlFunction&&(this.camera._controlFunction(),this.controls.mouse.movement.x=0,this.controls.mouse.movement.y=0),this.selectedObject=null,this.objects.forEach(function(t,e){t.update(),t.texture.alpha&&(i.objectsWithAlphaTexture.push(t),i.objects.splice(e,1))}),this.objectsWithAlphaTexture.sort(function(t,e){return t.position[2]-e.position[2]}),this.objectsWithAlphaTexture.forEach(function(t){t.update()}),this.selectedObject||null==this._objectSelectHandler||this._objectSelectHandler(this.selectedObject)}},{key:"_draw",value:function(){this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.shaderProgram.use(),this.webGL.uniform3fv(this.shaderProgram.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaderProgram.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.camera.matrix),this.drawCallsPerFrame=0,this.polygons.forEach(function(t){t.draw()}),this.objects.forEach(function(t){t.draw()}),this.objectsWithAlphaTexture.forEach(function(t){t.draw()}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"_drawUI",value:function(){null!==this.ui&&this.ui._draw()}},{key:"setDrawingRange",value:function(t){null!=this.camera?this.camera.range=t:console.warn("Failed to set drawing range. Camera wasn't set.")}},{key:"render",value:(t=R()(G.a.mark(function t(){return G.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._update();case 2:return t.next=4,this._draw();case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"run",value:function(){A=this,O()}}]),n}();function O(){requestAnimationFrame(O),A.render()}!function(){for(var o=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-o)),r=window.setTimeout(function(){t(i+n)},n);return o=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var D=function(){function t(){l()(this,t),this.position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=a(90),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null,this.range=2e4}return u()(t,[{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=a(t)}},{key:"setCollisions",value:function(t){this._collisions=t}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.computeMatrix()}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation=[t,e,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.matrix=_(this.matrix,v(this.position[0],this.position[1],this.position[2]));var t=new c;t.multiply(w(a(this.rotation[1]))),t.multiply(b(a(this.rotation[0]))),t.multiply(p(a(this.rotation[2]))),this.matrix=_(this.matrix,t.matrix),null!=this._lookUpMatrix&&(this.matrix=_(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=L(t.matrix),this.inventedMatrix=L(this.matrix)}},{key:"setControl",value:function(t){this._controlFunction=t}},{key:"setLookUp",value:function(t,e,i){this._lookUpMatrix=null!=t?[t,e,i]:null}},{key:"lookAt",value:function(t,e){if(null==t)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var i=normalize(subVec3(this.position,t)),n=normalize(cross(e,i)),r=normalize(cross(i,n));return[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}}]),t}(),j=function(){function n(a){var s=this;l()(this,n),(a.controls=this).engine=a,this.mouseOverCanvas=!1,this._lockPointer=!0,this.pointerLocked=!1,this._rebind=!0,this._globalRebind=!1,this.keys=[],this._handlers=[],this._focusHandlers=[],this._blurHandlers=[],this._focusOnlyIfClick=!0,this.isFocused=!1,this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1],movement:{x:0,y:0},sensitivity:1},this.touch={x:0,y:0,movement:{x:0,y:0},click:!1,longClick:!1,duration:null,actionBeforeMove:null},this.longTouchTime=500,this.touchDuration;for(var t=0;t<255;t++)this.keys[t]=!1,this._handlers[t]=null;if(window.onkeydown=function(t){return s.isFocused?(s.keys[t.keyCode]=!0,null!=s._handlers[t.keyCode]&&s._handlers[t.keyCode](t),!s._rebind):!s._globalRebind||!s._rebind},window.onkeyup=function(t){return s.keys[t.keyCode]=!1,!s._rebind},a.div.setAttribute("tabindex","0"),a.div.onblur=function(){s.isFocused=!1;for(var t=0;t<s._focusHandlers.length;t++)s._blurHandlers[t]()},a.div.onfocus=function(){s.isFocused=!0;for(var t=0;t<s._focusHandlers.length;t++)s._focusHandlers[t]()},a.div.onclick=function(){s._focusOnlyIfClick&&!s.isFocused&&a.div.focus(),s._lockPointer&&a.div.requestPointerLock()},a.div.oncontextmenu=function(){return!1},function(){var t=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var e=["(",t.join("touch-enabled),("),"heartz",")"].join("");return i=e,window.matchMedia(i).matches;var i}()){var e,h,i=function(){s.touch.duration=(new Date).getTime()-e,s.touch.duration>s.longTouchTime&&(s.touch.longClick=!0,s.touch.click=!1,clearInterval())},u=!1;a.div.addEventListener("touchstart",function(t){return null!=s._mouseHandlers[2]&&s._mouseHandlers[2](t),h=setInterval(i,100),e=(new Date).getTime(),s.touch.duration=0,u=!1},!1),a.div.addEventListener("touchend",function(t){return!u&&s.touch.duration<s.longTouchTime?(s.touch.click=!0,setTimeout(function(){s.touch.click=!1},100)):s.touch.actionBeforeMove=!1,c=null,s.touch.longClick=!1,clearInterval(h),!1},!1);var c=null;a.div.addEventListener("touchmove",function(t){var e=a.div.getBoundingClientRect(),i=t.touches[0].clientX-e.left,n=t.touches[0].clientY-e.top;s.mouse.x=i,s.mouse.y=n,null==c&&(c={x:i,y:n});var r=(i-c.x)*s.mouse.sensitivity,o=(n-c.y)*s.mouse.sensitivity;s.mouse.movement.x=r,s.mouse.movement.y=o,c.x=i,c.y=n,s.touch.x=i,s.touch.y=n,s.touch.movement.x=r,s.touch.movement.y=o,u||(s.touch.duration>s.longTouchTime?(s.touch.actionBeforeMove="long click",s.touch.longClick=!1):(s.touch.actionBeforeMove="click",s.touch.click=!1)),u=!0,clearInterval(h)},!1)}else{var r=null;a.div.addEventListener("mousemove",function(t){if(s.pointerLocked)s.mouse.movement.x=-t.movementX*s.mouse.sensitivity,s.mouse.movement.y=-t.movementY*s.mouse.sensitivity,s.mouse.x=s.engine.width/2,s.mouse.y=s.engine.height/2;else{var e=a.div.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;s.mouse.x=i,s.mouse.y=n,null==r&&(r={x:i,y:n}),s.mouse.movement.x=(i-r.x)*s.mouse.sensitivity,s.mouse.movement.y=(n-r.y)*s.mouse.sensitivity,r.x=i,r.y=n}},!1),window.addEventListener("mousemove",function(t){var e=a.div.getBoundingClientRect(),i=t.clientX,n=t.clientY;i<e.right&&i>e.left&&n<e.bottom&&n>e.top?(s.mouseOverCanvas=!0,s._focusOnlyIfClick||s.isFocused||a.div.focus()):(s.mouseOverCanvas=!1,s._focusOnlyIfClick||a.div.blur())}),a.div.onmousedown=function(t){return s.mouse.buttons[t.button]=!0,null!=s._mouseHandlers[2+t.button]&&s._mouseHandlers[2+t.button](t),!1},a.div.onmouseup=function(t){return s.mouse.buttons[t.button]=!1},document.addEventListener("pointerlockchange",function(){document.pointerLockElement===a.div?s.pointerLocked=!0:s.pointerLocked=!1},!1)}}return u()(n,[{key:"clickForFocus",value:function(t){t=t||!this._focusOnlyIfClick,this._focusOnlyIfClick=t}},{key:"setSensitivity",value:function(t){this.mouse.sensitivity=t}},{key:"rebindDefaultBrowserActions",value:function(t){t=t||!this._rebind,this._rebind=t}},{key:"globalRebind",value:function(t){t=t||!this._globalRebind,this._globalRebind=t}},{key:"addOnFocusHandler",value:function(t){this._focusHandlers.push(t)}},{key:"addOnBlurHandler",value:function(t){this._blurHandlers.push(t)}},{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){this.engine.div.addEventListener("mousemove",t,!1)}},{key:"onContextMenu",value:function(t){this.engine.div.oncontextmenu=t}},{key:"lockPointer",value:function(t){t=t||!this._lockPointer,this._lockPointer=t}}]),n}();var N=function(){function e(t){l()(this,e),(t.debugger=this).logArray=[],this.element=null}return u()(e,[{key:"setElement",value:function(t){this.element=t}},{key:"addLog",value:function(t,e){this.logArray.push({view:t,output:e}),this.addView(t)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}},{key:"logObject",value:function(t){var e="{\n";for(var i in t)"_"!=i[0]&&(e+=i+": "+t[i]+",");return e.slice(-1,1),e+="}\n"}}]),e}(),z=function(){function t(){l()(this,t),this.color=new Uint8Array([255,255,255,255]),this._textureBlockLocation=null,this.mipmap=[],this.mips=null,this.onTextureLoad=[],this.loaded=!1,this.textures={positiveX:null,negativeX:null,positiveY:null,negativeY:null,positiveZ:null,negativeZ:null},this._loadedTextureCount=0}return u()(t,[{key:"setImagesFromPath",value:function(t,e,i,n,r,o){var a=this;this.textures.positiveX=new Image,this.textures.positiveX.src=t,this.textures.positiveX.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())}),this.textures.negativeX=new Image,this.textures.negativeX.src=e,this.textures.negativeX.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())}),this.textures.positiveY=new Image,this.textures.positiveY.src=i,this.textures.positiveY.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())}),this.textures.negativeY=new Image,this.textures.negativeY.src=n,this.textures.negativeY.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())}),this.textures.positiveZ=new Image,this.textures.positiveZ.src=r,this.textures.positiveZ.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())}),this.textures.negativeZ=new Image,this.textures.negativeZ.src=o,this.textures.negativeZ.onload(function(){a._loadedTextureCount++,6==a._loadedTextureCount&&(a.loaded=!0,a.onTextureLoad.forEach(function(t){t(a)}),a.bindCubeTexture())})}},{key:"setLoadedImages",value:function(t,e,i,n,r,o){this.textures.positiveX=t,this.textures.negativeX=e,this.textures.positiveY=i,this.textures.negativeY=n,this.textures.positiveZ=r,this.textures.negativeZ=o,this.loaded=!0,this.bindCubeTexture()}},{key:"setSize",value:function(t,e){this.width=t,this.height=e}},{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,n){this.color=new Uint8Array([t,e,i,n])}},{key:"bind",value:function(t){this.engine=t,this.webGL=t.webGL,this._textureBlockLocation=this.engine.textures.length,this.engine.textures.push(this),this._WebGLTexture=this.engine.webGL.createTexture(),this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this.engine.webGL.bindTexture(this.engine.webGL.TEXTURE_2D,this._WebGLTexture),this.engine.webGL.texImage2D(this.engine.webGL.TEXTURE_2D,0,this.engine.webGL.RGBA,1,1,0,this.engine.webGL.RGBA,this.engine.webGL.UNSIGNED_BYTE,this.color)}},{key:"bindCubeTexture",value:function(){this.engine.webGL.activeTexture(this.engine.webGL.TEXTURE0+this._textureBlockLocation),this._WebGLTexture=this.webGL.createTexture(),this.webGL.bindTexture(this.webGL.TEXTURE_CUBE_MAP,this._WebGLTexture),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeX),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeY),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.positiveZ),this.webGL.texImage2D(this.webGL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,this.textures.negativeZ),this.webGL.generateMipmap(this.webGL.TEXTURE_CUBE_MAP),this.webGL.texParameteri(this.webGL.TEXTURE_CUBE_MAP,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR_MIPMAP_LINEAR)}}]),t}(),Y=function(){function e(t){l()(this,e),t&&t.addObject(this),this.engine=t,this.camera=t.camera,this.webGL=t.webGL,this.shaderProgram=t.shaderProgram,this.position=[0,0,0],this.rotationPoint=[0,0,0],this.vertexes=[0,0,0,100,100,0,0,100,0,100,100,0,0,0,0,100,0,0],this.textureCoords=[0,1,1,0,0,0,1,0,0,1,1,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null},this.UIElement=!1,this.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW),this.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW),this.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}return u()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setTextureRepeating",value:function(t,e){this.textureCoords=[0,e,t,0,0,0,t,0,0,e,t,e],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.vertexes=[0,0,0,t,e,0,0,e,0,t,e,0,0,0,0,t,0,0],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scale=[t,e,i]}},{key:"rotate",value:function(t,e,i){var n=a(t),r=a(e),o=a(i);this.rotation=[n,r,o]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setNormals",value:function(t){this.normals=[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"setAsUIElement",value:function(t){this.UIElement=t}},{key:"draw",value:function(){this.shaderProgram.use(),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.textureCoordinatesLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.coordsBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.textureCoordinatesLocation,2,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.normalBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.objectRotationLocation,!1,this._world),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"update",value:function(){var t=new c;this.UIElement?t.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(t.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),t.multiply(this.engine.camera.inventedMatrix));var e=new c;e.multiply(L(v(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),e.translate(this.position[0],this.position[1],this.position[2]);var i=_(b(this.rotation[0]),w(this.rotation[1]));i=_(i,p(this.rotation[2]));var n=_(b(this.parentRotation[0]),w(this.parentRotation[1]));n=_(n,p(this.parentRotation[2])),i=_(this._world=n,i),e.multiply(i),e.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),e.scale(this.scaling[0],this.scaling[1],this.scaling[2]),t.multiply(e.matrix),this._matrix=t.matrix,this._rotationMatrix=i}},{key:"animate",value:function(t,e){e=e||this.animation,this._animationInterval=setInterval(e,1e3/t)}}]),e}(),X=function(){function e(t){l()(this,e),t&&t.objects.push(this),this.engine=t,this.camera=t.camera,this.webGL=t.webGL,this.shaderProgram=t.cubeTextureShaderProgram,this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0],this.vertexes=[-100,-100,-100,-100,100,-100,100,-100,-100,-100,100,-100,100,100,-100,100,-100,-100,-100,-100,100,100,-100,100,-100,100,100,-100,100,100,100,-100,100,100,100,100,-100,100,-100,-100,100,100,100,100,-100,-100,100,100,100,100,100,100,100,-100,-100,-100,-100,100,-100,-100,-100,-100,100,-100,-100,100,100,-100,-100,100,-100,100,-100,-100,-100,-100,-100,100,-100,100,-100,-100,-100,100,-100,100,100,-100,100,-100,100,-100,-100,100,100,-100,100,-100,100,100,-100,100,100,100,-100,100,100,100],this.normals=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null},this.UIElement=!1,this.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW),this.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}return u()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setSize",value:function(t,e,i){this.width=t,this.height=e,this.depth=i,this.vertexes=[-t,-e,-i,-t,e,-i,t,-e,-i,-t,e,-i,t,e,-i,t,-e,-i,-t,-e,i,t,-e,i,-t,e,i,-t,e,i,t,-e,i,t,e,i,-t,e,-i,-t,e,i,t,e,-i,-t,e,i,t,e,i,t,e,-i,-t,-e,-i,t,-e,-i,-t,-e,i,-t,-e,i,t,-e,-i,t,-e,i,-t,-e,-i,-t,-e,i,-t,e,-i,-t,-e,i,-t,e,i,-t,e,-i,t,-e,-i,t,e,-i,t,-e,i,t,-e,i,t,e,-i,t,e,i],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scale=[t,e,i]}},{key:"setRotate",value:function(t,e,i){var n=a(t),r=a(e),o=a(i);this.rotation=[n,r,o]}},{key:"rotate",value:function(t,e,i){var n=a(t),r=a(e),o=a(i);this.rotation[0]+=n,this.rotation[1]+=r,this.rotation[2]+=o}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setNormals",value:function(t){this.normals=[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]],this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}},{key:"setAsUIElement",value:function(t){this.UIElement=t}},{key:"animate",value:function(t,e){e=e||this.animation,this._animationInterval=setInterval(e,1e3/t)}},{key:"draw",value:function(){this.shaderProgram.use(),this.webGL.uniform3fv(this.shaderProgram.reverseLightDirectionLocation,g([-.1,.5,1])),this.webGL.uniform3fv(this.shaderProgram.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.engine.camera.matrix),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.normalBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.objectRotationLocation,!1,this._world),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++,this.engine.shaderProgram.use()}},{key:"update",value:function(){var t=new c;this.UIElement?t.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(t.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),t.multiply(this.engine.camera.inventedMatrix));var e=new c;e.multiply(L(v(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),e.translate(this.position[0],this.position[1],this.position[2]);var i=_(b(this.rotation[0]),w(this.rotation[1]));i=_(i,p(this.rotation[2]));var n=_(b(this.parentRotation[0]),w(this.parentRotation[1]));i=_(n=_(n,p(this.parentRotation[2])),i),e.multiply(i),e.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),e.scale(this.scaling[0],this.scaling[1],this.scaling[2]),this._world=i,t.multiply(e.matrix),this._matrix=t.matrix,this._rotationMatrix=i}}]),e}(),W=function(){function e(t){l()(this,e),t.objects.push(this),this.engine=t,this.shaderProgram=t.shaderProgram,this.webGL=t.webGL,this.camera=t.camera,this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.faces=[],this.collisionBoxes=[],this.UIElement=!1,this.behindTheCamera=!1,this.maxSizes={x:{smallest:0,biggest:0},y:{smallest:0,biggest:0},z:{smallest:0,biggest:0}},this.size=[0,0,0],this.onload=function(){return null}}return u()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.UIElement?(this.position[0]=this.engine.width/2*t/100,this.position[1]=this.engine.height/2*e/100):(this.position[0]=t,this.position[1]=e),this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"moveRelativeToTheCamera",value:function(t,e,i){var n=[t,e,i,1];n=d(this.camera.inventedMatrix,n),this.position[0]+=n[0],this.position[1]+=n[1],this.position[2]+=n[2]}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=a(t),this.rotation[1]=a(e),this.rotation[2]=a(i)}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"getSize",value:function(){var t=[0,0,0];return t[0]=r(this.maxSizes.x.smallest-this.maxSizes.x.biggest),t[1]=r(this.maxSizes.y.smallest-this.maxSizes.y.biggest),t[2]=r(this.maxSizes.z.smallest-this.maxSizes.z.biggest),t}},{key:"scaleToPixels",value:function(t,e,i){this.scaling=[t/this.size[0],e/this.size[1],i/this.size[2]]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"destroy",value:function(){this.engine.splice(this.engine.objects.indexOf(this),1)}},{key:"compile",value:function(t){var l=this,f=[],m=[],d=[],e=t.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};e.forEach(function(t){for(var c=t.split(" "),e=c.length;e--;)""!=c[e]&&"\r"!=c[e]||c.splice(e,1);if("v"==c[0]){var i=parseFloat(c[1]),n=parseFloat(c[2]),r=parseFloat(c[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<n&&(s.y[1]=n),s.z[1]<r&&(s.z[1]=r),s.x[0]>i&&(s.x[0]=i),s.y[0]>n&&(s.y[0]=n),s.z[0]>r&&(s.z[0]=r),f.push([i,n,r])}else if("vn"==c[0])d.push([parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])]);else if("vt"==c[0])m.push([parseFloat(c[1]),parseFloat(c[2])]);else if("f"==c[0])for(var o=function(t){var e=c[t].split("/");if("\r"==e[length-1])return"break";for(var i=null,n=null,r=void 0,o=0;o<l.faces.length;o++){var a=l.faces[o];a.vertexesCount==c.length-1&&(i=a.vertexes,n=a.textureCoords,r=a.normals)}null==i&&(l.faces.push({vertexesCount:c.length-1,vertexes:[],textureCoords:[],normals:[]}),i=l.faces[l.faces.length-1].vertexes,n=l.faces[l.faces.length-1].textureCoords,r=l.faces[l.faces.length-1].normals);var s=parseFloat(e[0]);s<0&&(s=f.length+s+1);var h=parseFloat(e[1]);h<0&&(h=m.length+h+1);var u=parseFloat(e[2]);u<0&&(u=d.length+u+1),f[s-1].forEach(function(t){i.push(t)}),0<m.length&&m[h-1].forEach(function(t){n.push(t)}),null!=e[2]?d[u-1].forEach(function(t){r.push(t)}):r.push(0,0,0)},a=1;a<c.length;a++){if("break"===o(a))break}});for(var i=0;i<this.faces.length;i++){var n=this.faces[i];n.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.vertexes),this.webGL.STATIC_DRAW),n.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.textureCoords),this.webGL.STATIC_DRAW),n.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.normals),this.webGL.STATIC_DRAW)}this.maxSizes.x.smallest=s.x[0],this.maxSizes.x.biggest=s.x[1],this.maxSizes.y.smallest=s.y[0],this.maxSizes.y.biggest=s.y[1],this.maxSizes.z.smallest=s.z[0],this.maxSizes.z.biggest=s.z[1],this.collisionBoxes.push(s),this.size=this.getSize()}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&(e.compile(i.responseText),e.onload())},i.send()}},{key:"draw",value:function(){var e=this;this.shaderProgram.use(),this.behindTheCamera||this.faces.forEach(function(t){e.engine.webGL.enableVertexAttribArray(e.shaderProgram.positionLocation),e.engine.webGL.bindBuffer(e.engine.webGL.ARRAY_BUFFER,t.vertexesBuffer),e.engine.webGL.vertexAttribPointer(e.shaderProgram.positionLocation,3,e.engine.webGL.FLOAT,!1,0,0),e.engine.webGL.enableVertexAttribArray(e.shaderProgram.textureCoordinatesLocation),e.engine.webGL.bindBuffer(e.engine.webGL.ARRAY_BUFFER,t.coordsBuffer),e.engine.webGL.vertexAttribPointer(e.shaderProgram.textureCoordinatesLocation,2,e.engine.webGL.FLOAT,!1,0,0),e.engine.webGL.enableVertexAttribArray(e.shaderProgram.normalLocation),e.engine.webGL.bindBuffer(e.engine.webGL.ARRAY_BUFFER,t.normalBuffer),e.engine.webGL.vertexAttribPointer(e.shaderProgram.normalLocation,3,e.engine.webGL.FLOAT,!1,0,0),e.engine.webGL.uniform1i(e.shaderProgram.textureLocation,e.texture._textureBlockLocation),e.engine.webGL.uniformMatrix4fv(e.shaderProgram.matrixLocation,!1,e._matrix),e.engine.webGL.uniformMatrix4fv(e.shaderProgram.objectRotationLocation,!1,e._world),e.engine.webGL.drawArrays(e.engine.webGL.TRIANGLES,0,t.vertexes.length/t.vertexesCount),e.engine.drawCallsPerFrame++,e.engine.drawCalls++})}},{key:"update",value:function(){var m=this,d=new c;this.UIElement?d.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(d.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),d.multiply(this.engine.camera.inventedMatrix));var t=new c;t.multiply(L(v(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),t.translate(this.position[0],this.position[1],this.position[2]);var e=_(b(this.rotation[0]),w(this.rotation[1]));e=_(e,p(this.rotation[2]));var i=_(b(this.parentRotation[0]),w(this.parentRotation[1]));if(e=_(i=_(i,p(this.parentRotation[2])),e),t.multiply(e),this._world=e,t.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),t.scale(this.scaling[0],this.scaling[1],this.scaling[2]),d.multiply(t.matrix),!this.UIElement){var g=!1;this.collisionBoxes.forEach(function(t){for(var e=[],i=0;i<t.x.length;i++)for(var n=t.x[i],r=0;r<t.y.length;r++)for(var o=t.y[r],a=0;a<t.z.length;a++){var s=t.z[a],h=x(d.matrix,[n,o,s,1]);h[0]=h[0]/h[3],h[1]=h[1]/h[3],h[0]=(.5*h[0]+.5)*m.engine.width,h[1]=(-.5*h[1]+.5)*m.engine.height,h[0]=h[0]<0?0:h[0],h[1]=h[1]<0?0:h[1],h[0]=h[0]>m.engine.width?m.engine.width:h[0],h[1]=h[1]>m.engine.height?m.engine.height:h[1],0<=h[2]&&e.push(h)}for(var u=[1e4,1e4,-1e3],c=[-1e4,-1e4],l=0;l<e.length;l++){var f=e[l];f[0]<u[0]?u[0]=f[0]:f[0]>c[0]&&(c[0]=f[0]),f[1]<u[1]?u[1]=f[1]:f[1]>c[1]&&(c[1]=f[1]),f[2]>u[2]&&(u[2]=f[2])}m.relativeCameraPosition={x:{left:u[0],right:c[0]},y:{top:u[1],bottom:c[1]},depth:u[2]},m.relativeCameraPosition.x.left>=m.engine.width||m.relativeCameraPosition.x.right<=0||m.relativeCameraPosition.y.top>=m.engine.height||m.relativeCameraPosition.x.bottom<=0?m.behindTheCamera=!0:m.behindTheCamera=!1,m.engine.controls.mouse.x>u[0]&&m.engine.controls.mouse.x<c[0]&&m.engine.controls.mouse.y>u[1]&&m.engine.controls.mouse.y<c[1]&&(g=!0),g&&(null==m.engine.selectedObject&&(m.engine.selectedObject=m),m.engine.selectedObject.relativeCameraPosition.depth>=u[2]&&(m.engine.selectedObject=m))})}this._matrix=d.matrix,this._rotationMatrix=e}}]),e}(),V=function(t){function i(t){var e;return l()(this,i),(e=k()(this,B()(i).call(this,t))).shaderProgram=e.engine.gridTextureShaderProgram,e.cellSize=[1e3,1e3],e}return F()(i,t),u()(i,[{key:"draw",value:function(){this.shaderProgram.use(),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.enableVertexAttribArray(this.shaderProgram.textureCoordinatesLocation),this.engine.webGL.bindBuffer(this.engine.webGL.ARRAY_BUFFER,this.coordsBuffer),this.engine.webGL.vertexAttribPointer(this.shaderProgram.textureCoordinatesLocation,2,this.engine.webGL.FLOAT,!1,0,0),this.engine.webGL.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webGL.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this._matrix),this.engine.webGL.drawArrays(this.engine.webGL.TRIANGLES,0,this.vertexes.length/3),this.engine.drawCallsPerFrame++,this.engine.drawCalls++}},{key:"update",value:function(){var t=new c;this.UIElement?t.projection(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range):(t.perspective(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),t.multiply(this.engine.camera.inventedMatrix));var e=new c;e.multiply(L(v(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]))),e.translate(this.position[0],this.position[1],this.position[2]);var i=_(b(this.rotation[0]),w(this.rotation[1]));i=_(i,p(this.rotation[2]));var n=_(b(this.parentRotation[0]),w(this.parentRotation[1]));n=_(n,p(this.parentRotation[2])),i=_(this._world=n,i),e.multiply(i),e.translate(this.rotationPoint[0],this.rotationPoint[1],this.rotationPoint[2]),e.scale(this.scaling[0],this.scaling[1],this.scaling[2]),t.multiply(e.matrix),this._matrix=t.matrix,this._rotationMatrix=i}},{key:"setCellSize",value:function(t,e){this.cellSize=[t,e],this.setTextureRepeating(this.width/t,this.height/e)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.vertexes=[0,0,0,t,e,0,0,e,0,t,e,0,0,0,0,t,0,0],this.setCellSize(this.cellSize[0],this.cellSize[1]),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}}]),i}(Y),H=function(){function e(t){l()(this,e),this.engine=t,this.objects=[],this.lands=[],this.camera}return u()(e,[{key:"createObject",value:function(){var t=new W(engine);return this.engine.objects.push(t),t}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"removeObject",value:function(t){var e=this.objects.indexOf(t);return-1!=e&&(this.objects.splice(e,1),!0)}},{key:"removeObjectByName",value:function(e){var i=this;return this.objects.forEach(function(t){if(t.name==e)return i.removeObject(t),!0}),!1}}]),e}(),q=function(){function e(t){l()(this,e),this.canvas=document.createElement("canvas"),this.canvas.width=t.div.width,this.canvas.height=t.div.height,this.canvas.style="position: absolute; height: 100%; width: 100%; z-index: 999999; left: 0; right: 0; top: 0;",this.div=document.createElement("div"),this.div.style="position: absolute; height: 100%; width: 100%; z-index: 999999; left: 0; right: 0; top: 0;",t.div.appendChild(this.canvas),t.div.appendChild(this.div),this.context=this.canvas.getContext("2d"),this.elements=[],t.ui=this}return u()(e,[{key:"addElement",value:function(t){this.elements.push(t)}},{key:"removeElement",value:function(t){var e=this.elements.indexOf(t);this.elements.removeAt(e)}},{key:"appendDOMElement",value:function(t,e){var i="";for(var n in e)i+=n+":  "+e[n]+";";t.style=i,this.div.appendChild(t)}},{key:"_draw",value:function(){this.elements.forEach(function(t){t.draw()})}}]),e}();i.d(e,"radToDeg",function(){return n}),i.d(e,"degToRad",function(){return a}),i.d(e,"isPowerOf2",function(){return o}),i.d(e,"abs",function(){return r}),i.d(e,"Matrix",function(){return c}),i.d(e,"unit",function(){return f}),i.d(e,"translation",function(){return v}),i.d(e,"rotationX",function(){return b}),i.d(e,"rotationY",function(){return w}),i.d(e,"rotationZ",function(){return p}),i.d(e,"scaling",function(){return m}),i.d(e,"multiply",function(){return _}),i.d(e,"vec3Multiply",function(){return d}),i.d(e,"transformVector",function(){return x}),i.d(e,"inverse",function(){return L}),i.d(e,"normalize",function(){return g}),i.d(e,"Engine",function(){return M}),i.d(e,"Camera",function(){return D}),i.d(e,"Controls",function(){return j}),i.d(e,"Debugger",function(){return N}),i.d(e,"Texture",function(){return U}),i.d(e,"CubeTexture",function(){return z}),i.d(e,"Rect",function(){return Y}),i.d(e,"Cube",function(){return X}),i.d(e,"Object",function(){return W}),i.d(e,"Grid",function(){return V}),i.d(e,"Map",function(){return H}),i.d(e,"UI",function(){return q})}])});