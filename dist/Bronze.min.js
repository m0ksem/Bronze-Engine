!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Bronze",[],e):"object"==typeof exports?exports.Bronze=e():t.Bronze=e()}(window,function(){return function(i){var n={};function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=i,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/dist",o(o.s=15)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(i,t){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}i.exports=n},function(e,t){function i(t){return e.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}e.exports=i},function(t,e,i){t.exports=i(9)},function(t,e){function u(t,e,i,n,o,r,a){try{var s=t[r](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,o)}t.exports=function(s){return function(){var t=this,a=arguments;return new Promise(function(e,i){var n=s.apply(t,a);function o(t){u(n,e,i,o,r,"next",t)}function r(t){u(n,e,i,o,r,"throw",t)}o(void 0)})}}},function(t,e,i){var n=i(11),o=i(12);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?o(t):e}},function(t,e,i){var n=i(2);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(e,t,i){var n=i(3),o=i(2),r=i(13),a=i(14);function s(t){var i="function"==typeof Map?new Map:void 0;return e.exports=s=function(t){if(null===t||!r(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return a(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o(e,t)},s(t)}e.exports=s},function(t,e,i){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),r=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=i(10),o)n.regeneratorRuntime=r;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},function(B,t){!function(t){"use strict";var u,e=Object.prototype,c=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",r=i.toStringTag||"@@toStringTag",a="object"==typeof B,s=t.regeneratorRuntime;if(s)a&&(B.exports=s);else{(s=t.regeneratorRuntime=a?B.exports:{}).wrap=w;var l="suspendedStart",f="suspendedYield",v="executing",m="completed",p={},h={};h[o]=function(){return this};var b=Object.getPrototypeOf,y=b&&b(b(P([])));y&&y!==e&&c.call(y,o)&&(h=y);var d=_.prototype=L.prototype=Object.create(h);g.prototype=d.constructor=_,_.constructor=g,_[r]=g.displayName="GeneratorFunction",s.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,r in t||(t[r]="GeneratorFunction")),t.prototype=Object.create(d),t},s.awrap=function(t){return{__await:t}},G(R.prototype),R.prototype[n]=function(){return this},s.AsyncIterator=R,s.async=function(t,e,i,n){var o=new R(w(t,e,i,n));return s.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},G(d),d[r]="Generator",d[o]=function(){return this},d.toString=function(){return"[object Generator]"},s.keys=function(i){var n=[];for(var t in i)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},s.values=P,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&c.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function t(t,e){return r.type="throw",r.arg=i,n.next=t,e&&(n.method="next",n.arg=u),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],r=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=c.call(o,"catchLoc"),s=c.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),E(i),p}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var o=n.arg;E(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:P(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=u),p}}}function w(t,e,i,n){var r,a,s,u,o=e&&e.prototype instanceof L?e:L,c=Object.create(o.prototype),h=new T(n||[]);return c._invoke=(r=t,a=i,s=h,u=l,function(t,e){if(u===v)throw new Error("Generator is already running");if(u===m){if("throw"===t)throw e;return F()}for(s.method=t,s.arg=e;;){var i=s.delegate;if(i){var n=A(i,s);if(n){if(n===p)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===l)throw u=m,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);u=v;var o=x(r,a,s);if("normal"===o.type){if(u=s.done?m:f,o.arg===p)continue;return{value:o.arg,done:s.done}}"throw"===o.type&&(u=m,s.method="throw",s.arg=o.arg)}}),c}function x(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function L(){}function g(){}function _(){}function G(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function R(u){var e;this._invoke=function(i,n){function t(){return new Promise(function(t,e){!function e(t,i,n,o){var r=x(u[t],u,i);if("throw"!==r.type){var a=r.arg,s=a.value;return s&&"object"==typeof s&&c.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):Promise.resolve(s).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)})}o(r.arg)}(i,n,t,e)})}return e=e?e.then(t,t):t()}}function A(t,e){var i=t.iterator[e.method];if(i===u){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=u,A(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=x(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,p;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(c.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=u,t.done=!0,t};return n.next=n}}return{next:F}}function F(){return{value:u,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(n,t,e){var r=e(2);function o(t,e,i){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?n.exports=o=function(t,e,i){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return i&&r(o,i.prototype),o}:n.exports=o=Reflect.construct,o.apply(null,arguments)}n.exports=o},function(t,e,i){"use strict";i.r(e);var n=i(4),o=i.n(n),r=i(5),a=i.n(r),s=i(0),u=i.n(s),c=i(1),h=i.n(c);function l(t,e,i){var n,o=t;if("fragment"==e)n=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!=e)return console.log("Wrong shader type"),null;n=i.createShader(i.VERTEX_SHADER)}if(i.shaderSource(n,o),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw"Could not compile shader:"+i.getShaderInfoLog(n);return n}var f=i(6),v=i.n(f),m=i(3),p=i.n(m),b=i(7),y=i.n(b),d=i(8),w=function(t){function o(t,e,i){var n;return u()(this,o),(n=v()(this,p()(o).call(this))).src=t,null!=e&&null!=i&&(n.width=e,n.height=i),n.coords=[],n.addEventListener("load",function(){n.loaded=!0}),n.color=new Uint8Array([255,255,255,255]),n._textureBlockLocation=null,n}return y()(o,t),h()(o,[{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,n){this.color=new Uint8Array([t,e,i,n])}}]),o}(i.n(d)()(Image)),x=function(){function t(){return u()(this,t),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return h()(t,[{key:"perspective",value:function(t,e,i,n,o){var r=Math.tan(.5*Math.PI-.5*t),a=1/(n-o);return this.matrix=[r/(e/i),0,0,0,0,r,0,0,0,0,(n+o)*a,-1,0,0,n*o*a*2,0],this}},{key:"multiply",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],o=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],c=this.matrix[8],h=this.matrix[9],l=this.matrix[10],f=this.matrix[11],v=this.matrix[12],m=this.matrix[13],p=this.matrix[14],b=this.matrix[15],y=t[0],d=t[1],w=t[2],x=t[3],L=t[4],g=t[5],_=t[6],G=t[7],R=t[8],A=t[9],k=t[10],E=t[11],T=t[12],P=t[13],F=t[14],B=t[15];this.matrix=[y*e+d*r+w*c+x*v,y*i+d*a+w*h+x*m,y*n+d*s+w*l+x*p,y*o+d*u+w*f+x*b,L*e+g*r+_*c+G*v,L*i+g*a+_*h+G*m,L*n+g*s+_*l+G*p,L*o+g*u+_*f+G*b,R*e+A*r+k*c+E*v,R*i+A*a+k*h+E*m,R*n+A*s+k*l+E*p,R*o+A*u+k*f+E*b,T*e+P*r+F*c+B*v,T*i+P*a+F*h+B*m,T*n+P*s+F*l+B*p,T*o+P*u+F*f+B*b]}},{key:"multiply_",value:function(t){var e=this.matrix[0],i=this.matrix[1],n=this.matrix[2],o=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],c=this.matrix[8],h=this.matrix[9],l=this.matrix[10],f=this.matrix[11],v=this.matrix[12],m=this.matrix[13],p=this.matrix[14],b=this.matrix[15],y=t[0],d=t[1],w=t[2],x=t[3],L=t[4],g=t[5],_=t[6],G=t[7],R=t[8],A=t[9],k=t[10],E=t[11],T=t[12],P=t[13],F=t[14],B=t[15];return[y*e+d*r+w*c+x*v,y*i+d*a+w*h+x*m,y*n+d*s+w*l+x*p,y*o+d*u+w*f+x*b,L*e+g*r+_*c+G*v,L*i+g*a+_*h+G*m,L*n+g*s+_*l+G*p,L*o+g*u+_*f+G*b,R*e+A*r+k*c+E*v,R*i+A*a+k*h+E*m,R*n+A*s+k*l+E*p,R*o+A*u+k*f+E*b,T*e+P*r+F*c+B*v,T*i+P*a+F*h+B*m,T*n+P*s+F*l+B*p,T*o+P*u+F*f+B*b]}},{key:"translate",value:function(t,e,i){this.multiply(L.translation(t,e,i))}},{key:"translate_",value:function(t,e,i){return this.multiply_(L.translation(t,e,i))}},{key:"rotateX",value:function(t){this.multiply(L.rotationX(t))}},{key:"rotateY",value:function(t){this.multiply(L.rotationY(t))}},{key:"rotateZ",value:function(t){this.multiply(L.rotationZ(t))}},{key:"scale",value:function(t,e,i){this.multiply(L.scaling(t,e,i))}}]),t}(),L=new(function(){function t(){u()(this,t)}return h()(t,[{key:"unit",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"translation",value:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}},{key:"rotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}},{key:"rotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}},{key:"rotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}},{key:"scaling",value:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}},{key:"multiply",value:function(t,e){var i=t[0],n=t[1],o=t[2],r=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=t[9],f=t[10],v=t[11],m=t[12],p=t[13],b=t[14],y=t[15],d=e[0],w=e[1],x=e[2],L=e[3],g=e[4],_=e[5],G=e[6],R=e[7],A=e[8],k=e[9],E=e[10],T=e[11],P=e[12],F=e[13],B=e[14],O=e[15];return[d*i+w*a+x*h+L*m,d*n+w*s+x*l+L*p,d*o+w*u+x*f+L*b,d*r+w*c+x*v+L*y,g*i+_*a+G*h+R*m,g*n+_*s+G*l+R*p,g*o+_*u+G*f+R*b,g*r+_*c+G*v+R*y,A*i+k*a+E*h+T*m,A*n+k*s+E*l+T*p,A*o+k*u+E*f+T*b,A*r+k*c+E*v+T*y,P*i+F*a+B*h+O*m,P*n+F*s+B*l+O*p,P*o+F*u+B*f+O*b,P*r+F*c+B*v+O*y]}},{key:"vec3Multiply",value:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}},{key:"transformVector",value:function(t,e){for(var i=new Float32Array(4),n=0;n<4;++n)for(var o=i[n]=0;o<4;++o)i[n]+=e[o]*t[4*o+n];return i}},{key:"inverse",value:function(t){var e=new Float32Array(16),i=t[0],n=t[1],o=t[2],r=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=t[9],f=t[10],v=t[11],m=t[12],p=t[13],b=t[14],y=t[15],d=f*y,w=b*v,x=u*y,L=b*c,g=u*v,_=f*c,G=o*y,R=b*r,A=o*v,k=f*r,E=o*c,T=u*r,P=h*p,F=m*l,B=a*p,O=m*s,C=a*l,j=h*s,U=i*p,S=m*n,M=i*l,D=h*n,Y=i*s,I=a*n,X=d*s+L*l+g*p-(w*s+x*l+_*p),N=w*n+G*l+k*p-(d*n+R*l+A*p),V=x*n+R*s+E*p-(L*n+G*s+T*p),z=_*n+A*s+T*l-(g*n+k*s+E*l),H=1/(i*X+a*N+h*V+m*z);return e[0]=H*X,e[1]=H*N,e[2]=H*V,e[3]=H*z,e[4]=H*(w*a+x*h+_*m-(d*a+L*h+g*m)),e[5]=H*(d*i+R*h+A*m-(w*i+G*h+k*m)),e[6]=H*(L*i+G*a+T*m-(x*i+R*a+E*m)),e[7]=H*(g*i+k*a+E*h-(_*i+A*a+T*h)),e[8]=H*(P*c+O*v+C*y-(F*c+B*v+j*y)),e[9]=H*(F*r+U*v+D*y-(P*r+S*v+M*y)),e[10]=H*(B*r+S*c+Y*y-(O*r+U*c+I*y)),e[11]=H*(j*r+M*c+I*v-(C*r+D*c+Y*v)),e[12]=H*(B*f+j*b+F*u-(C*b+P*u+O*f)),e[13]=H*(M*b+P*o+S*f-(U*f+D*b+F*o)),e[14]=H*(U*u+I*b+O*o-(Y*b+B*o+S*u)),e[15]=H*(Y*f+C*o+D*u-(M*u+I*f+j*o)),e}}]),t}());function g(t){return t*Math.PI/180}function _(t){return 0==(t&t-1)}var G,R=function(){function e(t){u()(this,e),t.objects.push(this),this.webGL=t.webGL,this.camera=t.camera,this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.faces=[],this.collisionBoxes=[]}return h()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"moveRelativeToTheCamera",value:function(t,e,i){var n=[t,e,i,1];n=L.vec3Multiply(this.camera.inventedMatrix,n),this.position[0]+=n[0],this.position[1]+=n[1],this.position[2]+=n[2]}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"compile",value:function(t){var l=this,f=[],v=[],m=[],e=t.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};e.forEach(function(t){for(var h=t.split(" "),e=h.length;e--;)""!=h[e]&&"\r"!=h[e]||h.splice(e,1);if("v"==h[0]){var i=parseFloat(h[1]),n=parseFloat(h[2]),o=parseFloat(h[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<n&&(s.y[1]=n),s.z[1]<o&&(s.z[1]=o),s.x[0]>i&&(s.x[0]=i),s.y[0]>n&&(s.y[0]=n),s.z[0]>o&&(s.z[0]=o),f.push([i,n,o])}else if("vn"==h[0])m.push([parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])]);else if("vt"==h[0])v.push([parseFloat(h[1]),parseFloat(h[2])]);else if("f"==h[0])for(var r=function(t){var e=h[t].split("/");if("\r"==e[length-1])return"break";for(var i=null,n=null,o=void 0,r=0;r<l.faces.length;r++){var a=l.faces[r];a.vertexesCount==h.length-1&&(i=a.vertexes,n=a.textureCoords,o=a.normals)}null==i&&(l.faces.push({vertexesCount:h.length-1,vertexes:[],textureCoords:[],normals:[]}),i=l.faces[l.faces.length-1].vertexes,n=l.faces[l.faces.length-1].textureCoords,o=l.faces[l.faces.length-1].normals);var s=parseFloat(e[0]);s<0&&(s=f.length+s+1);var u=parseFloat(e[1]);u<0&&(u=v.length+u+1);var c=parseFloat(e[2]);c<0&&(c=m.length+c+1),f[s-1].forEach(function(t){i.push(t)}),0<v.length&&v[u-1].forEach(function(t){n.push(t)}),null!=e[2]?m[c-1].forEach(function(t){o.push(t)}):o.push(0,0,0)},a=1;a<h.length;a++){if("break"===r(a))break}});for(var i=0;i<this.faces.length;i++){var n=this.faces[i];n.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.vertexes),this.webGL.STATIC_DRAW),n.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.textureCoords),this.webGL.STATIC_DRAW),n.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.normals),this.webGL.STATIC_DRAW)}this.collisionBoxes.push(s)}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&e.compile(i.responseText)},i.send()}}]),e}(),A=function(){function e(t){u()(this,e),this.engine=t,this.objects=[],this.lands=[],this.camera}return h()(e,[{key:"createObject",value:function(){var t=new R(engine);return this.engine.objects.push(t),t}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"removeObject",value:function(t){var e=this.objects.indexOf(t);return-1!=e&&(this.objects.splice(e,1),!0)}},{key:"removeObjectByName",value:function(e){var i=this;return this.objects.forEach(function(t){if(t.name==e)return i.removeObject(t),!0}),!1}}]),e}(),k=function(){function n(t){var e,i;u()(this,n),this.webGL=(i=(e=t).getContext("experimental-webgl"),window.addEventListener("resize",function(){e.width=e.offsetWidth,e.height=e.offsetHeight}),i),this.canvas=t,this.width=t.width,this.height=t.height,this.polygons=[],this.objects=[],this.ui={objects:[]},this.textures=[],this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._globalPositionBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalPositionBuffer),this._globalTextureBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalTextureBuffer),this._initShaders(),this.noTexture=new w,this.noTexture.setColorRGBA(219,58,52,255),this.bindTexture(this.noTexture),this._objectSelectHandler}var t;return h()(n,[{key:"_initShaders",value:function(){var t,e,i,n,o,r=l("attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition; // - surfaceWorldPosition;\r\n}","vertex",this.webGL),a=l("precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    // float light = dot(normal, u_reverseLightDirection);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < 0.2)\r\n        discard;\r\n}","fragment",this.webGL);this.shaderProgram=(t=this.webGL,e=r,i=a,n=!1,o=t.createProgram(),t.attachShader(o,e),t.attachShader(o,i),t.linkProgram(o),t.useProgram(o),n&&(t.deleteShader(e),t.deleteShader(i)),o),this.positionLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_position"),this.textureCoordinatesLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_texcoord"),this.textureLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_texture"),this.matrixLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_matrix"),this.objectRotationLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_objectRotation"),this.normalLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_normal"),this.reverseLightDirectionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_reverseLightDirection"),this.lightWorldPositionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_lightWorldPosition"),this.cameraLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_cameraMatrix"),this.webGL.useProgram(this.shaderProgram),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST)}},{key:"setCamera",value:function(t){this.camera=t}},{key:"canvasResized",value:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.webGL.viewport(0,0,this.width,this.height)}},{key:"onObjectSelect",value:function(t){this._objectSelectHandler=t}},{key:"bindTexture",value:function(t){var e=this;t._textureBlockLocation=this.textures.length,this.textures.push(t),t._WebGLtexture=this.webGL.createTexture(),this.webGL.activeTexture(this.webGL.TEXTURE0+t._textureBlockLocation),this.webGL.bindTexture(this.webGL.TEXTURE_2D,t._WebGLtexture),t.loaded?(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t),this.webGL.generateMipmap(this.webGL.TEXTURE_2D),_(image.width)&&_(image.height)?this.webGL.generateMipmap(this.webGL.TEXTURE_2D):(this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_S,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_T,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR))):(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,1,1,0,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t.color),t.addEventListener("load",function(){e.webGL.activeTexture(e.webGL.TEXTURE0+t._textureBlockLocation),e.webGL.texImage2D(e.webGL.TEXTURE_2D,0,e.webGL.RGBA,e.webGL.RGBA,e.webGL.UNSIGNED_BYTE,t),_(t.width)&&_(t.height)?e.webGL.generateMipmap(e.webGL.TEXTURE_2D):(e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_S,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_T,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_MIN_FILTER,e.webGL.LINEAR))}))}},{key:"_update",value:function(){var p,e,i,n,b=this;null!=this.camera._controlFunction&&(this.camera._controlFunction(),this.controls.mouse.movement.x=0,this.controls.mouse.movement.y=0),this.selectedObject=null,this.polygons.forEach(function(t){(p=new x).perspective(b.camera.fieldOfViewRad,b.width,b.height,1,2e4),p.multiply(b.camera.inventedMatrix),(n=new x).multiply(L.inverse(L.translation(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]))),n.translate(t.position[0],t.position[1],t.position[2]),e=L.multiply(L.rotationX(t.rotation[0]),L.rotationY(t.rotation[1])),e=L.multiply(e,L.rotationZ(t.rotation[2])),null!=t.parentRotation&&(i=L.multiply(L.rotationX(t.parentRotation[0]),L.rotationY(t.parentRotation[1])),i=L.multiply(i,L.rotationZ(t.parentRotation[2])),t._world=i,e=L.multiply(i,e)),n.multiply(e),n.translate(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]),n.scale(1,1,1),p.multiply(n.matrix),t._matrix=p.matrix,t._rotationMatrix=e});var y=null;this.objects.forEach(function(v){(p=new x).perspective(b.camera.fieldOfViewRad,b.width,b.height,1,2e4),p.multiply(b.camera.inventedMatrix),(n=new x).multiply(L.inverse(L.translation(v.rotationPoint[0],v.rotationPoint[1],v.rotationPoint[2]))),n.translate(v.position[0],v.position[1],v.position[2]),e=L.multiply(L.rotationX(v.rotation[0]),L.rotationY(v.rotation[1])),e=L.multiply(e,L.rotationZ(v.rotation[2])),i=L.multiply(L.rotationX(v.parentRotation[0]),L.rotationY(v.parentRotation[1])),i=L.multiply(i,L.rotationZ(v.parentRotation[2])),v._world=i,e=L.multiply(i,e),n.multiply(e),n.translate(v.rotationPoint[0],v.rotationPoint[1],v.rotationPoint[2]),n.scale(v.scaling[0],v.scaling[1],v.scaling[2]),p.multiply(n.matrix);var m=!1;v.collisionBoxes.forEach(function(t){for(var e=[],i=0;i<t.x.length;i++)for(var n=t.x[i],o=0;o<t.y.length;o++)for(var r=t.y[o],a=0;a<t.z.length;a++){var s=t.z[a],u=L.transformVector(p.matrix,[n,r,s,1]);u[0]=u[0]/u[3],u[1]=u[1]/u[3],u[0]=(.5*u[0]+.5)*b.width,u[1]=(-.5*u[1]+.5)*b.height,u[0]=u[0]<0?0:u[0],u[1]=u[1]<0?0:u[1],u[0]=u[0]>b.width?b.width:u[0],u[1]=u[1]>b.height?b.height:u[1],0<=u[2]&&e.push(u)}for(var c=[1e4,1e4,-1e3],h=[-1e4,-1e4],l=0;l<e.length;l++){var f=e[l];f[0]<c[0]?c[0]=f[0]:f[0]>h[0]&&(h[0]=f[0]),f[1]<c[1]?c[1]=f[1]:f[1]>h[1]&&(h[1]=f[1]),f[2]>c[2]&&(c[2]=f[2])}v.relativeCameraPosition={x:{left:c[0],right:h[0]},y:{top:h[1],bottom:c[1]},depth:c[2]},b.controls.mouse.x>c[0]&&b.controls.mouse.x<h[0]&&b.controls.mouse.y>c[1]&&b.controls.mouse.y<h[1]&&(m=!0);b.controls.mouse;m&&(null==y&&(y=v),y.relativeCameraPosition.depth>=c[2]&&(y=v))}),b.selectedObject=y,b.selectedObject||null==b._objectSelectHandler||b._objectSelectHandler(),v._matrix=p.matrix,v._rotationMatrix=e}),this.ui.objects.forEach(function(t){(p=new x).perspective(b.camera.fieldOfViewRad,b.width,b.height,1,2e4),(n=new x).multiply(L.inverse(L.translation(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]))),n.translate(t.position[0],t.position[1],t.position[2]),e=L.multiply(L.rotationX(t.rotation[0]),L.rotationY(t.rotation[1])),e=L.multiply(e,L.rotationZ(t.rotation[2])),i=L.multiply(L.rotationX(t.parentRotation[0]),L.rotationY(t.parentRotation[1])),i=L.multiply(i,L.rotationZ(t.parentRotation[2])),t._world=i,e=L.multiply(i,e),n.multiply(e),n.translate(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]),n.scale(t.scaling[0],t.scaling[1],t.scaling[2]),p.multiply(n.matrix),t._matrix=p.matrix,t._rotationMatrix=e})}},{key:"_draw",value:function(){var t,e,i,n=this;this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.webGL.uniform3fv(this.reverseLightDirectionLocation,(t=[-.1,.5,1],e=new Float32Array(3),1e-5<(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i,e))),this.webGL.uniform3fv(this.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.cameraLocation,!1,this.camera.matrix),this.polygons.forEach(function(t){n.webGL.enableVertexAttribArray(n.positionLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._vertexesBuffer),n.webGL.vertexAttribPointer(n.positionLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.textureCoordinatesLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._coordsBuffer),n.webGL.vertexAttribPointer(n.textureCoordinatesLocation,2,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.normalLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t._normalBuffer),n.webGL.vertexAttribPointer(n.normalLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.uniform1i(n.textureLocation,t.texture._textureBlockLocation),n.webGL.uniformMatrix4fv(n.matrixLocation,!1,t._matrix),n.webGL.uniformMatrix4fv(n.objectRotationLocation,!1,t._world),n.webGL.drawArrays(n.webGL.TRIANGLES,0,3)}),this.objects.forEach(function(e){e.faces.forEach(function(t){n.webGL.enableVertexAttribArray(n.positionLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.vertexesBuffer),n.webGL.vertexAttribPointer(n.positionLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.textureCoordinatesLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.coordsBuffer),n.webGL.vertexAttribPointer(n.textureCoordinatesLocation,2,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.normalLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.normalBuffer),n.webGL.vertexAttribPointer(n.normalLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.uniform1i(n.textureLocation,e.texture._textureBlockLocation),n.webGL.uniformMatrix4fv(n.matrixLocation,!1,e._matrix),n.webGL.uniformMatrix4fv(n.objectRotationLocation,!1,e._world),n.webGL.drawArrays(n.webGL.TRIANGLES,0,t.vertexes.length/t.vertexesCount)})}),this.ui.objects.forEach(function(e){e.faces.forEach(function(t){n.webGL.enableVertexAttribArray(n.positionLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.vertexesBuffer),n.webGL.vertexAttribPointer(n.positionLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.textureCoordinatesLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.coordsBuffer),n.webGL.vertexAttribPointer(n.textureCoordinatesLocation,2,n.webGL.FLOAT,!1,0,0),n.webGL.enableVertexAttribArray(n.normalLocation),n.webGL.bindBuffer(n.webGL.ARRAY_BUFFER,t.normalBuffer),n.webGL.vertexAttribPointer(n.normalLocation,3,n.webGL.FLOAT,!1,0,0),n.webGL.uniform1i(n.textureLocation,e.texture._textureBlockLocation),n.webGL.uniformMatrix4fv(n.matrixLocation,!1,e._matrix),n.webGL.uniformMatrix4fv(n.objectRotationLocation,!1,e._world),n.webGL.drawArrays(n.webGL.TRIANGLES,0,t.vertexes.length/t.vertexesCount)})}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"render",value:(t=a()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._update();case 2:return t.next=4,this._draw();case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"run",value:function(){G=this,E()}}]),n}();function E(){requestAnimationFrame(E),G.render()}!function(){for(var r=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-r)),o=window.setTimeout(function(){t(i+n)},n);return r=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var T=function(){function t(){u()(this,t),this.position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=g(90),this.matrix=L.unit(),this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null}return h()(t,[{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=g(t)}},{key:"setCollisions",value:function(t){this._collisions=t}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.computeMatrix()}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation=[t,e,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=L.unit(),this.matrix=L.multiply(this.matrix,L.translation(this.position[0],this.position[1],this.position[2]));var t=new x;t.multiply(L.rotationY(g(this.rotation[1]))),t.multiply(L.rotationX(g(this.rotation[0]))),t.multiply(L.rotationZ(g(this.rotation[2]))),this.matrix=L.multiply(this.matrix,t.matrix),null!=this._lookUpMatrix&&(this.matrix=L.multiply(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=L.inverse(t.matrix),this.inventedMatrix=L.inverse(this.matrix)}},{key:"setControl",value:function(t){this._controlFunction=t}},{key:"setLookUp",value:function(t,e,i){this._lookUpMatrix=null!=t?[t,e,i]:null}},{key:"lookAt",value:function(t,e){if(null==t)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var i=normalize(subVec3(this.position,t)),n=normalize(cross(e,i)),o=normalize(cross(i,n));return[n[0],n[1],n[2],0,o[0],o[1],o[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}}]),t}(),P=function(){function e(o){var r=this;u()(this,e),(o.controls=this).engine=o,this.mouseOverCanvas=!1,this._lockPointer=!0,this.pointerLocked=!1,this._rebind=!0,this._globalRebind=!1,this.keys=[],this._handlers=[],this._focusHandlers=[],this._blurHandlers=[],this._focusOnlyIfClick=!0,this.isFocused=!1,this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1],movement:{x:0,y:0},sensitivity:1};for(var t=0;t<255;t++)this.keys[t]=!1,this._handlers[t]=null;window.onkeydown=function(t){return r.isFocused?(r.keys[t.keyCode]=!0,null!=r._handlers[t.keyCode]&&r._handlers[t.keyCode](),!r._rebind):!r._globalRebind||!r._rebind},window.onkeyup=function(t){return r.keys[t.keyCode]=!1,!r._rebind},o.canvas.setAttribute("tabindex","0");var a=null;o.canvas.addEventListener("mousemove",function(t){if(r.pointerLocked)r.mouse.movement.x=-t.movementX*r.mouse.sensitivity,r.mouse.movement.y=-t.movementY*r.mouse.sensitivity,r.mouse.x=r.engine.width/2,r.mouse.y=r.engine.height/2;else{var e=o.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;r.mouse.x=i,r.mouse.y=n,null==a&&(a={x:i,y:n}),r.mouse.movement.x=(i-a.x)*r.mouse.sensitivity,r.mouse.movement.y=(n-a.y)*r.mouse.sensitivity,a.x=i,a.y=n}},!1),window.addEventListener("mousemove",function(t){var e=o.canvas.getBoundingClientRect(),i=t.clientX,n=t.clientY;i<e.right&&i>e.left&&n<e.bottom&&n>e.top?(r.mouseOverCanvas=!0,r._focusOnlyIfClick||o.canvas.focus()):r.mouseOverCanvas=!1}),o.canvas.onclick=function(){r._focusOnlyIfClick&&o.canvas.focus(),r._lockPointer&&o.canvas.requestPointerLock()},o.canvas.onmousedown=function(t){return r.mouse.buttons[t.button]=!0,null!=r._mouseHandlers[2+t.button]&&r._mouseHandlers[2+t.button](),!1},o.canvas.onmouseup=function(t){return r.mouse.buttons[t.button]=!1},o.canvas.oncontextmenu=function(){return!1},o.canvas.onblur=function(){r.isFocused=!1;for(var t=0;t<r._focusHandlers.length;t++)r._blurHandlers[t]()},o.canvas.onfocus=function(){r.isFocused=!0;for(var t=0;t<r._focusHandlers.length;t++)r._focusHandlers[t]()},document.addEventListener("pointerlockchange",function(){document.pointerLockElement===o.canvas?r.pointerLocked=!0:r.pointerLocked=!1},!1)}return h()(e,[{key:"setSensitivity",value:function(t){this.mouse.sensitivity=t}},{key:"rebindDefaultBrowserActions",value:function(t){t=t||!this._rebind,this._rebind=t}},{key:"globalRebind",value:function(t){t||this._globalRebind,this._globalRebind=t}},{key:"addOnFocusHandler",value:function(t){this._focusHandlers.push(t)}},{key:"addOnBlurHandler",value:function(t){this._blurHandlers.push(t)}},{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){this.engine.canvas.addEventListener("mousemove",t,!1)}},{key:"onContextMenu",value:function(t){this.engine.canvas.oncontextmenu=t}},{key:"lockPointer",value:function(t){t=t||!this._lockPointer,this._lockPointer=t}}]),e}(),F=function(){function e(t){u()(this,e),(t.debugger=this).logArray=[],this.element=null}return h()(e,[{key:"setElement",value:function(t){this.element=t}},{key:"addLog",value:function(t,e,i,n,o){o=o||this.defaultOutput,this.logArray.push({name:t,object:e,value:i,view:n,output:o}),this.addView(n)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"defaultOutput",value:function(t){return null!=object?t.name+" : "+t.object[t.value]:"log.name"}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}}]),e}(),B=function(){function e(t){u()(this,e),t&&t.polygons.push(this),this.webGL=t.webGL,this.texture=null,this.vertexes=[],this.position=[0,0,0],this.rotation=[0,0,0],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.normals=[0,1,0,0,1,0,0,1,0],this._vertexesBuffer=null}return h()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setTextureCoords",value:function(t){this.textureCoords=t,this._coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setVertexes",value:function(t){this.vertexes=t,this._vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"update",value:function(){}},{key:"setNormals",value:function(t){this.normals=t,this._normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}}]),e}(),O=function(){function i(t){u()(this,i),this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0];var e=new B(t);e.setVertexes([0,0,0,100,100,0,0,100,0]),e.setTextureCoords([0,1,1,0,0,0]),this.polygons[0]=e,(e=new B(t)).setVertexes([100,100,0,0,0,0,100,0,0]),e.setTextureCoords([1,0,0,1,1,1]),this.polygons[1]=e,this.setNormals([0,0,1,0,0,1,0,0,1])}return h()(i,[{key:"setTexture",value:function(t){this.polygons[0].setTexture(t),this.polygons[1].setTexture(t)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.polygons[0].setVertexes([0,0,0,t,e,0,0,e,0]),this.polygons[1].setVertexes([t,e,0,0,0,0,t,0,0])}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.polygons[0].setPosition(t,e,i),this.polygons[1].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){var n=g(t),o=g(e),r=g(i);this.polygons[0].rotate(n,o,r),this.polygons[1].rotate(n,o,r)}},{key:"setParentRotation",value:function(t,e,i){this.polygons[0].setParentRotation(t,e,i),this.polygons[1].setParentRotation(t,e,i)}},{key:"setRotationPoint",value:function(t,e,i){this.polygons[0].setRotationPoint(t,e,i),this.polygons[1].setRotationPoint(t,e,i)}},{key:"setNormals",value:function(t){this.polygons[0].setNormals(t),this.polygons[1].setNormals(t)}}]),i}(),C=function(){function e(t){u()(this,e),this.faces=[new O(t),new O(t),new O(t),new O(t),new O(t),new O(t)],this.position=[0,0,0],this.rotation=[0,0,0],this.faces[0].rotate(0,0,0),this.faces[0].setRotationPoint(-100,-100,100),this.faces[0].setPosition(0,0,0),this.faces[0].setNormals([0,0,1,0,0,1,0,0,1]),this.faces[1].rotate(0,90,0),this.faces[1].setRotationPoint(-100,-100,100),this.faces[1].position=[0,0,0],this.faces[1].setNormals([1,0,0,1,0,0,1,0,0]),this.faces[2].rotate(0,-180,0),this.faces[2].setRotationPoint(-100,-100,100),this.faces[2].position=[0,0,0],this.faces[2].setNormals([0,0,-1,0,0,-1,0,0,-1]),this.faces[3].rotate(0,270,0),this.faces[3].setRotationPoint(-100,-100,100),this.faces[3].position=[0,0,0],this.faces[3].setNormals([-1,0,0,-1,0,0,-1,0,0]),this.faces[4].rotate(-90,0,0),this.faces[4].setRotationPoint(-100,-100,100),this.faces[4].position=[0,0,0],this.faces[4].setNormals([0,1,0,0,1,0,0,1,0]),this.faces[5].rotate(90,0,0),this.faces[5].setRotationPoint(-100,-100,100),this.faces[5].position=[0,0,0],this.faces[5].setNormals([0,-1,0,0,-1,0,0,-1,0])}return h()(e,[{key:"_updateFaces",value:function(){this.faces[0].setPosition(this.position[0],this.position[1],this.position[2])}},{key:"setTexture",value:function(t,e,i,n,o,r){this.faces[0].setTexture(t),this.faces[1].setTexture(e),this.faces[2].setTexture(i),this.faces[3].setTexture(n),this.faces[4].setTexture(o),this.faces[5].setTexture(r)}},{key:"setSize",value:function(e,i,n){this.width=e,this.height=i,this.depth=n,this.faces.forEach(function(t){t.setSize(e,i),t.setRotationPoint(-e/2,-i/2,n/2)})}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.faces[0].setPosition(t,e,i),this.faces[1].setPosition(t,e,i),this.faces[2].setPosition(t,e,i),this.faces[3].setPosition(t,e,i),this.faces[4].setPosition(t,e,i),this.faces[5].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i;var n=g(this.rotation[0]),o=g(this.rotation[1]),r=g(this.rotation[2]);this.faces.forEach(function(t){t.setParentRotation(n,o,r)})}},{key:"setRotation",value:function(t,e,i){var n=g(t),o=g(e),r=g(i);this.faces.forEach(function(t){t.setParentRotation(n,o,r)})}},{key:"animation",value:function(){this.rotate(1,1,1)}},{key:"animate",value:function(t,e){e=e||this.animation,this._animationInterval=setInterval(e,1e3/t)}},{key:"removeAnimation",value:function(){clearInterval(this._animationInterval)}}]),e}(),j=function(){function e(t){u()(this,e),t.ui.objects.push(this),this.webGL=t.webGL,this.camera=t.camera,this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.relativeCameraPosition=null,this.faces=[],this.collisionBoxes=[]}return h()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"moveRelativeToTheCamera",value:function(t,e,i){var n=[t,e,i,1];n=Matrixes.vec3Multiply(this.camera.inventedMatrix,n),this.position[0]+=n[0],this.position[1]+=n[1],this.position[2]+=n[2]}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"compile",value:function(t){var l=this,f=[],v=[],m=[],e=t.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};e.forEach(function(t){for(var h=t.split(" "),e=h.length;e--;)""!=h[e]&&"\r"!=h[e]||h.splice(e,1);if("v"==h[0]){var i=parseFloat(h[1]),n=parseFloat(h[2]),o=parseFloat(h[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<n&&(s.y[1]=n),s.z[1]<o&&(s.z[1]=o),s.x[0]>i&&(s.x[0]=i),s.y[0]>n&&(s.y[0]=n),s.z[0]>o&&(s.z[0]=o),f.push([i,n,o])}else if("vn"==h[0])m.push([parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])]);else if("vt"==h[0])v.push([parseFloat(h[1]),parseFloat(h[2])]);else if("f"==h[0])for(var r=function(t){var e=h[t].split("/");if("\r"==e[length-1])return"break";for(var i=null,n=null,o=void 0,r=0;r<l.faces.length;r++){var a=l.faces[r];a.vertexesCount==h.length-1&&(i=a.vertexes,n=a.textureCoords,o=a.normals)}null==i&&(l.faces.push({vertexesCount:h.length-1,vertexes:[],textureCoords:[],normals:[]}),i=l.faces[l.faces.length-1].vertexes,n=l.faces[l.faces.length-1].textureCoords,o=l.faces[l.faces.length-1].normals);var s=parseFloat(e[0]);s<0&&(s=f.length+s+1);var u=parseFloat(e[1]);u<0&&(u=v.length+u+1);var c=parseFloat(e[2]);c<0&&(c=m.length+c+1),f[s-1].forEach(function(t){i.push(t)}),0<v.length&&v[u-1].forEach(function(t){n.push(t)}),null!=e[2]?m[c-1].forEach(function(t){o.push(t)}):o.push(0,0,0)},a=1;a<h.length;a++){if("break"===r(a))break}});for(var i=0;i<this.faces.length;i++){var n=this.faces[i];n.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.vertexes),this.webGL.STATIC_DRAW),n.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.textureCoords),this.webGL.STATIC_DRAW),n.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,n.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(n.normals),this.webGL.STATIC_DRAW)}this.collisionBoxes.push(s)}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&e.compile(i.responseText)},i.send()}}]),e}();i.d(e,"Engine",function(){return k}),i.d(e,"Camera",function(){return T}),i.d(e,"Controls",function(){return P}),i.d(e,"Debugger",function(){return F}),i.d(e,"Texture",function(){return w}),i.d(e,"Rect",function(){return O}),i.d(e,"Cube",function(){return C}),i.d(e,"Object",function(){return R}),i.d(e,"ObjectUI",function(){return j}),i.d(e,"Map",function(){return A})}])});