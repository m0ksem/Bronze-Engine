!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Bronze",[],e):"object"==typeof exports?exports.Bronze=e():t.Bronze=e()}(window,function(){return n={},r.m=i=[function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,i){t.exports=i(12)},function(e,t){function i(t){return e.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}e.exports=i},function(t,e,i){var n=i(13),r=i(2);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?r(t):e}},function(t,e,i){var n=i(10);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e){function h(t,e,i,n,r,o,s){try{var a=t[o](s),h=a.value}catch(t){return void i(t)}a.done?e(h):Promise.resolve(h).then(n,r)}t.exports=function(a){return function(){var t=this,s=arguments;return new Promise(function(e,i){var n=a.apply(t,s);function r(t){h(n,e,i,r,o,"next",t)}function o(t){h(n,e,i,r,o,"throw",t)}r(void 0)})}}},function(e,t,i){var n=i(5),r=i(10),o=i(14),s=i(15);function a(t){var i="function"==typeof Map?new Map:void 0;return e.exports=a=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return s(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},a(t)}e.exports=a},function(i,t){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}i.exports=n},function(t,e,i){var r=i(0);t.exports=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(t){r(e,t,i[t])})}return e}},function(t,e,i){var n=function(o){"use strict";var h,t=Object.prototype,u=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",i=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function s(t,e,i,n){var r=e&&e.prototype instanceof a?e:a,o=Object.create(r.prototype),s=new B(n||[]);return o._invoke=function(o,s,a){var h=c;return function(t,e){if(h===d)throw new Error("Generator is already running");if(h===f){if("throw"===t)throw e;return k()}for(a.method=t,a.arg=e;;){var i=a.delegate;if(i){var n=T(i,a);if(n){if(n===m)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(h===c)throw h=f,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);h=d;var r=l(o,s,a);if("normal"===r.type){if(h=a.done?f:g,r.arg===m)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(h=f,a.method="throw",a.arg=r.arg)}}}(t,i,s),o}function l(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var c="suspendedStart",g="suspendedYield",d="executing",f="completed",m={};function a(){}function v(){}function b(){}var x={};x[r]=function(){return this};var _=Object.getPrototypeOf,w=_&&_(_(L([])));w&&w!==t&&u.call(w,r)&&(x=w);var p=b.prototype=a.prototype=Object.create(x);function y(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function E(h){var e;this._invoke=function(i,n){function t(){return new Promise(function(t,e){!function e(t,i,n,r){var o=l(h[t],h,i);if("throw"!==o.type){var s=o.arg,a=s.value;return a&&"object"==typeof a&&u.call(a,"__await")?Promise.resolve(a.__await).then(function(t){e("next",t,n,r)},function(t){e("throw",t,n,r)}):Promise.resolve(a).then(function(t){s.value=t,n(s)},function(t){return e("throw",t,n,r)})}r(o.arg)}(i,n,t,e)})}return e=e?e.then(t,t):t()}}function T(t,e){var i=t.iterator[e.method];if(i===h){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=h,T(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=l(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,m;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=h),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function L(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(u.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=h,t.done=!0,t};return n.next=n}}return{next:k}}function k(){return{value:h,done:!0}}return v.prototype=p.constructor=b,b.constructor=v,b[n]=v.displayName="GeneratorFunction",o.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,n in t||(t[n]="GeneratorFunction")),t.prototype=Object.create(p),t},o.awrap=function(t){return{__await:t}},y(E.prototype),E.prototype[i]=function(){return this},o.AsyncIterator=E,o.async=function(t,e,i,n){var r=new E(s(t,e,i,n));return o.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},y(p),p[n]="Generator",p[r]=function(){return this},p.toString=function(){return"[object Generator]"},o.keys=function(i){var n=[];for(var t in i)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=L,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(R),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=h)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function t(t,e){return o.type="throw",o.arg=i,n.next=t,e&&(n.method="next",n.arg=h),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=u.call(r,"catchLoc"),a=u.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),R(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;R(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:L(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=h),m}},o}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(e,t){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(n,t,e){var o=e(10);function r(t,e,i){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?n.exports=r=function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&o(r,i.prototype),r}:n.exports=r=Reflect.construct,r.apply(null,arguments)}n.exports=r},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"radToDeg",function(){return a}),i.d(n,"degToRad",function(){return h}),i.d(n,"dropCircle",function(){return u}),i.d(n,"dropCircleRad",function(){return l}),i.d(n,"isPowerOf2",function(){return c}),i.d(n,"default",function(){return g});var r={};i.r(r),i.d(r,"Vector3",function(){return _}),i.d(r,"normalize",function(){return w}),i.d(r,"rotationX",function(){return p}),i.d(r,"rotationY",function(){return y}),i.d(r,"rotationZ",function(){return E}),i.d(r,"vecMultiply",function(){return T}),i.d(r,"multiply",function(){return A}),i.d(r,"distance",function(){return R}),i.d(r,"length",function(){return B}),i.d(r,"angleBetweenVectors",function(){return L}),i.d(r,"default",function(){return k});var o={};i.r(o),i.d(o,"Vector2",function(){return P}),i.d(o,"normalize",function(){return C}),i.d(o,"vec2Multiply",function(){return S}),i.d(o,"multiply",function(){return I}),i.d(o,"distance",function(){return F}),i.d(o,"length",function(){return M}),i.d(o,"angleBetweenVectors",function(){return z}),i.d(o,"default",function(){return U});var s={};function a(t){return 180*t/Math.PI}function h(t){return t*Math.PI/180}function u(t){return t-360*Math.ceil(t/360)}function l(t){var e=Math.ceil(t/Math.PI);return t-Math.PI*e}function c(t){return 0==(t&t-1)}i.r(s),i.d(s,"Matrix4",function(){return D}),i.d(s,"unit",function(){return G}),i.d(s,"perspective",function(){return O}),i.d(s,"projection",function(){return j}),i.d(s,"translation",function(){return N}),i.d(s,"translateX",function(){return X}),i.d(s,"translateY",function(){return H}),i.d(s,"translateZ",function(){return Y}),i.d(s,"rotationX",function(){return W}),i.d(s,"rotationY",function(){return V}),i.d(s,"rotationZ",function(){return q}),i.d(s,"scaling",function(){return Z}),i.d(s,"rotation",function(){return J}),i.d(s,"multiply",function(){return K}),i.d(s,"multiplyScalar",function(){return Q}),i.d(s,"multiplyVector4",function(){return $}),i.d(s,"transformVector",function(){return tt}),i.d(s,"inverse",function(){return et}),i.d(s,"transpose",function(){return it}),i.d(s,"default",function(){return nt});var g={radToDeg:a,degToRad:h,isPowerOf2:c},d=i(1),f=i.n(d),m=i(3),v=i.n(m),b=i(0),x=i.n(b),_=function(){function n(t,e,i){f()(this,n),x()(this,"x",0),x()(this,"y",0),x()(this,"z",0),this.set(t,e,i)}return v()(n,[{key:"set",value:function(t,e,i){this.x=t,this.y=e,this.z=i}},{key:"move",value:function(t,e,i){this.x+=t,this.y+=e,this.z+=i}},{key:"moveArray",value:function(t){this.x+=t[0],this.y+=t[1],this.z+=t[2]}},{key:"scale",value:function(t,e,i){this.x*=t,this.y*=e,this.z*=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(){return Object.assign(new n(0,0,0),this)}},{key:"add",value:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}}]),n}();function w(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 1e-5<e?(t.x=t.x/e,t.y=t.y/e,t.z=t.z/e,t):null}function p(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,e,i,0,-i,e]}function y(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,1,0,i,0,e]}function E(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,-i,e,0,0,0,1]}function T(t,e){return[t[0]*e.x+t[1]*e.y+t[2]*e.z,t[3]*e.x+t[4]*e.y+t[5]*e.z,t[6]*e.x+t[7]*e.y+t[8]*e.z]}function A(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=t[8],c=e[0],g=e[1],d=e[2],f=e[3],m=e[4],v=e[5],b=e[6],x=e[7],_=e[8];return[c*i+g*o+d*h,c*n+g*s+d*u,c*r+g*a+d*l,f*i+m*o+v*h,f*n+m*s+v*u,f*r+m*a+v*l,b*i+x*o+_*h,b*n+x*s+_*u,b*r+x*a+_*l]}function R(t,e){var i=0;return i+=(t.x-e.x)*(t.x-e.x),i+=(t.y-e.y)*(t.y-e.y),i+=(t.z-e.z)*(t.z-e.z),Math.sqrt(i)}function B(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function L(t,e){return(t.x*e.x+t.y*e.y+t.z*e.z)/(B(t)*B(e))}var k={Vector3:_},P=function(){function i(t,e){f()(this,i),x()(this,"x",0),x()(this,"y",0),this.set(t,e)}return v()(i,[{key:"set",value:function(t,e){this.x=t,this.y=e}},{key:"move",value:function(t,e){this.x+=t,this.y+=e}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),i}();function C(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 1e-5<e?(t.x=t.x/e,t.y=t.y/e,t):null}function S(t,e){return[t[0]*e.x+t[1]*e.y,t[3]*e.x+t[4]*e.y]}function I(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=e[0],u=e[1],l=e[3],c=e[4];return[h*i+u*o,h*n+u*s,h*r+u*a,l*i+c*o,l*n+c*s,l*r+c*a]}function F(t,e){var i=0;return i+=(t.x-e.x)*(t.x-e.x),i+=(t.y-e.y)*(t.y-e.y),Math.sqrt(i)}function M(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function z(t,e){return(t.x*e.x+t.y*e.y)/(M(t)*M(e))}var U={Vector2:P},D=function(){function t(){f()(this,t),x()(this,"_value",void 0),this._value=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return v()(t,[{key:"value",get:function(){return this._value}}]),v()(t,[{key:"translate",value:function(t,e,i){this._value=K(this._value,N(t,e,i))}},{key:"rotate",value:function(t,e,i){this._value=K(this._value,J(t,e,i))}},{key:"scale",value:function(t,e,i){this._value=K(this._value,Z(t,e,i))}}]),t}();function G(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function O(t,e,i,n,r){var o=Math.tan(.5*Math.PI-.5*t),s=1/(n-r);return[o/(e/i),0,0,0,0,o,0,0,0,0,(n+r)*s,-1,0,0,n*r*s*2,0]}function j(t,e){return[2/t,0,0,0,0,-2/e,0,0,0,0,1,0,0,0,0,1]}function N(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}function X(t,e){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],e*t[0]+t[12],e*t[1]+t[13],e*t[2]+t[14],e*t[3]+t[15]]}function H(t,e){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],e*t[4]+t[12],e*t[5]+t[13],e*t[6]+t[14],e*t[7]+t[15]]}function Y(t,e){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],e*t[8]+t[12],e*t[9]+t[13],e*t[10]+t[14],e*t[11]+t[15]]}function W(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}function V(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}function q(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}function Z(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}function J(t,e,i){return K(K(W(t),V(e)),q(i))}function K(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=t[8],c=t[9],g=t[10],d=t[11],f=t[12],m=t[13],v=t[14],b=t[15],x=e[0],_=e[1],w=e[2],p=e[3],y=e[4],E=e[5],T=e[6],A=e[7],R=e[8],B=e[9],L=e[10],k=e[11],P=e[12],C=e[13],S=e[14],I=e[15];return[x*i+_*s+w*l+p*f,x*n+_*a+w*c+p*m,x*r+_*h+w*g+p*v,x*o+_*u+w*d+p*b,y*i+E*s+T*l+A*f,y*n+E*a+T*c+A*m,y*r+E*h+T*g+A*v,y*o+E*u+T*d+A*b,R*i+B*s+L*l+k*f,R*n+B*a+L*c+k*m,R*r+B*h+L*g+k*v,R*o+B*u+L*d+k*b,P*i+C*s+S*l+I*f,P*n+C*a+S*c+I*m,P*r+C*h+S*g+I*v,P*o+C*u+S*d+I*b]}function Q(t,e){for(var i=0;i<t.length;i++)t[i]*=e;return t}function $(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}function tt(t,e){for(var i=new Array(4),n=0;n<4;++n)for(var r=i[n]=0;r<4;++r)i[n]+=e[r]*t[4*r+n];return i}function et(t){var e=new Array(16),i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=t[8],c=t[9],g=t[10],d=t[11],f=t[12],m=t[13],v=t[14],b=t[15],x=g*b,_=v*d,w=h*b,p=v*u,y=h*d,E=g*u,T=r*b,A=v*o,R=r*d,B=g*o,L=r*u,k=h*o,P=l*m,C=f*c,S=s*m,I=f*a,F=s*c,M=l*a,z=i*m,U=f*n,D=i*c,G=l*n,O=i*a,j=s*n,N=x*a+p*c+y*m-(_*a+w*c+E*m),X=_*n+T*c+B*m-(x*n+A*c+R*m),H=w*n+A*a+L*m-(p*n+T*a+k*m),Y=E*n+R*a+k*c-(y*n+B*a+L*c),W=1/(i*N+s*X+l*H+f*Y);return e[0]=W*N,e[1]=W*X,e[2]=W*H,e[3]=W*Y,e[4]=W*(_*s+w*l+E*f-(x*s+p*l+y*f)),e[5]=W*(x*i+A*l+R*f-(_*i+T*l+B*f)),e[6]=W*(p*i+T*s+k*f-(w*i+A*s+L*f)),e[7]=W*(y*i+B*s+L*l-(E*i+R*s+k*l)),e[8]=W*(P*u+I*d+F*b-(C*u+S*d+M*b)),e[9]=W*(C*o+z*d+G*b-(P*o+U*d+D*b)),e[10]=W*(S*o+U*u+O*b-(I*o+z*u+j*b)),e[11]=W*(M*o+D*u+j*d-(F*o+G*u+O*d)),e[12]=W*(S*g+M*v+C*h-(F*v+P*h+I*g)),e[13]=W*(D*v+P*r+U*g-(z*g+G*v+C*r)),e[14]=W*(z*h+j*v+I*r-(O*v+S*r+U*h)),e[15]=W*(O*g+F*r+G*h-(D*h+j*g+M*r)),e}function it(t){var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e}var nt={Matrix4:D,unit:G,projection:j,perspective:O,inverse:et,multiplyVector4:$,transpose:it,multiply:K,translation:N,translateX:X},rt=i(4),ot=i.n(rt),st=i(8),at=i.n(st),ht=i(6),ut=i.n(ht),lt=i(5),ct=i.n(lt),gt=i(2),dt=i.n(gt),ft=i(7),mt=i.n(ft),vt=i(9),bt=i.n(vt);function xt(t){var e=t.getContext("experimental-webgl");if(null==e)throw new wt("Cannot get WebGL context.");return window.addEventListener("resize",function(){t.width=t.offsetWidth,t.height=t.offsetHeight}),e}function _t(t){throw f()(this,_t),new Rt(t)}var wt=function(t){function i(t){var e;return f()(this,i),e=ut()(this,ct()(i).call(this,t)),x()(dt()(e),"name","WebglError"),Error.captureStackTrace(dt()(e),i),e}return mt()(i,t),i}(bt()(Error)),pt=function(){function e(t){return f()(this,e),x()(this,"webGL",void 0),x()(this,"VERTEX_SHADER","vertex"),x()(this,"FRAGMENT_SHADER","fragment"),x()(this,"ATTRIBUTE","attribute"),x()(this,"UNIFORM","uniform"),x()(this,"_program",null),x()(this,"_vertexShader",null),x()(this,"_fragmentShader",null),this.webGL=t,this}return v()(e,[{key:"program",get:function(){return this._program}}]),v()(e,[{key:"addShader",value:function(t,e){var i;switch(t){case"vertex":i=this.webGL.createShader(this.webGL.VERTEX_SHADER),this._vertexShader=i;break;case"fragment":i=this.webGL.createShader(this.webGL.FRAGMENT_SHADER),this._fragmentShader=i;break;default:throw new yt("Wrong shader type.")}if(this.webGL.shaderSource(i,e),this.webGL.compileShader(i),!this.webGL.getShaderParameter(i,this.webGL.COMPILE_STATUS))throw console.error("There are shader error:"),console.error(this.webGL.getShaderInfoLog(i)),new yt("Could not compile shader.")}},{key:"create",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.webGL.createProgram();if(null==this._vertexShader&&null==this._fragmentShader)throw new yt("Shader programs isn`t complete.");return this.webGL.attachShader(e,this._vertexShader),this.webGL.attachShader(e,this._fragmentShader),this.webGL.linkProgram(e),this.webGL.useProgram(e),t&&(this.webGL.deleteShader(this._vertexShader),this.webGL.deleteShader(this._fragmentShader)),this._program=e}},{key:"linkVariable",value:function(t,e,i){if(void 0!==this[i=i||e]&&(console.warn("Shader program: Custom name for uniform was switched from "+i+" to "+i+"1"),i+="1"),null==this._program)throw new yt("Shader program is null.");switch(t){case this.ATTRIBUTE:this[i]=this.webGL.getAttribLocation(this._program,e);break;case this.UNIFORM:this[i]=this.webGL.getUniformLocation(this._program,e);break;default:throw"Wrong variable type"}return this[i]}},{key:"linkAttribute",value:function(t,e){if(null!=this[e=e||t]&&(console.warn("Shader program: Custom name for uniform was switched from "+e+" to "+e+"1"),e+="1"),null==this._program)throw new yt("Shader program is null.");if(this[e]=this.webGL.getAttribLocation(this.program,t),null==this[e])throw new Error("Can not link uniform "+t+". The variable may not be used in shader.");return this[e]}},{key:"linkUniform",value:function(t,e){if(null!=this[e=e||t]&&(console.warn("Shader program: Custom name for attribute was switched from "+e+" to "+e+"1"),e+=""),null==this._program)throw new yt("Shader program is null.");if(this[e]=this.webGL.getUniformLocation(this.program,t),null==this[e])throw new Error("Can not link uniform "+t+". The variable may not be used in shader.");return this[e]}},{key:"use",value:function(){this.webGL.useProgram(this.program)}},{key:"useIn",value:function(t){t.useProgram(this.program)}}]),e}(),yt=function(t){function i(t){var e;return f()(this,i),e=ut()(this,ct()(i).call(this,t)),x()(dt()(e),"name","WebglError"),Error.captureStackTrace(dt()(e),i),e}return mt()(i,t),i}(bt()(Error)),Et=pt,Tt=function(){function i(t){f()(this,i),x()(this,"extensions",new At),x()(this,"webGL",void 0),x()(this,"shadersRequireLights",[]),this.webGL=t;var e={removePrefixes:!0,addLocationMarker:!0};this.addExtension("anisotropic","EXT_texture_filter_anisotropic"),this.addExtension("standard","OES_standard_derivatives"),this.addProgram("default","#define MAX_LIGHTS 28\r\n\r\nattribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform mat4 u_worldMatrix;\r\n\r\nuniform vec3 u_lightPositions[MAX_LIGHTS];\r\nuniform int u_lightsCount;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_worldMatrix  * a_position).xyz;\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(u_lightsCount)) {\r\n            break;\r\n        }\r\n        v_lightsDirections[i] = u_lightPositions[i] - surfaceWorldPosition;\r\n    }\r\n\r\n    v_lightsCount = float(u_lightsCount);\r\n}\r\n","#define MAX_LIGHTS 28\r\n\r\nprecision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform float u_lightRanges[MAX_LIGHTS];\r\nuniform float u_lightMinValue;\r\n\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\n\r\nfloat computeLight(vec3 direction, float range) {\r\n    float light = dot(v_normal, normalize(direction));\r\n    float k = (range - length(direction)) / range;\r\n    if (k < 0.0) k = 0.0;\r\n    light = light * k;\r\n    if (light < u_lightMinValue) {\r\n        light = u_lightMinValue;\r\n    }\r\n    return light;\r\n}\r\n\r\nvoid main() {\r\n    float light = 0.0;\r\n\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(v_lightsCount)) {\r\n            break;\r\n        }\r\n        light += computeLight(v_lightsDirections[i], u_lightRanges[i]);\r\n    }\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n    gl_FragColor.rgb *= (light);\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}\r\n",e),this.addProgram("cube","#define MAX_LIGHTS 28\r\n\r\nattribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightPositions[MAX_LIGHTS];\r\nuniform int u_lightsCount;\r\nuniform mat4 u_worldMatrix;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n    v_normalTex = normalize(a_position.xyz);\r\n\r\n    vec3 surfaceWorldPosition = (u_worldMatrix  * a_position).xyz;\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(u_lightsCount)) {\r\n            break;\r\n        }\r\n        v_lightsDirections[i] = u_lightPositions[i] - surfaceWorldPosition;\r\n    }\r\n\r\n    v_lightsCount = float(u_lightsCount);\r\n}\r\n","#define MAX_LIGHTS 28\r\n\r\nprecision mediump float;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_normalTex;\r\n\r\nuniform samplerCube u_texture;\r\nuniform float u_lightRanges[MAX_LIGHTS];\r\nuniform float u_lightMinValue;\r\n\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\n\r\nfloat computeLight(vec3 direction, float range) {\r\n    float light = dot(v_normal, normalize(direction));\r\n    float k = (range - length(direction)) / range;\r\n    if (k < 0.0) k = 0.0;\r\n    light = light * k;\r\n    if (light < u_lightMinValue) {\r\n        light = u_lightMinValue;\r\n    }\r\n    return light;\r\n}\r\n\r\nvoid main() {\r\n    float light = 0.0;\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(v_lightsCount)) {\r\n            break;\r\n        }\r\n        light += computeLight(v_lightsDirections[i], u_lightRanges[i]);\r\n    }\r\n    \r\n    gl_FragColor = textureCube(u_texture, v_normalTex);\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n    gl_FragColor.rgb *= (light);\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}\r\n",e),this.addProgram("grid","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\n\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_moving;\r\nuniform vec2 u_cellSize;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    v_texcoord = vec2(a_texcoord.x + u_moving.x / u_cellSize.x, a_texcoord.y + (u_moving.y / u_cellSize.x));\r\n}","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n}",e),this.addProgram("reflection","#define MAX_LIGHTS 28\r\n\r\nattribute vec4 a_position;\r\nattribute vec3 a_normal;\r\n    \r\nuniform mat4 u_matrix;\r\nuniform mat4 u_rotationMatrix;\r\nuniform mat4 u_worldMatrix;\r\nuniform vec3 u_lightPositions[MAX_LIGHTS];\r\nuniform int u_lightsCount;\r\n\r\nvarying vec3 v_worldRotation;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLightDirection;\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\n    \r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    v_worldRotation = (u_rotationMatrix * a_position).xyz;\r\n    v_normal =  vec3(a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_worldMatrix  * a_position).xyz;\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(u_lightsCount)) {\r\n            break;\r\n        }\r\n        v_lightsDirections[i] = u_lightPositions[i] - surfaceWorldPosition;\r\n    }\r\n\r\n    v_lightsCount = float(u_lightsCount);\r\n}","#define MAX_LIGHTS 28\r\n\r\nprecision highp float;\r\n    \r\nuniform samplerCube u_texture;\r\nuniform float u_lightRanges[MAX_LIGHTS];\r\nuniform float u_lightMinValue;\r\n\r\nvarying vec3 v_lightsDirections[MAX_LIGHTS];\r\nvarying float v_lightsCount;\r\nvarying vec3 v_worldRotation;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLightDirection;\r\n        \r\nfloat computeLight(vec3 direction, float range) {\r\n    float light = dot(normalize(v_worldRotation), normalize(direction));\r\n    float k = (range - length(direction)) / range;\r\n    if (k < 0.0) k = 0.0;\r\n    light = light * k;\r\n    if (light < u_lightMinValue) {\r\n        light = u_lightMinValue;\r\n    }\r\n    return light;\r\n}\r\n\r\nvoid main() {\r\n    vec3 worldNormal = normalize(v_normal);\r\n    vec3 eyeToSurfaceDir = normalize(v_worldRotation);\r\n    vec3 direction = reflect(eyeToSurfaceDir, vec3(0.0, 0.0, -1.0));\r\n    \r\n    gl_FragColor = textureCube(u_texture, direction);\r\n\r\n    float light = 0.0;\r\n\r\n    for (int i = 0; i < MAX_LIGHTS; i++) {\r\n        if (i > int(v_lightsCount)) {\r\n            break;\r\n        }\r\n        light += computeLight(v_lightsDirections[i], u_lightRanges[i]);\r\n    }\r\n\r\n    gl_FragColor.rgb *= (light);\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}",e),this.addProgram("skybox","attribute vec4 a_position;\r\nvarying vec4 v_position;\r\nvoid main() {\r\n    v_position = a_position;\r\n    gl_Position = a_position;\r\n    gl_Position.z = .9999999;\r\n}","    precision mediump float;\r\n     \r\n    uniform samplerCube u_texture;\r\n    uniform mat4 u_matrix;\r\n     \r\n    varying vec4 v_position;\r\n    void main() {\r\n      vec4 t = u_matrix * v_position;\r\n      gl_FragColor = textureCube(u_texture, normalize(t.xyz / t.w));\r\n    }",e),this.addProgram("screen","attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = a_position;\r\n\r\n    v_texcoord = a_texcoord;\r\n}\r\n","precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n    gl_FragColor.rgb *= gl_FragColor.a;\r\n}\r\n",e),this.default.use(),this.webGL.enable(this.webGL.BLEND),this.webGL.blendFunc(this.webGL.ONE,this.webGL.ONE_MINUS_SRC_ALPHA)}return v()(i,[{key:"addProgram",value:function(t,e,i,n){var r=new Et(this.webGL);r.addShader("vertex",e),r.addShader("fragment",i),r.create(),r=this._linkAllAttributesFromSource(r,e,n),r=this._linkAllAttributesFromSource(r,i,n),this[t]=r}},{key:"_linkAllAttributesFromSource",value:function(a,t,h){var u;return t.split(";").join("\r").split("\r").forEach(function(t){for(var e=(t=(t=t.replace(new RegExp("\r","g"),"")).replace(new RegExp("\n","g"),"")).split(" "),i=e.length-1;i--;)""===e[i]&&e.splice(i,1);if(e[0].toLowerCase().includes("attribute")){var n=e[2],r=n.indexOf("[");-1!=r&&(n=n.slice(0,r)),u=n,h&&h.removePrefixes&&(u=u.slice(2,u.length)),h&&h.addLocationMarker&&(u+="Location"),a.linkAttribute(e[2],u)}else if(e[0].toLowerCase().includes("uniform")){var o=e[2],s=o.indexOf("[");-1!=s&&(o=o.slice(0,s)),u=o,h&&h.removePrefixes&&(u=u.slice(2,u.length)),h&&h.addLocationMarker&&(u+="Location"),a.linkUniform(o,u)}}),a}},{key:"addExtension",value:function(t,e){this.extensions[t]=this.webGL.getExtension(e)}}]),i}(),At=function t(){f()(this,t)},Rt=function t(e){f()(this,t),x()(this,"name","BronzeError"),x()(this,"message",void 0),Error.apply(this,[e]),this.message=e};Rt.prototype=new Error;function Bt(t){f()(this,Bt),console.warn(t)}var Lt,kt=_t,Pt=function(){function e(t){f()(this,e),x()(this,"alpha",!1),x()(this,"color",new Uint8Array([229,91,91,255])),x()(this,"engine",void 0),x()(this,"textureBlockLocation",-1),x()(this,"loaded",!1),x()(this,"webglTexture",void 0),this.engine=t}return v()(e,[{key:"setColor",value:function(t,e,i,n){if(t.constructor instanceof String){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(String(t));if(null==r)return void new kt("Wrong hex color!");this.color=new Uint8Array([parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),255])}else{if(t.constructor!==Number||null==e||null==i||null==n)return void new kt("Wrong color");this.color=new Uint8Array([Number(t),e,i,n])}var o=this.engine.webgl;o.activeTexture(o.TEXTURE0+this.textureBlockLocation),o.bindTexture(o.TEXTURE_2D,this.webglTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,this.color)}}]),e}(),Ct=function(t){function n(t){var e;f()(this,n),e=ut()(this,ct()(n).call(this,t)),x()(dt()(e),"textureBlockLocation",-1),e.engine=t,e.textureBlockLocation=e.engine.textures.length,e.engine.textures.push(dt()(e));var i=e.engine.webgl;return e.webglTexture=i.createTexture(),i.activeTexture(i.TEXTURE0+e.textureBlockLocation),i.bindTexture(i.TEXTURE_2D,e.webglTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,e.color),e.engine.textureLoaded(dt()(e)),e.loaded=!0,e}return mt()(n,t),n}(Pt),St=i(11),It=i.n(St),Ft=function(){function e(t){f()(this,e),x()(this,"name","Just entity :)"),x()(this,"loaded",!1),x()(this,"verticalAlign",!0),x()(this,"vertexes",[]),x()(this,"textureCoordinates",[]),x()(this,"normals",[]),x()(this,"vertexesBuffer",null),x()(this,"textureCoordinatesBuffer",null),x()(this,"normalsBuffer",null),x()(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"rotationMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"worldMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"uiMatrix",null),x()(this,"texture",void 0),x()(this,"rotationInDeg",new _(0,0,0)),x()(this,"rotation",new _(0,0,0)),x()(this,"rotationSelf",new _(0,0,0)),x()(this,"rotationPoint",new _(0,0,0)),x()(this,"scaling",new _(1,1,1)),x()(this,"selectable",!1),x()(this,"relativeToCameraPosition",{max:{x:0,y:0},min:{x:0,y:0},depth:0}),x()(this,"_engine",void 0),x()(this,"webgl",void 0),x()(this,"camera",void 0),x()(this,"maxSize",new _(0,0,0)),x()(this,"minSize",new _(0,0,0)),x()(this,"maxBaseSize",new _(0,0,0)),x()(this,"minBaseSize",new _(0,0,0)),x()(this,"hidden",!1),x()(this,"rotationPointPos",null),x()(this,"shaderProgram",void 0),x()(this,"_collisionBox",new Mt),x()(this,"_UIElement",!1),x()(this,"_animationInterval",void 0),x()(this,"_position",new _(0,0,0)),this._engine=t,this.webgl=t.webgl,this.camera=t.camera,this.texture=this._engine.noTexture,this.shaderProgram=t.shaders.default,t.addObject(this)}var t,i,n,r;return v()(e,[{key:"setPosition",value:function(t,e,i){t.constructor===_?this.position=t:t.constructor===Array?this.UIElement?this._position.set(this.engine.width/100*t[0],-this.engine.height/100*t[1],t[2]):this._position.set(t[0],t[1],t[2]):this.UIElement?this._position.set(this.engine.width/100*t,-this.engine.height/100*e,i):this._position.set(t,e,i)}},{key:"move",value:function(t,e,i){this._position.move(t,e,i)}},{key:"moveRelativeToTheCamera",value:function(t,e,i){this._position.move(t,e,i)}},{key:"setRotation",value:function(t,e,i){var n=h(t),r=h(e),o=h(i);this.rotationInDeg.set(t,e,i),this.rotation.set(n,r,o)}},{key:"rotate",value:function(t,e,i){var n=h(t),r=h(e),o=h(i);this.rotationInDeg.move(t,e,i),this.rotation.move(n,r,o)}},{key:"rotateSelf",value:function(t,e,i){var n=h(t),r=h(e),o=h(i);this.rotationInDeg.move(t,e,i),this.rotationSelf.move(n,r,o)}},{key:"setRotationPoint",value:function(t,e,i){if(t.constructor===String)switch(t){case"center":this.rotationPoint.set(0,0,0),this.rotationPoint.set(0,0,0),this.rotationPoint.set(0,0,0),this.rotationPointPos="center";break;default:new _t("Wrong point type")}else this.rotationPoint.set(t,e,i)}},{key:"scale",value:function(t,e,i){this.scaling.set(t,e,i),this.maxSize.set(this.maxBaseSize.x*t,this.maxBaseSize.y*e,this.maxBaseSize.z*i),this.minSize.set(this.minBaseSize.x*t,this.minBaseSize.y*e,this.minBaseSize.z*i)}},{key:"scaleToPixels",value:function(t,e,i){t=null!=t?t/Math.abs(this.maxBaseSize.x-this.minBaseSize.x):this.scaling.x,e=null!=e?e/Math.abs(this.maxBaseSize.y-this.minBaseSize.y):this.scaling.y,i=null!=i?i/Math.abs(this.maxBaseSize.z-this.minBaseSize.z):this.scaling.z,this.scaling.set(t,e,i)}},{key:"scaleToPixelsX",value:function(t){t/=Math.abs(this.maxBaseSize.x-this.minBaseSize.x),this.scaling.set(t,t,t)}},{key:"resize",value:function(t,e,i){t/=this.maxBaseSize.x,e/=this.maxBaseSize.y,i/=this.maxBaseSize.z,this.scaling.set(t,e,i),this.maxSize.set(this.maxBaseSize.x*t,this.maxBaseSize.y*e,this.maxBaseSize.z*i),this.minSize.set(this.minBaseSize.x*t,this.minBaseSize.y*e,this.minBaseSize.z*i)}},{key:"setTexture",value:function(t){this.texture=t}},{key:"checkCollision",value:(r=at()(ot.a.mark(function t(e,i,n,r){var o,s,a,h,u,l,c,g,d,f,m,v,b,x;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:!this.hidden&&this.engine.camera.moved&&(o=[this.collisionBox.maxPoint.x,this.collisionBox.maxPoint.y,this.collisionBox.maxPoint.z,1],s=[this.collisionBox.minPoint.x,this.collisionBox.minPoint.y,this.collisionBox.minPoint.z,1],o=tt(this.worldMatrix,o),s=tt(this.worldMatrix,s),o[0]<s[0]&&(a=o[0],o[0]=s[0],s[0]=a),h=o[0]-n.minPoint.x,u=s[0]-n.maxPoint.x,o[1]<s[1]&&(l=o[1],o[1]=s[1],s[1]=l),c=o[1]-n.minPoint.y,g=s[1]-n.maxPoint.y,o[2]<s[2]&&(d=o[2],o[2]=s[2],s[2]=d),f=o[2]-n.minPoint.z,m=s[2]-n.maxPoint.z,v=e.x+i.x,b=e.y+i.y,x=e.z+i.z,e.y>g&&e.y<c&&e.z>m&&e.z<f&&(e.x<u&&u<=v||e.x>h&&v<=h)&&r("x"),e.x>u&&e.x<h&&e.z>m&&e.z<f&&(e.y<g&&g<=b||e.y>c&&b<=c)&&r("y"),e.y>g&&e.y<c&&e.x>u&&e.x<h&&(e.z<m&&m<=x||e.z>f&&x<=f)&&r("z"));case 1:case"end":return t.stop()}},t,this)})),function(t,e,i,n){return r.apply(this,arguments)})},{key:"useShader",value:function(t){this.shaderProgram=t}},{key:"updateRelativeToCameraPosition",value:(n=at()(ot.a.mark(function t(){var e,i,n,r,o,s,a,h,u,l,c,g;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=[this.collisionBox.maxPoint.x,this.collisionBox.minPoint.x],i=[this.collisionBox.maxPoint.y,this.collisionBox.minPoint.y],n=[this.collisionBox.maxPoint.z,this.collisionBox.minPoint.z],r=[1e6,1e6],o=[-1e6,-1e6,-1e6],s=0;s<2;s++)for(a=e[s],h=0;h<2;h++)for(u=i[h],l=0;l<2;l++)c=n[l],(g=tt(this.matrix,[a,u,c,1]))[0]=g[0]/g[3],g[1]=g[1]/g[3],g[0]=(.5*g[0]+.5)*this.engine.width,g[1]=(-.5*g[1]+.5)*this.engine.height,g[0]=g[0]<0?0:g[0],g[1]=g[1]<0?0:g[1],g[0]=g[0]>this.engine.width?this.engine.width:g[0],g[1]=g[1]>this.engine.height?this.engine.height:g[1],g[0]<r[0]?r[0]=g[0]:g[0]>o[0]&&(o[0]=g[0]),g[1]<r[1]?r[1]=g[1]:g[1]>o[1]&&(o[1]=g[1]),g[2]>o[2]&&(o[2]=g[2]);this.relativeToCameraPosition={max:{x:o[0],y:o[1]},min:{x:r[0],y:r[1]},depth:o[2]};case 7:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"getPositionOnScreen",value:(i=at()(ot.a.mark(function t(){return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.updateRelativeToCameraPosition();case 2:this.engine.controls.mouse.x>this.relativeToCameraPosition.min.x&&this.engine.controls.mouse.x<this.relativeToCameraPosition.max.x&&this.engine.controls.mouse.y>this.relativeToCameraPosition.min.y&&this.engine.controls.mouse.y<this.relativeToCameraPosition.max.y&&(null==this.engine.selectedObject||this.engine.selectedObject.relativeToCameraPosition.depth>=this.relativeToCameraPosition.depth)&&(this.engine.selectedObject=this);case 3:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"updateMatrixes",value:(t=at()(ot.a.mark(function t(){var e,i,n;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=J(this.rotation.x,this.rotation.y,this.rotation.z),i=N(this._position.x,this._position.y,this._position.z),this.verticalAlign||(i=K(i,N(0,-(this.maxSize.y-this.minSize.y)/2,0))),n=K(n=K(n=e,N(-this.minSize.x-(this.maxSize.x-this.minSize.x)/2,-this.minSize.y-(this.maxSize.y-this.minSize.y)/2,-this.minSize.z-(this.maxSize.z-this.minSize.z)/2)),Z(this.scaling.x,this.scaling.y,this.scaling.z)),i=this.UIElement?(this.uiMatrix=K(i,n),K(this.camera.matrix,e)):K(i,n),this.worldMatrix=i,this.rotationMatrix=e;case 9:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"update",value:function(){if(!this.hidden){var t=O(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range);this.UIElement?(t=K(t,this.uiMatrix),this.rotationMatrix=K(this.engine.camera.rotationMatrix,this.rotationMatrix)):t=K(t=K(t,this.engine.camera.inverseMatrix),this.worldMatrix),this.matrix=t}this.selectable&&this.getPositionOnScreen()}},{key:"draw",value:function(){!this.hidden&&this.shaderProgram&&(this.shaderProgram.use(),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.texcoordLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.textureCoordinatesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.texcoordLocation,2,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.normalsBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.uniform1i(this.shaderProgram.textureLocation,this.texture.textureBlockLocation),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this.matrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.objectRotationLocation,!1,this.rotationMatrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.worldMatrixLocation,!1,this.worldMatrix),this.engine.webgl.drawArrays(this.engine.webgl.TRIANGLES,0,this.vertexes.length/3))}},{key:"animate",value:function(t,e){var i=this;return e=e,this._animationInterval=setInterval(function(){e(i)},1e3/t),this._animationInterval}},{key:"hide",value:function(){this.hidden=!0}},{key:"show",value:function(){this.hidden=!1}},{key:"destroy",value:function(){this.engine.removeObject(this)}},{key:"engine",get:function(){return this._engine}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this._UIElement?this._position.set(this.engine.width/100*t.x,-this.engine.height/100*t.y,t.z):this._position=t}},{key:"UIElement",set:function(t){this._UIElement=t,null!=this.engine.ui?t?this.engine.ui.addObject(this):this.engine.ui.removeObject(this):new _t("UI not set for engine.")},get:function(){return this._UIElement}},{key:"collisionBox",get:function(){if(!this._collisionBox)throw new _t("Collision box is null");return this._collisionBox}},{key:"size",get:function(){return{base:{max:this.maxBaseSize,min:this.minBaseSize},current:{max:this.maxSize,min:this.minSize}}}}]),e}(),Mt=function(){function t(){f()(this,t),x()(this,"maxPoint",new _(0,0,0)),x()(this,"minPoint",new _(0,0,0)),x()(this,"points",[])}return v()(t,[{key:"generatePoints",value:function(){}}]),t}(),zt=Ft,Ut=function(t){function r(t,e){var i;f()(this,r),i=ut()(this,ct()(r).call(this,t)),x()(dt()(i),"textureBlockLocation",-1),x()(dt()(i),"mipmapFilter","LINEAR"),x()(dt()(i),"AUTO_GENERATE",0),x()(dt()(i),"QUICK_GENERATE",1),x()(dt()(i),"_mipmap",[]),x()(dt()(i),"_onTextureLoadedHandlers",[]),x()(dt()(i),"_width",-1),x()(dt()(i),"_height",-1),x()(dt()(i),"_image",new Image),x()(dt()(i),"_mipmapGenerationMethod",-1),i.engine=t,i.textureBlockLocation=i.engine.textures.length,i.engine.textures.push(dt()(i));var n=i.engine.webgl;return i.webglTexture=n.createTexture(),n.activeTexture(n.TEXTURE0+i.textureBlockLocation),n.bindTexture(n.TEXTURE_2D,i.webglTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,i.color),i}return mt()(r,t),v()(r,[{key:"setMipmapGenerationMethod",value:function(t){this._mipmapGenerationMethod=t}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this._image.width=t,this._image.height=e,this.loaded&&this._createWebglTexture()}},{key:"_createWebglTexture",value:function(){var t,i=this.engine.webgl;i.activeTexture(i.TEXTURE0+this.textureBlockLocation);var e=!0;switch(this.mipmapFilter){case"NEAREST":t=i.NEAREST,e=!1;break;case"LINEAR":t=i.LINEAR,e=!1;break;case"NEAREST_MIPMAP_NEAREST":t=i.NEAREST_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_NEAREST":case"NEAREST_MIPMAP_LINEAR":t=i.LINEAR_MIPMAP_NEAREST;break;case"LINEAR_MIPMAP_LINEAR":t=i.LINEAR_MIPMAP_LINEAR;break;default:e=!1,t=i.LINEAR}if(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),this._mipmapGenerationMethod==this.QUICK_GENERATE){if(this.width/this.height!=2)return console.warn("Wrong _image sizes for quick generation _mipmap.");for(var n=this.height,r=0;;){var o=document.createElement("canvas");if(o.width=n,o.height=n,o.getContext("2d").drawImage(this._image,r,0,n,n,0,0,n,n),this._mipmap.push(o),1==n)break;r+=n,n/=2}}e&&this._mipmapGenerationMethod!=this.AUTO_GENERATE?0<this._mipmap.length?this._mipmap.forEach(function(t,e){i.texImage2D(i.TEXTURE_2D,e,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}):(console.warn("Need to generate mipmaps for texture:"),console.warn(this)):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._image),(e||this._mipmapGenerationMethod==this.AUTO_GENERATE)&&c(this._width)&&c(this._height)?i.generateMipmap(i.TEXTURE_2D):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE))}},{key:"loadFrom",value:function(t){var e=this;this._image.src=t,this._image.addEventListener("load",function(){e.engine.textureLoaded(e),e.loaded=!0;for(var t=0;t<e._onTextureLoadedHandlers.length;t++)e._onTextureLoadedHandlers[t]();-1!=e._height&&-1!=e._width||(e._height=e._image.height,e._width=e._image.width),e._createWebglTexture()})}},{key:"image",get:function(){return this._image}},{key:"height",set:function(t){this._height=t,this._image.height=t},get:function(){return this._height}},{key:"width",set:function(t){this._width=t,this._image.width=t},get:function(){return this._width}}]),r}(Pt),Dt=function(){function e(t,o,s){var a,h=this;f()(this,e),x()(this,"elements",[]),t.split("\n").forEach(function(t){for(var e=t.split(" "),i=e.length;i--;)""!=e[i]&&"\r"!=e[i]||e.splice(i,1);if("newmtl"==e[0]&&(a=new Gt(e[1],o),h.elements.push(a)),"map_Kd"==e[0]){var n=new Ut(o),r=s.split("/");r.splice(-1,1),r=r.join("/"),n.loadFrom(r+e[1]),n.alpha=!0,a.texture=n}})}return v()(e,[{key:"getElementByName",value:function(t){for(var e=0;e<this.elements.length;e++){var i=this.elements[e];if(i.name==t)return i}return null}}]),e}(),Gt=function(){function i(t,e){f()(this,i),x()(this,"webgl",void 0),x()(this,"name",void 0),x()(this,"vertexes",[]),x()(this,"textureCoordinates",[]),x()(this,"normals",[]),x()(this,"vertexesBuffer",null),x()(this,"textureCoordinatesBuffer",null),x()(this,"normalsBuffer",null),x()(this,"texture",void 0),this.name=t,this.webgl=e.webgl,this.texture=e.noTexture}return v()(i,[{key:"commit",value:function(){this.vertexesBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webgl.STATIC_DRAW),this.textureCoordinatesBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.textureCoordinatesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.textureCoordinates),this.webgl.STATIC_DRAW),this.normalsBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.normalsBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.normals),this.webgl.STATIC_DRAW)}}]),i}(),Ot=function(t){function n(t){var e;return f()(this,n),e=ut()(this,ct()(n).call(this,t)),x()(dt()(e),"_drawingMode",void 0),x()(dt()(e),"afterLoadHidden",!1),x()(dt()(e),"mtl",null),x()(dt()(e),"onLoadHandlers",[]),x()(dt()(e),"mtlRequired",!1),x()(dt()(e),"mtlRequiredFunction",null),x()(dt()(e),"objLoaded",!1),e._drawingMode=e.webgl.TRIANGLES,e.hidden=!0,e.name="Just object :)",e}var e;return mt()(n,t),v()(n,[{key:"setDrawingMode",value:function(t){switch(t){case"TRIANGLES":case"DEFAULT":this._drawingMode=this.webgl.TRIANGLES;break;case"TRIANGLE_FAN":case"FAN":this._drawingMode=this.webgl.TRIANGLE_FAN;break;case"STRIP":case"TRIANGLE_STRIP":this.webgl.TRIANGLE_STRIP;break;default:throw Error("Wrong drawing mode. See WebGL drawing mods.")}}},{key:"compile",value:function(t){var d=this,f=[],m=[],v=[],e=t.split("\n"),b={x:[0,0],y:[0,0],z:[0,0]},x=null,_=this.vertexes,w=this.normals,p=this.textureCoordinates;if(e.forEach(function(t){for(var e=t.split(" "),i=e.length;i--;)""!=e[i]&&"\r"!=e[i]||e.splice(i,1);if("v"==e[0]){var n=parseFloat(e[1]),r=parseFloat(e[2]),o=parseFloat(e[3]);b.x[1]<n&&(b.x[1]=n),b.y[1]<r&&(b.y[1]=r),b.z[1]<o&&(b.z[1]=o),b.x[0]>n&&(b.x[0]=n),b.y[0]>r&&(b.y[0]=r),b.z[0]>o&&(b.z[0]=o),f.push([n,r,o])}else if("vn"==e[0])v.push([parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])]);else if("vt"==e[0])m.push([parseFloat(e[1]),parseFloat(e[2])]);else if(null!=d.mtl&&"usemtl"==e[0]){if(null==(x=d.mtl.getElementByName(e[1])))return;_=x.vertexes,w=x.normals,p=x.textureCoordinates}else if("f"==e[0]){var s=[e[1],e[2],e[3]];if(3<e.length-1)for(var a=4;a<e.length;a++)s.push(e[a-3]),s.push(e[a-1]),s.push(e[a]);for(var h=0;h<s.length;h++){var u=s[h].split("/").map(function(t){return Number(t)}),l=u[0];l<=0&&(l=f.length+l+1);var c=u[1];c<0&&(c=m.length+c+1);var g=u[2];g<0&&(g=v.length+g+1),f[l-1].forEach(function(t){_.push(t)}),null!=m[c-1]?(p.push(m[c-1][0]),p.push(Math.abs(1-m[c-1][1]))):(p.push(1),p.push(1)),null!=u[2]?v[g-1].forEach(function(t){w.push(t)}):w.push(1,1,1)}}}),this.mtl){for(var i=0;i<this.mtl.elements.length;i++){this.mtl.elements[i].commit()}this.draw;this.draw=this.drawWithMTL,this.drawWithMTL=this.draw}this.vertexesBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webgl.STATIC_DRAW),this.textureCoordinatesBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.textureCoordinatesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.textureCoordinates),this.webgl.STATIC_DRAW),this.normalsBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.normalsBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.normals),this.webgl.STATIC_DRAW),this.maxBaseSize.set(b.x[0],b.y[0],b.z[0]),this.minBaseSize.set(b.x[1],b.y[1],b.z[1]),this.maxSize.set(b.x[0],b.y[0],b.z[0]),this.minSize.set(b.x[1],b.y[1],b.z[1]),this.maxSize.scale(this.scaling.x,this.scaling.y,this.scaling.z),this.minSize.scale(this.scaling.x,this.scaling.y,this.scaling.z),this.collisionBox.maxPoint=this.maxBaseSize,this.collisionBox.minPoint=this.minBaseSize,this.engine.objectLoaded(this),this.hidden=this.afterLoadHidden,this.hide=function(){d.hidden=!0},this.show=function(){d.hidden=!1}}},{key:"hide",value:function(){this.afterLoadHidden=!0}},{key:"show",value:function(){this.afterLoadHidden=!1}},{key:"addOnLoadHandler",value:function(t){this.onLoadHandlers.push(t)}},{key:"onload",value:function(){var e=this;this.onLoadHandlers.forEach(function(t){t(e)})}},{key:"loadFromObj",value:function(t){var e=this,i=this,n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){4==n.readyState&&(e.mtl||!e.mtlRequired?(i.compile(n.responseText),i.onload(),i.objLoaded=!0):e.mtlRequiredFunction=function(){i.objLoaded=!0,i.compile(n.responseText),i.onload()})},n.send()}},{key:"loadMTL",value:(e=at()(ot.a.mark(function t(e){var i,n=this;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=new XMLHttpRequest,this.mtlRequired=!0,i.open("GET",e),i.onreadystatechange=function(){4==i.readyState?(n.mtl=new Dt(i.responseText,n.engine,e),n.objLoaded&&n.mtlRequiredFunction?n.mtlRequiredFunction():new kt("No MTL required function")):console.log("Error loading MTL")},i.send();case 5:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"useMaterial",value:function(t){var e=this;t.defaultDraw=this.draw,(t.object=this).draw=function(){t.drawObject(e)}}},{key:"drawWithMTL",value:function(){var e=this;!this.hidden&&this.shaderProgram&&this.mtl&&(this.shaderProgram.use(),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this.matrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.objectRotationLocation,!1,this.rotationMatrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.worldMatrixLocation,!1,this.worldMatrix),this.mtl.elements.forEach(function(t){null!=t.texture?e.engine.webgl.uniform1i(e.shaderProgram.textureLocation,t.texture.textureBlockLocation):e.engine.webgl.uniform1i(e.shaderProgram.textureLocation,e.texture.textureBlockLocation),e.engine.webgl.enableVertexAttribArray(e.shaderProgram.positionLocation),e.engine.webgl.bindBuffer(e.engine.webgl.ARRAY_BUFFER,t.vertexesBuffer),e.engine.webgl.vertexAttribPointer(e.shaderProgram.positionLocation,3,e.engine.webgl.FLOAT,!1,0,0),e.engine.webgl.enableVertexAttribArray(e.shaderProgram.texcoordLocation),e.engine.webgl.bindBuffer(e.engine.webgl.ARRAY_BUFFER,t.textureCoordinatesBuffer),e.engine.webgl.vertexAttribPointer(e.shaderProgram.texcoordLocation,2,e.engine.webgl.FLOAT,!1,0,0),e.engine.webgl.enableVertexAttribArray(e.shaderProgram.normalLocation),e.engine.webgl.bindBuffer(e.engine.webgl.ARRAY_BUFFER,t.normalsBuffer),e.engine.webgl.vertexAttribPointer(e.shaderProgram.normalLocation,3,e.engine.webgl.FLOAT,!1,0,0),e.engine.webgl.drawArrays(e.engine.webgl.TRIANGLES,0,t.vertexes.length/3)}))}},{key:"copy",value:function(){var t=this,e=new n(this.engine);for(var i in It()({},this))e[i]=this[i];return e.position=this.position.copy(),e.scaling=this.scaling.copy(),e.rotation=this.rotation.copy(),e.hide=function(){e.hidden=!0},e.show=function(){e.hidden=!1},e.hide(),this.addOnLoadHandler(function(){!function(t,e){t.vertexes=e.vertexes,t.normals=e.normals,t.textureCoordinates=e.textureCoordinates,t.vertexesBuffer=e.vertexesBuffer,t.normalsBuffer=e.normalsBuffer,t.textureCoordinatesBuffer=e.textureCoordinatesBuffer,t.mtl=e.mtl,t.draw=e.draw,t.maxBaseSize=e.maxBaseSize,t.maxSize=e.maxSize,t.shaderProgram=e.shaderProgram}(e,t),t.engine.objectLoaded(e),e.show()}),e}},{key:"drawingMode",set:function(t){this._drawingMode=t},get:function(){return this._drawingMode}}]),n}(Ft),jt=function(){function i(t){var e=this;f()(this,i),x()(this,"div",void 0),x()(this,"canvas",void 0),x()(this,"webgl",void 0),x()(this,"width",void 0),x()(this,"height",void 0),x()(this,"camera",null),x()(this,"debugger",null),x()(this,"controls",null),x()(this,"lightsPositions",[]),x()(this,"lightsRanges",[]),x()(this,"globalLightMinValue",.5),x()(this,"noTexture",void 0),x()(this,"reflections",!1),x()(this,"status","Creating"),x()(this,"selectedObject",null),x()(this,"shaders",void 0),x()(this,"textures",[]),x()(this,"lights",[]),x()(this,"_ui",null),x()(this,"_objectsWithoutAlpha",[]),x()(this,"_objectsWithAlpha",[]),x()(this,"_resourcesLoaded",!1),x()(this,"_texturesLoaded",!1),x()(this,"_objectsLoaded",!1),x()(this,"_loadedObjectsCount",0),x()(this,"_loadedTexturesCount",0),x()(this,"_onResourcesLoadedHandlers",[]),x()(this,"_onObjectSelectedHandlers",[]),x()(this,"_running",!1),x()(this,"_onRun",[]),x()(this,"_onFrameHandlers",[]),this.div=t,this.width=t.offsetWidth,this.height=t.offsetHeight,this.canvas=document.createElement("canvas"),this.canvas.width=t.offsetWidth,this.canvas.height=t.offsetHeight,this.webgl=xt(this.canvas),this.addOnResourcesLoadedListener(function(){e.reflections?e.status="Creating reflections":(e.appendCanvas(),e.status="Drawing")}),this.shaders=new Tt(this.webgl),this.shaders.default.use(),this.webgl.viewport(0,0,this.width,this.height),this.webgl.enable(this.webgl.CULL_FACE),this.webgl.enable(this.webgl.DEPTH_TEST),this.noTexture=new Ct(this),this.infoConsoleLog()}var t,e;return v()(i,[{key:"appendCanvas",value:function(){this.div.appendChild(this.canvas),this.onCanvasResized()}},{key:"setCamera",value:function(t){this.camera=t}},{key:"onCanvasResized",value:function(){0!=this.canvas.clientWidth&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight),this.webgl.viewport(0,0,this.width,this.height)}},{key:"addObject",value:function(t){t.texture.alpha||t instanceof Ot&&t.mtl?this._objectsWithAlpha.push(t):this._objectsWithoutAlpha.push(t)}},{key:"removeObject",value:function(t){var e=-1;return t.texture.alpha?(-1==(e=this._objectsWithAlpha.indexOf(t))&&(console.warn("Objects",this.objects),new kt("Object not found")),this._objectsWithAlpha.splice(e,1)[0]):(-1==(e=this._objectsWithoutAlpha.indexOf(t))&&(console.warn("Objects",this.objects),new kt("Object not found")),this._objectsWithoutAlpha.splice(e,1)[0])}},{key:"addOnObjectSelectedListener",value:function(t){this._onObjectSelectedHandlers.push(t)}},{key:"addOnResourcesLoadedListener",value:function(t){this._onResourcesLoadedHandlers.push(t)}},{key:"textureLoaded",value:function(t){this._loadedTexturesCount+=1,t.loaded=!0,this.running&&this._loadedTexturesCount==this.textures.length&&(this._texturesLoaded=!0,this.objectsLoaded&&(this._resourcesLoaded=!0,this._onResourcesLoadedHandlers.forEach(function(t){t()})))}},{key:"objectLoaded",value:function(t){var e=this.objects.length;this.ui&&(e+=this.ui.objects.length),this._loadedObjectsCount+=1,t.loaded=!0,this.running&&this._loadedObjectsCount>=e&&(this._objectsLoaded=!0,this._texturesLoaded&&(this._resourcesLoaded=!0,this._onResourcesLoadedHandlers.forEach(function(t){t()})))}},{key:"setDrawingRange",value:function(t){if(null==this.camera)throw"Failed to set drawing range. Camera wasn't set.";this.camera.range=t}},{key:"drawToFrameBuffer",value:function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=this.webgl;r.bindFramebuffer(r.FRAMEBUFFER,t),r.enable(this.webgl.CULL_FACE),r.enable(this.webgl.DEPTH_TEST),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.viewport(0,0,e,i),n&&this.update(),this.draw(),r.bindFramebuffer(r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)}},{key:"captureFrame",value:function(t,e){var i=this.camera,n=[this.canvas.width,this.canvas.height],r=!1,o=128,s=128,a="rgba(0, 0, 0, 0)",h=1,u=1,l=[];null!=e&&(r=e.drawUI||r,o=e.height||o,s=e.width||s,a=e.background||a,h=e.backgroundAlpha||h,u=e.imageAlpha||u,l=e.noDrawObjects||[]),this.width=s,this.height=o,this.canvas.width=s,this.canvas.height=o,this.onCanvasResized(),this.camera=t,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT|this.webgl.DEPTH_BUFFER_BIT),this.shaders.default.use(),this.webgl.uniform3fv(this.shaders.default.lightPositionsLocation,this.lightsPositions),this.webgl.uniform1fv(this.shaders.default.lightRangesLocation,this.lightsRanges),this.webgl.uniform1i(this.shaders.default.lightsCountLocation,this.lights.length),this.webgl.uniform1f(this.shaders.default.lightMinValueLocation,this.globalLightMinValue),this.update();for(var c=0;c<this.objects.length;c++){var g=this.objects[c];-1==l.indexOf(g)&&(!r&&g.UIElement||g.draw())}var d=document.createElement("canvas");d.height=this.canvas.height,d.width=this.canvas.width;var f=d.getContext("2d");return f.globalAlpha=h,"string"==typeof a?(f.fillStyle=a,f.fillRect(0,0,this.canvas.width,this.canvas.height)):a.constructor===HTMLImageElement&&f.drawImage(a,0,0,d.width,d.height),f.globalAlpha=u,f.drawImage(this.canvas,0,0),this.camera=i,this.canvas.width=n[0],this.canvas.height=n[1],this.width=n[0],this.height=n[1],this.onCanvasResized(),d}},{key:"render",value:function(){this.beforeFrame(),this.update(),this.draw()}},{key:"run",value:function(){var e=this;(Lt=this)._running=!0,this.status="Loading resources",this._loadedTexturesCount==this.textures.length&&(this._texturesLoaded=!0);var t=this.objects.length;this.ui&&(t+=this.ui.objects.length+1),this._loadedObjectsCount==t&&(this._objectsLoaded=!0,this.textureLoaded&&(this._resourcesLoaded=!0,this._onResourcesLoadedHandlers.forEach(function(t){t(e.textures.length)}))),Nt();for(var i=0;i<this._onRun.length;i++)this._onRun[i]}},{key:"stop",value:function(){this._running=!1}},{key:"addOnFrameHandler",value:function(t){return this._onFrameHandlers.push(t),t}},{key:"removeOnFrameHandler",value:function(t){var e=this._onFrameHandlers.indexOf(t);this._onFrameHandlers.splice(e,1)}},{key:"beforeFrame",value:function(){for(var t=0;t<this._onFrameHandlers.length;t++){(0,this._onFrameHandlers[t])()}}},{key:"update",value:(e=at()(ot.a.mark(function t(){var e,i,n,r,o,s=this;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.camera&&this.controls&&this.controls.controlFunction)){t.next=10;break}this.camera.moving.set(0,0,0),this.camera.moving.add(this.camera.animatedMoving),this.controls.controlFunction(),null!=this.debugger&&this.debugger.updateInfo(),this.camera.isCollision=!1,this.controls.mouse.movement.x=0,this.controls.mouse.movement.y=0,t.next=11;break;case 10:return t.abrupt("return");case 11:for(this.selectedObject=null,e=this._objectsWithoutAlpha.length;e--;)(i=this._objectsWithoutAlpha[e]).updateMatrixes(),this.camera.collisions&&i.checkCollision&&i.checkCollision(this.camera.position,this.camera.moving,this.camera.collisionBox,function(t){s.camera.moving[t]=0,s.camera.isCollision=!0});for(n=this._objectsWithAlpha.length;n--;)(r=this._objectsWithAlpha[n]).updateMatrixes(),this.camera.collisions&&r.checkCollision&&r.checkCollision(this.camera.position,this.camera.moving,this.camera.collisionBox,function(t){s.camera.moving[t]=0,s.camera.isCollision=!0});if(this.camera.position.move(this.camera.moving.x,this.camera.moving.y,this.camera.moving.z),this.camera.computeMatrix(),this.ui&&this.ui.objects.forEach(function(t){t.updateMatrixes(),t.update()}),this._objectsWithoutAlpha.forEach(function(t,e){t.update(),t.texture.alpha&&(s._objectsWithAlpha.push(t),s._objectsWithoutAlpha.splice(e,1))}),this._objectsWithAlpha.sort(function(t,e){return R(e.position,s.camera.position)-R(t.position,s.camera.position)}),this._objectsWithAlpha.forEach(function(t){t.update()}),this.selectedObject&&0<this._onObjectSelectedHandlers.length)for(o=0;o<this._onObjectSelectedHandlers.length;o++)this._onObjectSelectedHandlers[o]();case 21:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"draw",value:(t=at()(ot.a.mark(function t(){var e=this;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.webgl.clear(this.webgl.COLOR_BUFFER_BIT|this.webgl.DEPTH_BUFFER_BIT),this.shaders.default.use(),this.webgl.uniform3fv(this.shaders.default.lightPositionsLocation,this.lightsPositions),this.webgl.uniform1fv(this.shaders.default.lightRangesLocation,this.lightsRanges),this.webgl.uniform1i(this.shaders.default.lightsCountLocation,this.lights.length),this.webgl.uniform1f(this.shaders.default.lightMinValueLocation,this.globalLightMinValue),this.shaders.shadersRequireLights.forEach(function(t){t.use(),e.webgl.uniform3fv(t.lightPositionsLocation,e.lightsPositions),e.webgl.uniform1fv(t.lightRangesLocation,e.lightsRanges),e.webgl.uniform1i(t.lightsCountLocation,e.lights.length),e.webgl.uniform1f(t.lightMinValueLocation,e.globalLightMinValue)}),this.ui&&this.ui.draw(),this.objects.forEach(function(){var e=at()(ot.a.mark(function t(e){return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.draw();case 2:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),this._objectsWithAlpha.forEach(function(t){t.draw()}),this.ui&&this.ui.drawUI();case 11:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"infoConsoleLog",value:function(){console.log(),console.log("   %c%s","color: rgba(247, 137, 74, 1); text-align: center; font-size: 16px; font-weight: 700","Bronze Engine is running"),console.log(),console.info("   Version : 0.3.002"),console.info("   Docs  : http://m0ksem.design/Bronze-Engine/docs/global"),console.info("   GitHub  : https://github.com/m0ksem/Bronze-Engine"),console.info("   Author  : https://github.com/m0ksem"),console.log()}},{key:"ui",set:function(t){this._ui=t;var e=this.objects.length+this.ui.objects.length;this._loadedObjectsCount+=1,this.running&&this._loadedObjectsCount==e&&(this._objectsLoaded=!0,this._texturesLoaded&&(this._resourcesLoaded=!0,this._onResourcesLoadedHandlers.forEach(function(t){t()})))},get:function(){return this._ui}},{key:"objects",get:function(){return this._objectsWithoutAlpha.concat(this._objectsWithAlpha)}},{key:"resourcesLoaded",get:function(){return this._resourcesLoaded}},{key:"texturesLoaded",get:function(){return this._texturesLoaded}},{key:"objectsLoaded",get:function(){return this._objectsLoaded}},{key:"running",get:function(){return this._running}}]),i}();function Nt(){requestAnimationFrame(Nt),Lt.running&&Lt.render()}!function(){for(var r=0,t=["ms","moz","webkit","o"],e=window,i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=e[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=e[t[i]+"CancelAnimationFrame"]||e[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-r)),n=window.setTimeout(function(){t(e+i)},i);return r=e+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Xt=function(){function e(t){f()(this,e),x()(this,"fieldOfView",90),x()(this,"fieldOfViewRad",h(90)),x()(this,"rotation",new _(0,0,0)),x()(this,"range",2e4),x()(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"rotationMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"inverseMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"inverseRotationMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x()(this,"moved",!1),x()(this,"moving",new _(0,0,0)),x()(this,"animatedMoving",new _(0,0,0)),x()(this,"collisionBox",new Mt),x()(this,"collisions",!0),x()(this,"isCollision",!1),x()(this,"engine",void 0),x()(this,"_position",new _(0,400,500)),this.engine=t}return v()(e,[{key:"setCubeCollisionBox",value:function(t){var e=t/2;this.collisionBox.minPoint.x=-e,this.collisionBox.minPoint.y=-e,this.collisionBox.minPoint.z=-e,this.collisionBox.maxPoint.x=e,this.collisionBox.maxPoint.y=e,this.collisionBox.maxPoint.z=e}},{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=h(t)}},{key:"setCollisions",value:function(t){this.collisions=t}},{key:"onCollision",value:function(t){this.moving.x=0,this.moving.y=0,this.moving.z=0,this.isCollision=!0}},{key:"setPosition",value:function(t,e,i){this.position.set(t,e,i)}},{key:"move",value:function(t,e,i){this.moving.move(t,e,i),this.moved=!0}},{key:"moveAnimate",value:function(t,e,i){var n=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100,o=new _(t/=r,e/=r,i/=r);this.animatedMoving.add(o);var s=r,a=this.engine.addOnFrameHandler(function(){(s-=1)<=0&&(n.engine.removeOnFrameHandler(a),n.animatedMoving.sub(o))})}},{key:"rotate",value:function(t,e,i){this.rotation.x+=t,this.rotation.y+=e,this.rotation.z+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation.set(t,e,i),this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=N(this.position.x,this.position.y,this.position.z);var t=V(h(this.rotation.y));t=K(t=K(t,W(h(this.rotation.x))),q(h(this.rotation.z))),this.matrix=K(this.matrix,t),this.rotationMatrix=t,this.inverseRotationMatrix=et(t),this.inverseMatrix=et(this.matrix)}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.computeMatrix()}}]),e}(),Ht=function(){function n(s){var a=this;f()(this,n),x()(this,"engine",void 0),x()(this,"isFocused",!1),x()(this,"keys",[]),x()(this,"mouseOverCanvas",!1),x()(this,"pointerLocked",!1),x()(this,"mouse",new Yt),x()(this,"touch",new Wt),x()(this,"longTouchTime",500),x()(this,"touchDuration",100),x()(this,"controlFunction",null),x()(this,"_lockPointer",!1),x()(this,"_rebind",!0),x()(this,"_globalRebind",!1),x()(this,"_handlers",[]),x()(this,"_focusHandlers",[]),x()(this,"_blurHandlers",[]),x()(this,"_focusOnlyIfClick",!0),x()(this,"_mouseDownHandlers",[null,null,null,null,null,null]),x()(this,"_mouseUpHandlers",[null,null,null,null,null,null]),(s.controls=this).engine=s;for(var t=0;t<255;t++)this.keys[t]=!1,this._handlers[t]=null;if(window.onkeydown=function(t){return a.isFocused?(27==t.keyCode&&s.div.blur(),a.keys[t.keyCode]=!0,null!=a._handlers[t.keyCode]&&a._handlers[t.keyCode](t),!a._rebind):!a._globalRebind||!a._rebind},window.onkeyup=function(t){return a.keys[t.keyCode]=!1,!a._rebind},s.div.setAttribute("tabindex","0"),s.div.onblur=function(){a.isFocused=!1;for(var t=0;t<a._blurHandlers.length;t++)a._blurHandlers[t]()},s.div.onfocus=function(){a.isFocused=!0;for(var t=0;t<a._focusHandlers.length;t++)a._focusHandlers[t]()},s.div.onclick=function(){a._focusOnlyIfClick&&!a.isFocused&&s.div.focus(),a._lockPointer&&s.div.requestPointerLock()},s.div.oncontextmenu=function(){return!1},function(){var t=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)return!0;var e=["(",t.join("touch-enabled),("),"heartz",")"].join("");return function(t){return window.matchMedia(t).matches}(e)}()){var e,h,i=function(){a.touch.duration=(new Date).getTime()-e,a.touch.duration>a.longTouchTime&&(a.touch.longClick=!0,a.touch.click=!1,clearInterval())},u=!1;s.div.addEventListener("touchstart",function(t){return null!=a._mouseDownHandlers[2]&&a._mouseDownHandlers[2](t),h=setInterval(i,100),e=(new Date).getTime(),a.touch.duration=0,u=!1},!1),s.div.addEventListener("touchend",function(t){return!u&&a.touch.duration<a.longTouchTime?(a.touch.click=!0,setTimeout(function(){a.touch.click=!1},100)):a.touch.actionBeforeMove=null,l=null,a.touch.longClick=!1,clearInterval(h),!1},!1);var l=null;s.div.addEventListener("touchmove",function(t){var e=s.div.getBoundingClientRect(),i=t.touches[0].clientX-e.left,n=t.touches[0].clientY-e.top;a.mouse.x=i,a.mouse.y=n,null==l&&(l=new P(i,n));var r=(i-l.x)*a.mouse.sensitivity,o=(n-l.y)*a.mouse.sensitivity;a.mouse.movement.x=r,a.mouse.movement.y=o,l.x=i,l.y=n,a.touch.x=i,a.touch.y=n,a.touch.movement.x=r,a.touch.movement.y=o,u||(a.touch.duration>a.longTouchTime?(a.touch.actionBeforeMove="long click",a.touch.longClick=!1):(a.touch.actionBeforeMove="click",a.touch.click=!1)),u=!0,clearInterval(h)},!1)}else{var r=null;s.div.addEventListener("mousemove",function(t){if(a.isFocused)if(a.pointerLocked)a.mouse.movement.x=-t.movementX*a.mouse.sensitivity,a.mouse.movement.y=-t.movementY*a.mouse.sensitivity,a.mouse.x=a.engine.width/2,a.mouse.y=a.engine.height/2;else{var e=s.div.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;a.mouse.x=i,a.mouse.y=n,null==r&&(r=new P(i,n)),a.mouse.movement.x=(i-r.x)*a.mouse.sensitivity,a.mouse.movement.y=(n-r.y)*a.mouse.sensitivity,r.x=i,r.y=n}},!1),window.addEventListener("mousemove",function(t){var e=s.div.getBoundingClientRect(),i=t.clientX,n=t.clientY;i<e.right&&i>e.left&&n<e.bottom&&n>e.top?(a.mouseOverCanvas=!0,a._focusOnlyIfClick||a.isFocused||s.div.focus()):(a.mouseOverCanvas=!1,a._focusOnlyIfClick||s.div.blur())}),s.div.onmousedown=function(t){if(a.isFocused)return a.mouse.buttons[t.button]=!0,null!=a._mouseDownHandlers[2+t.button]&&a._mouseDownHandlers[2+t.button](t),!1},s.div.onmouseup=function(t){return a.mouse.buttons[t.button]=!1,null!=a._mouseUpHandlers[2+t.button]&&a._mouseUpHandlers[2+t.button](t),!1},document.addEventListener("pointerlockchange",function(){document.pointerLockElement===s.div?(s.div.focus(),a.pointerLocked=!0):(s.div.blur(),a.pointerLocked=!1)},!1)}}return v()(n,[{key:"clickForFocus",value:function(t){t=t||!this._focusOnlyIfClick,this._focusOnlyIfClick=t}},{key:"setSensitivity",value:function(t){this.mouse.sensitivity=t}},{key:"rebindDefaultBrowserActions",value:function(t){t=t||!this._rebind,this._rebind=t}},{key:"globalRebind",value:function(t){t=t||!this._globalRebind,this._globalRebind=t}},{key:"addOnFocusHandler",value:function(t){this._focusHandlers.push(t)}},{key:"addOnBlurHandler",value:function(t){this._blurHandlers.push(t)}},{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseDownHandlers[2+t]=e}},{key:"onMouseUp",value:function(t,e){this._mouseUpHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){this.engine.div.addEventListener("mousemove",t,!1)}},{key:"onContextMenu",value:function(t){this.engine.div.oncontextmenu=t}},{key:"lockPointer",value:function(t){t=t||!this._lockPointer,this._lockPointer=t}},{key:"setControlFunction",value:function(t){this.controlFunction=t}}]),n}(),Yt=function t(){f()(this,t),x()(this,"x",0),x()(this,"y",0),x()(this,"movement",new P(0,0)),x()(this,"click",!1),x()(this,"longClick",!1),x()(this,"duration",null),x()(this,"actionBeforeMove",null),x()(this,"sensitivity",1),x()(this,"buttons",[!1,!1,!1])},Wt=function t(){f()(this,t),x()(this,"x",0),x()(this,"y",0),x()(this,"movement",new P(0,0)),x()(this,"click",!1),x()(this,"longClick",!1),x()(this,"duration",null),x()(this,"actionBeforeMove",null)};var Vt=function(){function i(t){f()(this,i),x()(this,"canvas",void 0),x()(this,"div",void 0),x()(this,"width",void 0),x()(this,"height",void 0),x()(this,"centerX",void 0),x()(this,"centerY",void 0),x()(this,"context",void 0),x()(this,"objects",void 0),x()(this,"htmlElements",void 0),x()(this,"engine",void 0),x()(this,"Screen",qt),x()(this,"images",[]),x()(this,"webgl",void 0),x()(this,"_screen",void 0),x()(this,"_texture",void 0),x()(this,"_webglTexture",void 0),x()(this,"frameBuffer",void 0),this.width=t.div.offsetWidth,this.height=t.div.offsetHeight,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.position="absolute",this.canvas.style.height="100%",this.canvas.style.width="100%",this.canvas.style.zIndex="999999",this.canvas.style.left="0",this.canvas.style.right="0",this.canvas.style.top="0",this.div=document.createElement("div"),this.div.style.position="absolute",this.div.style.height="100%",this.div.style.width="100%",this.div.style.zIndex="999999",this.div.style.left="0",this.div.style.right="0",this.div.style.top="0",t.div.appendChild(this.canvas),t.div.appendChild(this.div),this.centerX=this.width/2,this.centerY=this.height/2,this.context=this.canvas.getContext("2d"),this.objects=[],this.htmlElements=[],(t.ui=this).engine=t,this.webgl=t.webgl,this._screen=new qt(this.engine),this._texture={_textureBlockLocation:this.engine.textures.length},this.engine.textures.push(this._texture),this.engine.textureLoaded(this._texture),this.engine.webgl.activeTexture(this.engine.webgl.TEXTURE0+this._texture._textureBlockLocation),this._webglTexture=this.webgl.createTexture(),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this._webglTexture),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,this.webgl.RGBA,this.width,this.height,0,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,null),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE),this.frameBuffer=this.webgl.createFramebuffer(),this.webgl.bindFramebuffer(this.webgl.FRAMEBUFFER,this.frameBuffer),this.webgl.framebufferTexture2D(this.webgl.FRAMEBUFFER,this.webgl.COLOR_ATTACHMENT0,this.webgl.TEXTURE_2D,this._webglTexture,0);var e=this.webgl.createRenderbuffer();this.webgl.bindRenderbuffer(this.webgl.RENDERBUFFER,e),this.webgl.renderbufferStorage(this.webgl.RENDERBUFFER,this.webgl.DEPTH_COMPONENT16,this.width,this.height),this.webgl.framebufferRenderbuffer(this.webgl.FRAMEBUFFER,this.webgl.DEPTH_ATTACHMENT,this.webgl.RENDERBUFFER,e),this.webgl.bindFramebuffer(this.webgl.FRAMEBUFFER,null)}var t;return v()(i,[{key:"addObject",value:function(t){this.objects.push(t),this.engine.removeObject(t)}},{key:"removeObject",value:function(t){var e=this.objects.indexOf(t);-1!=e?(this.objects.splice(e,1),this.engine.addObject(t)):console.warn("Object not found")}},{key:"appendDOMElement",value:function(t,e){return this.div.appendChild(t),this.htmlElements.push(new Zt(e,t)),t}},{key:"addImage",value:function(t,e,i,n,r){t.width=e,t.height=i;var o=new Jt("",t,n,r,e,i);return this.images.push(o),this.images[this.images.length-1]}},{key:"hide",value:function(t){t instanceof Ut?t=t.image:t instanceof Zt&&(t.hidden=!0,t=t.el),t.style.display="none"}},{key:"show",value:function(t){t instanceof Ut?t=t.image:t instanceof Zt&&(t.hidden=!1,t=t.el),t.style.display="block"}},{key:"drawImage",value:function(t){this.context.drawImage(t,0,0)}},{key:"clearCanvas",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"draw",value:(t=at()(ot.a.mark(function t(){var e,i=this;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(e=this.engine.webgl).bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.enable(this.webgl.CULL_FACE),e.enable(this.webgl.DEPTH_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,this.engine.width,this.engine.height),this.context.clearRect(0,0,this.width,this.height),this.images.forEach(function(t){if(!t.hidden&&t.el instanceof HTMLImageElement){var e=t.el;i.context.drawImage(e,t.x,t.y,t.width,t.height)}}),this.objects.forEach(function(t){t.draw()}),this._screen.setTexture(this._texture),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);case 14:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"drawUI",value:function(){this._screen.draw()}}]),i}(),qt=function(){function e(t){f()(this,e),x()(this,"webgl",void 0),x()(this,"engine",void 0),x()(this,"shaderProgram",void 0),x()(this,"vertexes",void 0),x()(this,"textureCoords",void 0),x()(this,"vertexesBuffer",void 0),x()(this,"coordsBuffer",void 0),x()(this,"normalBuffer",void 0),x()(this,"texture",void 0),this.webgl=t.webgl,this.engine=t,this.shaderProgram=t.shaders.screen,this.webgl.enable(this.webgl.CULL_FACE),this.webgl.enable(this.webgl.DEPTH_TEST),this.vertexes=[-1,-1,-1,1,1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1],this.textureCoords=[0,0,1,1,0,1,1,1,0,0,1,0],this.vertexesBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webgl.STATIC_DRAW),this.coordsBuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.coordsBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webgl.STATIC_DRAW)}return v()(e,[{key:"setTexture",value:function(t){this.texture=t}},{key:"draw",value:function(){this.webgl.bindFramebuffer(this.webgl.FRAMEBUFFER,null),this.shaderProgram.use(),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.texcoordLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.coordsBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.texcoordLocation,2,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.uniform1i(this.shaderProgram.textureLocation,this.texture._textureBlockLocation),this.engine.webgl.drawArrays(this.engine.webgl.TRIANGLES,0,this.vertexes.length/3)}}]),e}(),Zt=function(){function i(t,e){f()(this,i),x()(this,"name",void 0),x()(this,"el",void 0),x()(this,"hidden",!1),this.name=t,this.el=e}return v()(i,[{key:"hide",value:function(){this.el.style.display="none",this.hidden=!0}},{key:"show",value:function(){this.el.style.display="block",this.hidden=!1}}]),i}(),Jt=function(t){function a(t,e,i,n,r,o){var s;return f()(this,a),s=ut()(this,ct()(a).call(this,t,e)),x()(dt()(s),"x",0),x()(dt()(s),"y",0),x()(dt()(s),"width",0),x()(dt()(s),"height",0),s.x=i,s.y=n,s.width=r,s.height=o,s}return mt()(a,t),a}(Zt),Kt=function(){function e(t){f()(this,e),x()(this,"logArray",void 0),x()(this,"element",void 0),(t.debugger=this).logArray=[],this.element=null}return v()(e,[{key:"setElement",value:function(t){this.element=t}},{key:"addLog",value:function(t,e){this.logArray.push({view:t,output:e}),this.addView(t)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}}]),e}(),Qt=function(t){function i(t){var e;return f()(this,i),e=ut()(this,ct()(i).call(this,t)),x()(dt()(e),"textures",void 0),x()(dt()(e),"_onTextureLoad",void 0),x()(dt()(e),"webgl",void 0),x()(dt()(e),"_loadedTextureCount",0),e.engine=t,e.engine.textures.push(dt()(e)),e.webgl=t.webgl,e.textureBlockLocation=e.engine.textures.length,e.webglTexture=e.engine.webgl.createTexture(),e.engine.webgl.activeTexture(e.engine.webgl.TEXTURE0+e.textureBlockLocation),e.engine.webgl.bindTexture(e.engine.webgl.TEXTURE_2D,e.webglTexture),e.engine.webgl.texImage2D(e.engine.webgl.TEXTURE_2D,0,e.engine.webgl.RGBA,1,1,0,e.engine.webgl.RGBA,e.engine.webgl.UNSIGNED_BYTE,e.color),e._onTextureLoad=[],e.loaded=!1,e.textures={positiveX:null,negativeX:null,positiveY:null,negativeY:null,positiveZ:null,negativeZ:null},e._loadedTextureCount=0,e}return mt()(i,t),v()(i,[{key:"setImagesFromPath",value:function(t,e,i,n,r,o){var s=this;this.textures.positiveX=new Image,this.textures.positiveX.crossOrigin="",this.textures.positiveX.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())},this.textures.positiveX.src=t,this.textures.negativeX=new Image,this.textures.negativeX.crossOrigin="",this.textures.negativeX.src=e,this.textures.negativeX.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())},this.textures.positiveY=new Image,this.textures.positiveY.crossOrigin="",this.textures.positiveY.src=i,this.textures.positiveY.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())},this.textures.negativeY=new Image,this.textures.negativeY.crossOrigin="",this.textures.negativeY.src=n,this.textures.negativeY.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())},this.textures.positiveZ=new Image,this.textures.positiveZ.crossOrigin="",this.textures.positiveZ.src=r,this.textures.positiveZ.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())},this.textures.negativeZ=new Image,this.textures.negativeZ.crossOrigin="",this.textures.negativeZ.src=o,this.textures.negativeZ.onload=function(){s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}}},{key:"setLoadingImages",value:function(t,e,i,n,r,o){for(var s=this,a=0;a<arguments.length-1;a++)if(arguments[a].width!=arguments[a].height||arguments[a].height!=arguments[a+1].height||arguments[a+1].width!=arguments[a+1].height)throw"Sizes of textures not are the same or texture isnt square.";this.textures.positiveX=this.engine.noTexture.webglTexture,t.addEventListener("load",function(){s.textures.positiveX=t,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}),this.textures.negativeX=this.engine.noTexture.webglTexture,e.addEventListener("load",function(){s.textures.negativeX=e,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}),this.textures.positiveY=this.engine.noTexture.webglTexture,i.addEventListener("load",function(){s.textures.positiveY=i,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}),this.textures.negativeY=this.engine.noTexture.webglTexture,n.addEventListener("load",function(){s.textures.negativeY=n,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}),this.textures.positiveZ=this.engine.noTexture.webglTexture,r.addEventListener("load",function(){s.textures.positiveZ=r,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())}),this.textures.negativeZ=this.engine.noTexture.webglTexture,o.addEventListener("load",function(){s.textures.negativeZ=o,s._loadedTextureCount++,6==s._loadedTextureCount&&(s.loaded=!0,s._onTextureLoad.forEach(function(t){t(s)}),s.bindCubeTexture())})}},{key:"setLoadedImages",value:function(t,e,i,n,r,o){this.textures.positiveX=t,this.textures.negativeX=e,this.textures.positiveY=i,this.textures.negativeY=n,this.textures.positiveZ=r,this.textures.negativeZ=o,this.loaded=!0,this.bindCubeTexture()}},{key:"setSkybox",value:function(t){var o=this,s=new Image;s.crossOrigin="",s.src=t,s.onload=function(){var t,e=s.width,i=s.height;if(i/3!=e/4)throw"Wrong sizes for texture. Texture must be Skyblock 3x4 squares.";t=i/3;var n=document.createElement("canvas");n.height=t,n.width=t;var r=n.getContext("2d");r.drawImage(s,0,t,t,t,0,0,t,t),o.textures.negativeX=n,(n=document.createElement("canvas")).height=t,n.width=t,(r=n.getContext("2d")).drawImage(s,2*t,t,t,t,0,0,t,t),o.textures.positiveX=n,(n=document.createElement("canvas")).height=t,n.width=t,(r=n.getContext("2d")).drawImage(s,t,t,t,t,0,0,t,t),o.textures.positiveZ=n,(n=document.createElement("canvas")).height=t,n.width=t,(r=n.getContext("2d")).drawImage(s,3*t,t,t,t,0,0,t,t),o.textures.negativeZ=n,(n=document.createElement("canvas")).height=t,n.width=t,(r=n.getContext("2d")).drawImage(s,t,0,t,t,0,0,t,t),o.textures.positiveY=n,(n=document.createElement("canvas")).height=t,n.width=t,(r=n.getContext("2d")).drawImage(s,t,2*t,t,t,0,0,t,t),o.textures.negativeY=n,o.loaded=!0,o._onTextureLoad.forEach(function(t){t(o)}),o.bindCubeTexture()}}},{key:"bindCubeTexture",value:function(){this.engine.webgl.activeTexture(this.engine.webgl.TEXTURE0+this.textureBlockLocation),this.webglTexture=this.webgl.createTexture(),this.webgl.bindTexture(this.webgl.TEXTURE_CUBE_MAP,this.webglTexture),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveX),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeX),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveY),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeY),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveZ),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeZ),this.webgl.generateMipmap(this.webgl.TEXTURE_CUBE_MAP),this.webgl.texParameteri(this.webgl.TEXTURE_CUBE_MAP,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR),this.engine.textureLoaded(this),this.loaded=!0}}]),i}(Pt),$t=[],te=0,ee=function(t){function h(t,e,i,n){var r;f()(this,h),r=ut()(this,ct()(h).call(this,t)),x()(dt()(r),"_background",void 0),x()(dt()(r),"_quality",void 0),x()(dt()(r),"_reflectionAlpha",-1),x()(dt()(r),"_object",void 0),x()(dt()(r),"_camera",void 0),$t.push(dt()(r)),t.reflections=!0,r.alpha=!0,r.loaded=!1,r._background=e||"rgba(0, 0, 0, 0)",r._quality=i||512,r._object=null;var o=document.createElement("canvas"),s=o.getContext("2d");if(o.width=16,o.height=16,"string"==typeof e){if(n)r._reflectionAlpha=Number(n);else{var a=e.replace("rgba(","");a=(a=a.replace(")","")).split(",")[3],r._reflectionAlpha=Number(a)}s.fillStyle=e,s.fillRect(0,0,16,16)}else e.constructor===HTMLImageElement&&(r._reflectionAlpha=n?Number(n):1,o.width=Number(e.width),o.height=Number(e.height),s.drawImage(e,0,0,e.width,e.height));return r.webglTexture=r.webgl.createTexture(),r.webgl.bindTexture(r.webgl.TEXTURE_CUBE_MAP,r.webglTexture),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_POSITIVE_X,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.texImage2D(r.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r.webgl.RGBA,r.webgl.RGBA,r.webgl.UNSIGNED_BYTE,o),r.webgl.generateMipmap(r.webgl.TEXTURE_CUBE_MAP),r.webgl.texParameteri(r.webgl.TEXTURE_CUBE_MAP,r.webgl.TEXTURE_MIN_FILTER,r.webgl.LINEAR_MIPMAP_LINEAR),r.engine.textureLoaded(dt()(r)),r.engine.addOnResourcesLoadedListener(function(){null!=r.object&&setTimeout(function(){r.generate()},1e3)}),r._camera=new Xt(r.engine),r._camera.fieldOfViewRad=r.engine.camera.fieldOfViewRad,r._camera.range=r.engine.camera.range,r}return mt()(h,t),v()(h,[{key:"generate",value:function(){this.object.updateMatrixes(),this.object.update(),this._camera.position=this.object.position.copy(),this.object.verticalAlign||this._camera.position.move(0,-(this.object.size.current.max.y-this.object.size.current.min.y)/2,0),this._camera.setRotation(0,270,0);var t=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});this._camera.setRotation(0,90,0);var e=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});this._camera.setRotation(-90,0,0);var i=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});this._camera.setRotation(90,0,0);var n=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});this._camera.setRotation(0,0,0);var r=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});this._camera.setRotation(0,180,0);var o=this.engine.captureFrame(this._camera,{background:this._background,width:this._quality,height:this._quality,imageAlpha:this._reflectionAlpha,noDrawObjects:[this.object]});if(this.setLoadedImages(t,e,n,i,r,o),te++,$t.length==te){for(var s=0;s<$t.length;s++)$t[s].generate();this.engine.appendCanvas(),this.engine.status="Drawing"}}},{key:"bindCubeTexture",value:function(){this.engine.webgl.activeTexture(this.engine.webgl.TEXTURE0+this.textureBlockLocation),this.webglTexture=this.webgl.createTexture(),this.webgl.bindTexture(this.webgl.TEXTURE_CUBE_MAP,this.webglTexture),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveX),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeX),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveY),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeY),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.positiveZ),this.webgl.texImage2D(this.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this.webgl.RGBA,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.textures.negativeZ),this.webgl.generateMipmap(this.webgl.TEXTURE_CUBE_MAP),this.webgl.texParameteri(this.webgl.TEXTURE_CUBE_MAP,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR),this.loaded=!0}},{key:"object",get:function(){return this._object},set:function(t){t.updateMatrixes(),t.update(),this._object=t,this.engine.resourcesLoaded&&this.generate()}}]),h}(Qt),ie=function(t){function i(t){var e;return f()(this,i),e=ut()(this,ct()(i).call(this,t)),x()(dt()(e),"width",100),x()(dt()(e),"height",100),x()(dt()(e),"name","Just a rect :)"),e.vertexes=[0,0,0,100,100,0,0,100,0,100,100,0,0,0,0,100,0,0],e.textureCoordinates=[0,1,1,0,0,0,1,0,0,1,1,1],e.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],e.shaderProgram=e.engine.shaders.default,e.vertexesBuffer=e.webgl.createBuffer(),e.webgl.bindBuffer(e.webgl.ARRAY_BUFFER,e.vertexesBuffer),e.webgl.bufferData(e.webgl.ARRAY_BUFFER,new Float32Array(e.vertexes),e.webgl.STATIC_DRAW),e.textureCoordinatesBuffer=e.webgl.createBuffer(),e.webgl.bindBuffer(e.webgl.ARRAY_BUFFER,e.textureCoordinatesBuffer),e.webgl.bufferData(e.webgl.ARRAY_BUFFER,new Float32Array(e.textureCoordinates),e.webgl.STATIC_DRAW),e.normalsBuffer=e.webgl.createBuffer(),e.webgl.bindBuffer(e.webgl.ARRAY_BUFFER,e.normalsBuffer),e.webgl.bufferData(e.webgl.ARRAY_BUFFER,new Float32Array(e.normals),e.webgl.STATIC_DRAW),e.collisionBox.maxPoint.set(100,100,0),e.collisionBox.minPoint.set(0,0,0),e.maxBaseSize.set(100,100,0),e.maxSize=e.maxBaseSize,e.engine.objectLoaded(dt()(e)),e}return mt()(i,t),v()(i,[{key:"scale",value:function(t,e){this.scaling.set(t,e,1),this.maxSize.set(this.maxBaseSize.x*t,this.maxBaseSize.y*e,0),this.minSize.set(this.minBaseSize.x*t,this.minBaseSize.y*e,0),"center"==this.rotationPointPos&&this.rotationPoint.set(this.minSize.x+(this.maxSize.x-this.minSize.x)/2,this.minSize.y+(this.maxSize.y-this.minSize.y)/2,this.minSize.z+(this.maxSize.z-this.minSize.z)/2)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.scale(this.width/100,this.height/100)}},{key:"setCellSize",value:function(t,e){this.setTextureRepeating(this.width/t,this.height/e)}},{key:"setTextureRepeating",value:function(t,e){this.textureCoordinates=[0,e,t,0,0,0,t,0,0,e,t,e],this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.textureCoordinatesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.textureCoordinates),this.webgl.STATIC_DRAW)}}]),i}(Ft),ne=function(t){function i(t){var e;return f()(this,i),(e=ut()(this,ct()(i).call(this,t))).name="Just skybox :)",e.webgl=t.webgl,e.vertexes=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],e.shaderProgram=t.shaders.skybox,e.texture=t.noTexture,e.vertexesBuffer=e.webgl.createBuffer(),e.webgl.bindBuffer(e.webgl.ARRAY_BUFFER,e.vertexesBuffer),e.webgl.bufferData(e.webgl.ARRAY_BUFFER,new Float32Array(e.vertexes),e.webgl.STATIC_DRAW),e.engine.objectLoaded(dt()(e)),e}var e;return mt()(i,t),v()(i,[{key:"updateMatrixes",value:(e=at()(ot.a.mark(function t(){var e,i;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=O(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),i=this.engine.camera.inverseRotationMatrix,e=K(e=K(e,i),J(this.rotation.x,this.rotation.y,this.rotation.z)),this.matrix=et(e);case 5:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"update",value:function(){}},{key:"draw",value:function(){this.shaderProgram?(this.shaderProgram.use(),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.positionLocation,2,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.uniform1i(this.shaderProgram.textureLocation,this.texture.textureBlockLocation),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this.matrix),this.engine.webgl.drawArrays(this.engine.webgl.TRIANGLES,0,this.vertexes.length/2),this.engine.shaders.default.use()):new Bt("Shader program is not set.")}}]),i}(zt),re=function(t){function i(t){var e;return f()(this,i),e=ut()(this,ct()(i).call(this,t)),x()(dt()(e),"cellSize",void 0),x()(dt()(e),"movingMatrix",[]),e.shaderProgram=e.engine.shaders.grid,e.cellSize=[1e3,1e3],e.name="Just a gird :)",e}var e;return mt()(i,t),v()(i,[{key:"draw",value:function(){this.shaderProgram.use(),this.engine.webgl.texParameteri(this.engine.webgl.TEXTURE_2D,this.engine.shaders.extensions.anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,16),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.texcoordLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,this.textureCoordinatesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.texcoordLocation,2,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.uniform1i(this.shaderProgram.textureLocation,this.texture.textureBlockLocation),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,this.matrix),this.engine.webgl.uniform2fv(this.shaderProgram.movingLocation,this.movingMatrix),this.engine.webgl.uniform2fv(this.shaderProgram.cellSizeLocation,this.cellSize),this.engine.webgl.drawArrays(this.engine.webgl.TRIANGLES,0,this.vertexes.length/3)}},{key:"updateMatrixes",value:(e=at()(ot.a.mark(function t(){var e,i;return ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=K(e=et(N(this.rotationPoint.x,this.rotationPoint.y,this.rotationPoint.z)),N(this.position.x,this.position.y,this.position.z)),i=J(this.rotation.x,this.rotation.y,this.rotation.z),e=K(e=K(e=K(e=K(e,i),N(this.rotationPoint.x,this.rotationPoint.y,this.rotationPoint.z)),N(-this.minSize.x-(this.maxSize.x-this.minSize.x)/2,-this.minSize.y-(this.maxSize.y-this.minSize.y)/2,-this.minSize.z-(this.maxSize.z-this.minSize.z)/2)),Z(this.scaling.x,this.scaling.y,this.scaling.z)),this.worldMatrix=e,this.rotationMatrix=i;case 9:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"update",value:function(){var t=O(this.engine.camera.fieldOfViewRad,this.engine.width,this.engine.height,1,this.engine.camera.range),e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t=K(t=K(t,et(e=K(e=K(e,N(0,this.engine.camera.position.y,0)),this.engine.camera.rotationMatrix))),this.worldMatrix),this.movingMatrix=[this.engine.camera.position.x,this.engine.camera.position.z],this.matrix=t}},{key:"setCellSize",value:function(t,e){this.cellSize=[t,e],this.setTextureRepeating(this.width/t,this.height/e)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.vertexes=[0,0,0,t,e,0,0,e,0,t,e,0,0,0,0,t,0,0],this.maxSize.set(t,e,0),this.minSize.set(0,0,0),this.setCellSize(this.cellSize[0],this.cellSize[1]),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,this.vertexesBuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webgl.STATIC_DRAW)}}]),i}(ie),oe=0,se=function(){function e(t){if(f()(this,e),x()(this,"engine",void 0),x()(this,"_position",new _(0,0,0)),x()(this,"_range",2e3),x()(this,"_color",new Uint8Array([255,255,255,255])),x()(this,"_index",-1),x()(this,"_on",!1),x()(this,"_positionsWritten",!1),x()(this,"_rangeWritten",!1),28<++oe)throw new Error("There are can be only 28 lights. Sorry :(");this.engine=t,this._range=2e3,this._on=!1}return v()(e,[{key:"setPosition",value:function(t,e,i){t.constructor!==_?t.constructor!==Array?(this._position.set(t,e,i),this._on&&!this._positionsWritten?(this.engine.lightsPositions.push(t),this.engine.lightsPositions.push(e),this.engine.lightsPositions.push(i),this._positionsWritten=!0):this._on&&(this.engine.lightsPositions[3*this._index+0]=t,this.engine.lightsPositions[3*this._index+1]=e,this.engine.lightsPositions[3*this._index+2]=i)):this._position.set(t[0],t[1],t[2]):this._position=t}},{key:"move",value:function(t,e,i){this.position.move(t,e,i)}},{key:"setRange",value:function(t){this.range=t}},{key:"setColorRGBA",value:function(t,e,i,n){this._color=new Uint8Array([t,e,i,n])}},{key:"on",value:function(){this._index=this.engine.lights.length,this._on=!0,this.engine.lights.push(this),this.position=this._position,this.range=this._range}},{key:"off",value:function(){var t=this._index;this.engine.lights.splice(t,1),this.engine.lightsPositions.splice(3*t+0,3),this.engine.lightsRanges.splice(t,1),this._positionsWritten=!1,this._rangeWritten=!1}},{key:"destroy",value:function(){this.off()}},{key:"range",set:function(t){this._range=t,this._on&&!this._rangeWritten?(this.engine.lightsRanges.push(t),this._rangeWritten=!0):this._on&&(this.engine.lightsRanges[this._index]=t)},get:function(){return this._range}},{key:"position",set:function(t){this._position=t,this._on&&!this._positionsWritten?(this.engine.lightsPositions.push(t.x),this.engine.lightsPositions.push(t.y),this.engine.lightsPositions.push(t.z),this._positionsWritten=!0):this._on&&(this.engine.lightsPositions[3*this._index+0]=t.x,this.engine.lightsPositions[3*this._index+1]=t.y,this.engine.lightsPositions[3*this._index+2]=t.z)},get:function(){return this._position}}]),e}(),ae=function(){function i(t,e){f()(this,i),x()(this,"defaultDraw",null),x()(this,"engine",void 0),x()(this,"_object",void 0),x()(this,"webgl",void 0),x()(this,"shaderProgram",null),this.engine=t,this._object=e||null,this.webgl=t.webgl}return v()(i,[{key:"setShaderProgram",value:function(t){this.shaderProgram=t}},{key:"drawObject",value:function(t){throw new Error("Method not implemented.")}},{key:"object",get:function(){return this._object},set:function(t){null!=(this._object=t)&&t.texture instanceof ee&&((t.texture.object=t).update(),t.updateMatrixes())}}]),i}(),he=function(t){function n(t,e){var i;return f()(this,n),(i=ut()(this,ct()(n).call(this,t,e))).shaderProgram=t.shaders.reflection,i}return mt()(n,t),v()(n,[{key:"drawObject",value:function(t){t.texture.loaded&&t.loaded&&(this.shaderProgram.use(),this.webgl.uniformMatrix4fv(this.shaderProgram.cameraLocation,!1,this.engine.camera.matrix),this.webgl.uniform3fv(this.shaderProgram.lightPositionsLocation,this.engine.lightsPositions),this.webgl.uniform1fv(this.shaderProgram.lightRangesLocation,this.engine.lightsRanges),this.webgl.uniform1i(this.shaderProgram.lightsCountLocation,this.engine.lights.length),this.webgl.uniform1f(this.shaderProgram.lightMinValueLocation,this.engine.globalLightMinValue),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.positionLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,t.vertexesBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.positionLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.enableVertexAttribArray(this.shaderProgram.normalLocation),this.engine.webgl.bindBuffer(this.engine.webgl.ARRAY_BUFFER,t.normalsBuffer),this.engine.webgl.vertexAttribPointer(this.shaderProgram.normalLocation,3,this.engine.webgl.FLOAT,!1,0,0),this.engine.webgl.uniform1i(this.shaderProgram.textureLocation,t.texture.textureBlockLocation),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.matrixLocation,!1,t.matrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.worldMatrixLocation,!1,t.worldMatrix),this.engine.webgl.uniformMatrix4fv(this.shaderProgram.rotationMatrixLocation,!1,t.rotationMatrix),this.engine.webgl.uniform3fv(this.shaderProgram.worldCameraPositionLocation,new Float32Array(this.engine.camera.position.toArray())),this.engine.webgl.drawArrays(this.engine.webgl.TRIANGLES,0,t.vertexes.length/3))}}]),n}(ae),ue=function(){function h(t){var e,i=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:60,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1;if(f()(this,h),x()(this,"playing",!1),x()(this,"audios",void 0),x()(this,"_audioCount",void 0),x()(this,"_playableAudioIndex",0),x()(this,"_delay",100),x()(this,"_canBePlayed",!0),x()(this,"_canBePlayedInterval",null),x()(this,"_loopInterval",-1),x()(this,"_volume",.1),this.audios=[],this._audioCount=n,t instanceof Array){if(!(t instanceof Array))return;e=t}else{e=[];for(var o=0;o<n;o++)e.push(t)}for(var s=0,a=0;a<this._audioCount;a++)this.audios.push(new Audio(e[s])),this.audios[a].volume=r,++s===t.length&&(s=0);this._canBePlayed=!0,this._canBePlayedInterval=Number(setInterval(function(){i._canBePlayed=!0},this._delay)),this.playing=!1}return v()(h,[{key:"play",value:function(){this._canBePlayed&&(this.audios[this._playableAudioIndex].play(),this._playableAudioIndex++,this._playableAudioIndex==this._audioCount&&(this._playableAudioIndex=0),this._canBePlayed=!1)}},{key:"playLoop",value:function(){var t=this;clearInterval(this._loopInterval),this._loopInterval=Number(setInterval(function(){t.play()},this._delay)),this.playing=!0}},{key:"playLoopRandom",value:function(){var t=this;clearInterval(this._loopInterval),this._loopInterval=Number(setInterval(function(){t._canBePlayed&&(t.audios[t._playableAudioIndex].play(),t._playableAudioIndex=Math.floor(Math.random()*t._audioCount),t._playableAudioIndex==t._audioCount&&(t._playableAudioIndex=0),t._canBePlayed=!1)},this._delay)),this.playing=!0}},{key:"stop",value:function(){clearInterval(this._loopInterval),this._canBePlayed=!1,this.playing=!1;for(var t=0;t<this.audios.length;t++){var e=this.audios[t];e.pause(),e.currentTime=0}}},{key:"volume",set:function(t){for(var e=0;e<this._audioCount;e++)this.audios[e].volume=t},get:function(){return this._volume}},{key:"delay",set:function(t){var e=this;this._delay=t,clearInterval(this._canBePlayedInterval),this._canBePlayedInterval=Number(setInterval(function(){e._canBePlayed=!0},this._delay))},get:function(){return this._delay}}]),h}();i.d(e,"Engine",function(){return jt}),i.d(e,"Camera",function(){return Xt}),i.d(e,"Controls",function(){return Ht}),i.d(e,"UI",function(){return Vt}),i.d(e,"Debugger",function(){return Kt}),i.d(e,"Texture",function(){return Pt}),i.d(e,"ColorTexture",function(){return Ct}),i.d(e,"SimpleTexture",function(){return Ut}),i.d(e,"CubeTexture",function(){return Qt}),i.d(e,"ReflectionTexture",function(){return ee}),i.d(e,"Entity",function(){return Ft}),i.d(e,"CollisionBox",function(){return Mt}),i.d(e,"Object",function(){return Ot}),i.d(e,"Rect",function(){return ie}),i.d(e,"Skybox",function(){return ne}),i.d(e,"Grid",function(){return re}),i.d(e,"Light",function(){return se}),i.d(e,"Material",function(){return ae}),i.d(e,"Glass",function(){return he}),i.d(e,"Sound",function(){return ue}),i.d(e,"Math",function(){return n}),i.d(e,"Vector3",function(){return r}),i.d(e,"Matrixes4",function(){return s}),i.d(e,"Vector2",function(){return o})}],r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist",r(r.s=16);function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var i,n});