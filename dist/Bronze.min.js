!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Bronze",[],e):"object"==typeof exports?exports.Bronze=e():t.Bronze=e()}(window,function(){return function(i){var o={};function n(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}return n.m=i,n.c=o,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,i){"use strict";function s(t,e,i){var o,n=t;if("fragment"==e)o=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!=e)return console.log("Wrong shader type"),null;o=i.createShader(i.VERTEX_SHADER)}if(i.shaderSource(o,n),i.compileShader(o),!i.getShaderParameter(o,i.COMPILE_STATUS))throw"Could not compile shader:"+i.getShaderInfoLog(o);return o}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function u(t){var o="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,i)}function i(){return n(t,arguments,h(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),l(i,t)})(t)}function n(t,e,i){return(n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var o=[null];o.push.apply(o,e);var n=new(Function.bind.apply(t,o));return i&&l(n,i.prototype),n}).apply(null,arguments)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.r(e);var c=function(t){function n(t,e,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=a(this,h(n).call(this))).src=t,null!=e&&null!=i&&(o.width=e,o.height=i),o.coords=[],o.addEventListener("load",function(){o.loaded=!0}),o.color=new Uint8Array([255,255,255,255]),o._textureBlockLocation=null,o}var e,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(n,u(Image)),e=n,(i=[{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,o){this.color=new Uint8Array([t,e,i,o])}}])&&r(e.prototype,i),o&&r(e,o),n}();function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function m(t,e,i){return e&&b(t.prototype,e),i&&b(t,i),t}var y=function(){function t(){return f(this,t),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return m(t,[{key:"perspective",value:function(t,e,i,o,n){var r=Math.tan(.5*Math.PI-.5*t),a=1/(o-n);return this.matrix=[r/(e/i),0,0,0,0,r,0,0,0,0,(o+n)*a,-1,0,0,o*n*a*2,0],this}},{key:"multiply",value:function(t){var e=this.matrix[0],i=this.matrix[1],o=this.matrix[2],n=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],w=this.matrix[15],p=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],G=t[6],_=t[7],R=t[8],T=t[9],A=t[10],E=t[11],k=t[12],P=t[13],F=t[14],B=t[15];this.matrix=[p*e+y*r+d*l+L*b,p*i+y*a+d*h+L*m,p*o+y*s+d*c+L*v,p*n+y*u+d*f+L*w,x*e+g*r+G*l+_*b,x*i+g*a+G*h+_*m,x*o+g*s+G*c+_*v,x*n+g*u+G*f+_*w,R*e+T*r+A*l+E*b,R*i+T*a+A*h+E*m,R*o+T*s+A*c+E*v,R*n+T*u+A*f+E*w,k*e+P*r+F*l+B*b,k*i+P*a+F*h+B*m,k*o+P*s+F*c+B*v,k*n+P*u+F*f+B*w]}},{key:"multiply_",value:function(t){var e=this.matrix[0],i=this.matrix[1],o=this.matrix[2],n=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],w=this.matrix[15],p=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],G=t[6],_=t[7],R=t[8],T=t[9],A=t[10],E=t[11],k=t[12],P=t[13],F=t[14],B=t[15];return[p*e+y*r+d*l+L*b,p*i+y*a+d*h+L*m,p*o+y*s+d*c+L*v,p*n+y*u+d*f+L*w,x*e+g*r+G*l+_*b,x*i+g*a+G*h+_*m,x*o+g*s+G*c+_*v,x*n+g*u+G*f+_*w,R*e+T*r+A*l+E*b,R*i+T*a+A*h+E*m,R*o+T*s+A*c+E*v,R*n+T*u+A*f+E*w,k*e+P*r+F*l+B*b,k*i+P*a+F*h+B*m,k*o+P*s+F*c+B*v,k*n+P*u+F*f+B*w]}},{key:"translate",value:function(t,e,i){this.multiply(d.translation(t,e,i))}},{key:"translate_",value:function(t,e,i){return this.multiply_(d.translation(t,e,i))}},{key:"rotateX",value:function(t){this.multiply(d.rotationX(t))}},{key:"rotateY",value:function(t){this.multiply(d.rotationY(t))}},{key:"rotateZ",value:function(t){this.multiply(d.rotationZ(t))}},{key:"scale",value:function(t,e,i){this.multiply(d.scaling(t,e,i))}}]),t}(),d=new(function(){function t(){f(this,t)}return m(t,[{key:"unit",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"translation",value:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}},{key:"rotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}},{key:"rotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}},{key:"rotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}},{key:"scaling",value:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}},{key:"multiply",value:function(t,e){var i=t[0],o=t[1],n=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],w=t[14],p=t[15],y=e[0],d=e[1],L=e[2],x=e[3],g=e[4],G=e[5],_=e[6],R=e[7],T=e[8],A=e[9],E=e[10],k=e[11],P=e[12],F=e[13],B=e[14],U=e[15];return[y*i+d*a+L*h+x*m,y*o+d*s+L*c+x*v,y*n+d*u+L*f+x*w,y*r+d*l+L*b+x*p,g*i+G*a+_*h+R*m,g*o+G*s+_*c+R*v,g*n+G*u+_*f+R*w,g*r+G*l+_*b+R*p,T*i+A*a+E*h+k*m,T*o+A*s+E*c+k*v,T*n+A*u+E*f+k*w,T*r+A*l+E*b+k*p,P*i+F*a+B*h+U*m,P*o+F*s+B*c+U*v,P*n+F*u+B*f+U*w,P*r+F*l+B*b+U*p]}},{key:"vec3Multiply",value:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}},{key:"transformVector",value:function(t,e){for(var i=new Float32Array(4),o=0;o<4;++o)for(var n=i[o]=0;n<4;++n)i[o]+=e[n]*t[4*n+o];return i}},{key:"inverse",value:function(t){var e=new Float32Array(16),i=t[0],o=t[1],n=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],w=t[14],p=t[15],y=f*p,d=w*b,L=u*p,x=w*l,g=u*b,G=f*l,_=n*p,R=w*r,T=n*b,A=f*r,E=n*l,k=u*r,P=h*v,F=m*c,B=a*v,U=m*s,C=a*c,O=h*s,D=i*v,M=m*o,S=i*c,j=h*o,X=i*s,Y=a*o,I=y*s+x*c+g*v-(d*s+L*c+G*v),V=d*o+_*c+A*v-(y*o+R*c+T*v),N=L*o+R*s+E*v-(x*o+_*s+k*v),z=G*o+T*s+k*c-(g*o+A*s+E*c),W=1/(i*I+a*V+h*N+m*z);return e[0]=W*I,e[1]=W*V,e[2]=W*N,e[3]=W*z,e[4]=W*(d*a+L*h+G*m-(y*a+x*h+g*m)),e[5]=W*(y*i+R*h+T*m-(d*i+_*h+A*m)),e[6]=W*(x*i+_*a+k*m-(L*i+R*a+E*m)),e[7]=W*(g*i+A*a+E*h-(G*i+T*a+k*h)),e[8]=W*(P*l+U*b+C*p-(F*l+B*b+O*p)),e[9]=W*(F*r+D*b+j*p-(P*r+M*b+S*p)),e[10]=W*(B*r+M*l+X*p-(U*r+D*l+Y*p)),e[11]=W*(O*r+S*l+Y*b-(C*r+j*l+X*b)),e[12]=W*(B*f+O*w+F*u-(C*w+P*u+U*f)),e[13]=W*(S*w+P*n+M*f-(D*f+j*w+F*n)),e[14]=W*(D*u+Y*w+U*n-(X*w+B*n+M*u)),e[15]=W*(X*f+C*n+j*u-(S*u+Y*f+O*n)),e}}]),t}());function v(t){return t*Math.PI/180}function w(t){return 0==(t&t-1)}function p(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var L,x=function(){function o(t){var e,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.webGL=(i=(e=t).getContext("experimental-webgl"),window.addEventListener("resize",function(){e.width=e.offsetWidth,e.height=e.offsetHeight}),i),this.canvas=t,this.width=t.width,this.height=t.height,this.polygons=[],this.objects=[],this.textures=[],this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._globalPossitionBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalPossitionBuffer),this._globalTextureBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalTextureBuffer),t.addEventListener("resize",function(){t.width=window.innerWidth,t.height=window.innerHeight}),this.initShaders(),this.noTexture=new c,this.noTexture.setColorRGBA(219,58,52,255),this.bindTexture(this.noTexture)}var t,e,i;return t=o,(e=[{key:"initShaders",value:function(){var t,e,i,o,n,r=s("attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition; // - surfaceWorldPosition;\r\n}","vertex",this.webGL),a=s("precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    // float light = dot(normal, u_reverseLightDirection);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < 0.2)\r\n        discard;\r\n}","fragment",this.webGL);this.shaderProgram=(t=this.webGL,e=r,i=a,o=!1,n=t.createProgram(),t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.useProgram(n),o&&(t.deleteShader(e),t.deleteShader(i)),n),this.positionLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_position"),this.texcoordLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_texcoord"),this.textureLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_texture"),this.matrixLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_matrix"),this.objectRotationLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_objectRotation"),this.normalLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_normal"),this.everseLightDirectionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_reverseLightDirection"),this.lightWorldPositionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_lightWorldPosition"),this.cameraLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_cameraMatrix"),this.webGL.useProgram(this.shaderProgram),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST)}},{key:"setCamera",value:function(t){this.camera=t}},{key:"bindTexture",value:function(t){var e=this;t._textureBlockLocation=this.textures.length,this.textures.push(t),t._WebGLtexture=this.webGL.createTexture(),this.webGL.activeTexture(this.webGL.TEXTURE0+t._textureBlockLocation),this.webGL.bindTexture(this.webGL.TEXTURE_2D,t._WebGLtexture),t.loaded?(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t),this.webGL.generateMipmap(this.webGL.TEXTURE_2D),w(image.width)&&w(image.height)?this.webGL.generateMipmap(this.webGL.TEXTURE_2D):(this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_S,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_T,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR))):(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,1,1,0,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t.color),t.addEventListener("load",function(){e.webGL.activeTexture(e.webGL.TEXTURE0+t._textureBlockLocation),e.webGL.texImage2D(e.webGL.TEXTURE_2D,0,e.webGL.RGBA,e.webGL.RGBA,e.webGL.UNSIGNED_BYTE,t),w(t.width)&&w(t.height)?e.webGL.generateMipmap(e.webGL.TEXTURE_2D):(e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_S,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_T,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_MIN_FILTER,e.webGL.LINEAR))}))}},{key:"update",value:function(){var w,e,i,o,p=this;null!=this.camera._controlFunction&&this.camera._controlFunction(),this.selectedObject=null,this.polygons.forEach(function(t){(w=new y).perspective(p.camera.fieldOfViewRad,p.width,p.height,1,2e4),w.multiply(p.camera.inserved),(o=new y).multiply(d.inverse(d.translation(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]))),o.translate(t.position[0],t.position[1],t.position[2]),e=d.multiply(d.rotationX(t.rotation[0]),d.rotationY(t.rotation[1])),e=d.multiply(e,d.rotationZ(t.rotation[2])),null!=t.parentRotation&&(i=d.multiply(d.rotationX(t.parentRotation[0]),d.rotationY(t.parentRotation[1])),i=d.multiply(i,d.rotationZ(t.parentRotation[2])),t._world=i,e=d.multiply(i,e)),o.multiply(e),o.translate(t.rotationPoint[0],t.rotationPoint[1],t.rotationPoint[2]),o.scale(1,1,1),w.multiply(o.matrix),t._matrix=w.matrix,t._rotataionMatrix=e}),this.objects.forEach(function(m){(w=new y).perspective(p.camera.fieldOfViewRad,p.width,p.height,1,2e4),w.multiply(p.camera.inserved),(o=new y).multiply(d.inverse(d.translation(m.rotationPoint[0],m.rotationPoint[1],m.rotationPoint[2]))),o.translate(m.position[0],m.position[1],m.position[2]),e=d.multiply(d.rotationX(m.rotation[0]),d.rotationY(m.rotation[1])),e=d.multiply(e,d.rotationZ(m.rotation[2])),i=d.multiply(d.rotationX(m.parentRotation[0]),d.rotationY(m.parentRotation[1])),i=d.multiply(i,d.rotationZ(m.parentRotation[2])),m._world=i,e=d.multiply(i,e),o.multiply(e),o.translate(m.rotationPoint[0],m.rotationPoint[1],m.rotationPoint[2]),o.scale(m.scaling[0],m.scaling[1],m.scaling[2]),w.multiply(o.matrix);var v=!1;m.collisionBoxes.forEach(function(t){for(var e=[],i=0;i<t.x.length;i++)for(var o=t.x[i],n=0;n<t.y.length;n++)for(var r=t.y[n],a=0;a<t.z.length;a++){var s=t.z[a],u=d.transformVector(w.matrix,[o,r,s,1]);u[0]=u[0]/u[3],u[1]=u[1]/u[3],u[0]=(.5*u[0]+.5)*p.width,u[1]=(-.5*u[1]+.5)*p.height,u[0]>-p.width&&u[0]<p.width&&u[1]>-p.height&&u[1]<p.height&&e.push({x:u[0],y:u[1]})}for(var l=[1e4,1e4],h=[-1e4,-1e4],c=0;c<e.length;c++){var f=e[c];f.x<l[0]?l[0]=f.x:f.x>h[0]&&(h[0]=f.x),f.y<l[1]?l[1]=f.y:f.y>h[1]&&(h[1]=f.y)}p.controls.mouse.x>l[0]&&p.controls.mouse.x<h[0]&&p.controls.mouse.y>l[1]&&p.controls.mouse.y<h[1]&&(v=!0);var b=p.controls.mouse;v&&(p.selectedObject=m,p.debugger.logArray[2].output=function(){return"Hitbox x "+b.x+" > "+l[0]+" && "+b.x+" < "+h[0]},p.debugger.logArray[3].output=function(){return"Hitbox y "+b.y+" > "+l[1]+" && "+b.y+" < "+h[1]})});var t=p.selectedObject;p.debugger.logArray[4].output=null!=t?function(){return"Mouse over "+t.name}:function(){return"There are no objects over mouse"},m._matrix=w.matrix,m._rotataionMatrix=e})}},{key:"draw",value:function(){var t,e,i,o=this;this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.webGL.uniform3fv(this.everseLightDirectionLocation,(t=[-.1,.5,1],e=new Float32Array(3),1e-5<(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i,e))),this.webGL.uniform3fv(this.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.cameraLocation,!1,this.camera.matrix),this.polygons.forEach(function(t){o.webGL.enableVertexAttribArray(o.positionLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._vertexesBuffer),o.webGL.vertexAttribPointer(o.positionLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.texcoordLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._coordsBuffer),o.webGL.vertexAttribPointer(o.texcoordLocation,2,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.normalLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._normalBuffer),o.webGL.vertexAttribPointer(o.normalLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.uniform1i(o.textureLocation,t.texture._textureBlockLocation),o.webGL.uniformMatrix4fv(o.matrixLocation,!1,t._matrix),o.webGL.uniformMatrix4fv(o.objectRotationLocation,!1,t._world),o.webGL.drawArrays(o.webGL.TRIANGLES,0,3)}),this.objects.forEach(function(e){e.faces.forEach(function(t){o.webGL.enableVertexAttribArray(o.positionLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t.vertexesBuffer),o.webGL.vertexAttribPointer(o.positionLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.texcoordLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t.coordsBuffer),o.webGL.vertexAttribPointer(o.texcoordLocation,2,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.normalLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t.normalBuffer),o.webGL.vertexAttribPointer(o.normalLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.uniform1i(o.textureLocation,e.texture._textureBlockLocation),o.webGL.uniformMatrix4fv(o.matrixLocation,!1,e._matrix),o.webGL.uniformMatrix4fv(o.objectRotationLocation,!1,e._world),o.webGL.drawArrays(o.webGL.TRIANGLES,0,t.vertexes.length/t.vertexesCount)})}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"render",value:function(){this.update(),this.draw()}},{key:"run",value:function(){L=this,g()}}])&&p(t.prototype,e),i&&p(t,i),o}();function g(){requestAnimationFrame(g),L.render()}function G(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}!function(){for(var r=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),o=Math.max(0,16-(i-r)),n=window.setTimeout(function(){t(i+o)},o);return r=i+o,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=v(90),this.matrix=d.unit(),this.position=[0,0,0],this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null}var e,i,o;return e=t,(i=[{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=v(t)}},{key:"setCollisions",value:function(t){this._collisions=t}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.computeMatrix()}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation=[t,e,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=d.unit(),this.matrix=d.multiply(this.matrix,d.translation(this.position[0],this.position[1],this.position[2]));var t=new y;t.multiply(d.rotationY(v(this.rotation[1]))),t.multiply(d.rotationX(v(this.rotation[0]))),t.multiply(d.rotationZ(v(this.rotation[2]))),this.matrix=d.multiply(this.matrix,t.matrix),null!=this._lookUpMatrix&&(this.matrix=d.multiply(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=d.inverse(t.matrix),this.inserved=d.inverse(this.matrix)}},{key:"setControl",value:function(t){this._controlFunction=t}},{key:"setLookUp",value:function(t,e,i){this._lookUpMatrix=null!=t?[t,e,i]:null}},{key:"lookAt",value:function(t,e){if(null==t)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var i=normalize(subVec3(this.position,t)),o=normalize(cross(e,i)),n=normalize(cross(i,o));return[o[0],o[1],o[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}}])&&G(e.prototype,i),o&&G(e,o),t}();function R(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var T=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n.controls=this).keys=[],this._handlers=[],this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1]};for(var r=this,t=0;t<255;t++)this.keys[t]=!1,this._handlers[t]=null;window.onkeydown=function(t){return r.keys[t.keyCode]=!0,null!=r._handlers[t.keyCode]&&r._handlers[t.keyCode](),!1},window.onkeyup=function(t){return r.keys[t.keyCode]=!1},n.canvas.addEventListener("mousemove",function(t){var e=n.canvas.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;r.mouse.x=i,r.mouse.y=o},!1),window.onmousedown=function(t){return r.mouse.buttons[t.button]=!0,null!=r._mouseHandlers[2+t.button]&&r._mouseHandlers[2+t.button](),!1},window.onmouseup=function(t){return r.mouse.buttons[t.button]=!1}}var t,i,o;return t=e,(i=[{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){engine.canvas.addEventListener("mousemove",t,!1)}}])&&R(t.prototype,i),o&&R(t,o),e}();function A(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var E=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t.debugger=this).logArray=[],this.element=null}var t,i,o;return t=e,(i=[{key:"setElemenent",value:function(t){this.element=t}},{key:"addLog",value:function(t,e,i,o,n){n=n||this.defaultOutput,this.logArray.push({name:t,object:e,value:i,view:o,output:n}),this.addView(o)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"defaultOutput",value:function(t){return t.name+" : "+t.object[t.value]}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}}])&&A(t.prototype,i),o&&A(t,o),e}();function k(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var P=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t&&t.polygons.push(this),this.webGL=t.webGL,this.points=[],this.texture=null,this.vertexes=[],this.position=[0,0,0],this.rotation=[0,0,0],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.normals=[0,1,0,0,1,0,0,1,0],this._vertexesBuffer=null}var t,i,o;return t=e,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setTextureCoords",value:function(t){this.textureCoords=t,this._coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setVertexes",value:function(t){this.vertexes=t,this._vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"update",value:function(){}},{key:"setNormals",value:function(t){this.normals=t,this._normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}}])&&k(t.prototype,i),o&&k(t,o),e}();function F(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var B=function(){function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0];var e=new P(t);e.setVertexes([0,0,0,100,100,0,0,100,0]),e.setTextureCoords([0,1,1,0,0,0]),this.polygons[0]=e,(e=new P(t)).setVertexes([100,100,0,0,0,0,100,0,0]),e.setTextureCoords([1,0,0,1,1,1]),this.polygons[1]=e,this.setNormals([0,0,1,0,0,1,0,0,1])}var t,e,o;return t=i,(e=[{key:"setTexture",value:function(t){this.polygons[0].setTexture(t),this.polygons[1].setTexture(t)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.polygons[0].setVertexes([0,0,0,t,e,0,0,e,0]),this.polygons[1].setVertexes([t,e,0,0,0,0,t,0,0])}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.polygons[0].setPosition(t,e,i),this.polygons[1].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){var o=v(t),n=v(e),r=v(i);this.polygons[0].rotate(o,n,r),this.polygons[1].rotate(o,n,r)}},{key:"setParentRotation",value:function(t,e,i){this.polygons[0].setParentRotation(t,e,i),this.polygons[1].setParentRotation(t,e,i)}},{key:"setRotationPoint",value:function(t,e,i){this.polygons[0].setRotationPoint(t,e,i),this.polygons[1].setRotationPoint(t,e,i)}},{key:"setNormals",value:function(t){this.polygons[0].setNormals(t),this.polygons[1].setNormals(t)}}])&&F(t.prototype,e),o&&F(t,o),i}();function U(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var C=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.faces=[new B(t),new B(t),new B(t),new B(t),new B(t),new B(t)],this.position=[0,0,0],this.rotation=[0,0,0],this.faces[0].rotate(0,0,0),this.faces[0].setRotationPoint(-100,-100,100),this.faces[0].setPosition(0,0,0),this.faces[0].setNormals([0,0,1,0,0,1,0,0,1]),this.faces[1].rotate(0,90,0),this.faces[1].setRotationPoint(-100,-100,100),this.faces[1].position=[0,0,0],this.faces[1].setNormals([1,0,0,1,0,0,1,0,0]),this.faces[2].rotate(0,-180,0),this.faces[2].setRotationPoint(-100,-100,100),this.faces[2].position=[0,0,0],this.faces[2].setNormals([0,0,-1,0,0,-1,0,0,-1]),this.faces[3].rotate(0,270,0),this.faces[3].setRotationPoint(-100,-100,100),this.faces[3].position=[0,0,0],this.faces[3].setNormals([-1,0,0,-1,0,0,-1,0,0]),this.faces[4].rotate(-90,0,0),this.faces[4].setRotationPoint(-100,-100,100),this.faces[4].position=[0,0,0],this.faces[4].setNormals([0,1,0,0,1,0,0,1,0]),this.faces[5].rotate(90,0,0),this.faces[5].setRotationPoint(-100,-100,100),this.faces[5].position=[0,0,0],this.faces[5].setNormals([0,-1,0,0,-1,0,0,-1,0])}var t,i,o;return t=e,(i=[{key:"_updateFaces",value:function(){this.faces[0].setPosition(this.position[0],this.position[1],this.position[2])}},{key:"setTexture",value:function(t,e,i,o,n,r){this.faces[0].setTexture(t),this.faces[1].setTexture(e),this.faces[2].setTexture(i),this.faces[3].setTexture(o),this.faces[4].setTexture(n),this.faces[5].setTexture(r)}},{key:"setSize",value:function(e,i,o){this.width=e,this.height=i,this.depth=o,this.faces.forEach(function(t){t.setSize(e,i),t.setRotationPoint(-e/2,-i/2,o/2)})}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.faces[0].setPosition(t,e,i),this.faces[1].setPosition(t,e,i),this.faces[2].setPosition(t,e,i),this.faces[3].setPosition(t,e,i),this.faces[4].setPosition(t,e,i),this.faces[5].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i;var o=v(this.rotation[0]),n=v(this.rotation[1]),r=v(this.rotation[2]);this.faces.forEach(function(t){t.setParentRotation(o,n,r)})}},{key:"setRotation",value:function(t,e,i){var o=v(t),n=v(e),r=v(i);this.faces.forEach(function(t){t.setParentRotation(o,n,r)})}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}}])&&U(t.prototype,i),o&&U(t,o),e}();function O(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var D=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.objects.push(this),this.webGL=t.webGL,this.texture=t.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.faces=[],this.collisionBoxes=[]}var t,i,o;return t=e,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"compile",value:function(t){var c=this,f=[],b=[],m=[],e=t.split("\n"),s={x:[0,0],y:[0,0],z:[0,0]};e.forEach(function(t){for(var h=t.split(" "),e=h.length;e--;)""!=h[e]&&"\r"!=h[e]||h.splice(e,1);if("v"==h[0]){var i=parseFloat(h[1]),o=parseFloat(h[2]),n=parseFloat(h[3]);s.x[1]<i&&(s.x[1]=i),s.y[1]<o&&(s.y[1]=o),s.z[1]<n&&(s.z[1]=n),s.x[0]>i&&(s.x[0]=i),s.y[0]>o&&(s.y[0]=o),s.z[0]>n&&(s.z[0]=n),f.push([i,o,n])}else if("vn"==h[0])m.push([parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])]);else if("vt"==h[0])b.push([parseFloat(h[1]),parseFloat(h[2])]);else if("f"==h[0])for(var r=function(t){var e=h[t].split("/");if("\r"==e[length-1])return"break";for(var i=null,o=null,n=void 0,r=0;r<c.faces.length;r++){var a=c.faces[r];a.vertexesCount==h.length-1&&(i=a.vertexes,o=a.textureCoords,n=a.normals)}null==i&&(c.faces.push({vertexesCount:h.length-1,vertexes:[],textureCoords:[],normals:[]}),i=c.faces[c.faces.length-1].vertexes,o=c.faces[c.faces.length-1].textureCoords,n=c.faces[c.faces.length-1].normals);var s=parseFloat(e[0]);s<0&&(s=f.length+s+1);var u=parseFloat(e[1]);u<0&&(u=b.length+u+1);var l=parseFloat(e[2]);l<0&&(l=m.length+l+1),f[s-1].forEach(function(t){i.push(t)}),0<b.length&&b[u-1].forEach(function(t){o.push(t)}),null!=e[2]?m[l-1].forEach(function(t){n.push(t)}):n.push(0,0,0)},a=1;a<h.length;a++){if("break"===r(a))break}});for(var i=0;i<this.faces.length;i++){var o=this.faces[i];o.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,o.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(o.vertexes),this.webGL.STATIC_DRAW),o.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,o.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(o.textureCoords),this.webGL.STATIC_DRAW),o.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,o.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(o.normals),this.webGL.STATIC_DRAW)}this.collisionBoxes.push(s)}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&e.compile(i.responseText)},i.send()}}])&&O(t.prototype,i),o&&O(t,o),e}();i.d(e,"Engine",function(){return x}),i.d(e,"Camera",function(){return _}),i.d(e,"Controls",function(){return T}),i.d(e,"Debugger",function(){return E}),i.d(e,"Texture",function(){return c}),i.d(e,"Rect",function(){return B}),i.d(e,"Cube",function(){return C}),i.d(e,"Object",function(){return D})}])});