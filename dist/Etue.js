!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Etue",[],e):"object"==typeof exports?exports.Etue=e():t.Etue=e()}(window,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist",i(i.s=0)}([function(t,e,i){"use strict";function o(t,e,i){var o,n=t;if("fragment"==e)o=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!=e)return console.log("Wrong shader type"),null;o=i.createShader(i.VERTEX_SHADER)}if(i.shaderSource(o,n),i.compileShader(o),!i.getShaderParameter(o,i.COMPILE_STATUS))throw"Could not compile shader:"+i.getShaderInfoLog(o);return o}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){var e="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,o)}function o(){return u(t,arguments,h(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),l(o,t)})(t)}function u(t,e,i){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var o=[null];o.push.apply(o,e);var n=new(Function.bind.apply(t,o));return i&&l(n,i.prototype),n}).apply(null,arguments)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.r(e);var c=function(t){function e(t,i,o){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=a(this,h(e).call(this))).src=t,null!=i&&null!=o&&(n.width=i,n.height=o),n.coords=[],n.addEventListener("load",function(){n.loaded=!0}),n.color=new Uint8Array([255,255,255,255]),n._textureBlockLocation=null,n}var i,o,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,s(Image)),i=e,(o=[{key:"scale",value:function(t,e){this.width=width*t,this.height=height*e}},{key:"setCoords",value:function(t){this.coords=t}},{key:"setColorRGBA",value:function(t,e,i,o){this.color=new Uint8Array([t,e,i,o])}}])&&r(i.prototype,o),n&&r(i,n),e}();function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function m(t,e,i){return e&&b(t.prototype,e),i&&b(t,i),t}var v=function(){function t(){return f(this,t),this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return m(t,[{key:"perspective",value:function(t,e,i,o,n){var r=Math.tan(.5*Math.PI-.5*t),a=1/(o-n);return this.matrix=[r/(e/i),0,0,0,0,r,0,0,0,0,(o+n)*a,-1,0,0,o*n*a*2,0],this}},{key:"multiply",value:function(t){var e=this.matrix[0],i=this.matrix[1],o=this.matrix[2],n=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],w=this.matrix[15],p=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],G=t[6],_=t[7],R=t[8],T=t[9],A=t[10],E=t[11],k=t[12],P=t[13],F=t[14],B=t[15];this.matrix=[p*e+y*r+d*l+L*b,p*i+y*a+d*h+L*m,p*o+y*s+d*c+L*v,p*n+y*u+d*f+L*w,x*e+g*r+G*l+_*b,x*i+g*a+G*h+_*m,x*o+g*s+G*c+_*v,x*n+g*u+G*f+_*w,R*e+T*r+A*l+E*b,R*i+T*a+A*h+E*m,R*o+T*s+A*c+E*v,R*n+T*u+A*f+E*w,k*e+P*r+F*l+B*b,k*i+P*a+F*h+B*m,k*o+P*s+F*c+B*v,k*n+P*u+F*f+B*w]}},{key:"multiply_",value:function(t){var e=this.matrix[0],i=this.matrix[1],o=this.matrix[2],n=this.matrix[3],r=this.matrix[4],a=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],h=this.matrix[9],c=this.matrix[10],f=this.matrix[11],b=this.matrix[12],m=this.matrix[13],v=this.matrix[14],w=this.matrix[15],p=t[0],y=t[1],d=t[2],L=t[3],x=t[4],g=t[5],G=t[6],_=t[7],R=t[8],T=t[9],A=t[10],E=t[11],k=t[12],P=t[13],F=t[14],B=t[15];return[p*e+y*r+d*l+L*b,p*i+y*a+d*h+L*m,p*o+y*s+d*c+L*v,p*n+y*u+d*f+L*w,x*e+g*r+G*l+_*b,x*i+g*a+G*h+_*m,x*o+g*s+G*c+_*v,x*n+g*u+G*f+_*w,R*e+T*r+A*l+E*b,R*i+T*a+A*h+E*m,R*o+T*s+A*c+E*v,R*n+T*u+A*f+E*w,k*e+P*r+F*l+B*b,k*i+P*a+F*h+B*m,k*o+P*s+F*c+B*v,k*n+P*u+F*f+B*w]}},{key:"translate",value:function(t,e,i){this.multiply(w.translation(t,e,i))}},{key:"translate_",value:function(t,e,i){return this.multiply_(w.translation(t,e,i))}},{key:"rotateX",value:function(t){this.multiply(w.rotationX(t))}},{key:"rotateY",value:function(t){this.multiply(w.rotationY(t))}},{key:"rotateZ",value:function(t){this.multiply(w.rotationZ(t))}},{key:"scale",value:function(t,e,i){this.multiply(w.scaling(t,e,i))}}]),t}(),w=new(function(){function t(){f(this,t)}return m(t,[{key:"unit",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"translation",value:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}},{key:"rotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]}},{key:"rotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]}},{key:"rotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]}},{key:"scaling",value:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}},{key:"multiply",value:function(t,e){var i=t[0],o=t[1],n=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],w=t[14],p=t[15],y=e[0],d=e[1],L=e[2],x=e[3],g=e[4],G=e[5],_=e[6],R=e[7],T=e[8],A=e[9],E=e[10],k=e[11],P=e[12],F=e[13],B=e[14],U=e[15];return[y*i+d*a+L*h+x*m,y*o+d*s+L*c+x*v,y*n+d*u+L*f+x*w,y*r+d*l+L*b+x*p,g*i+G*a+_*h+R*m,g*o+G*s+_*c+R*v,g*n+G*u+_*f+R*w,g*r+G*l+_*b+R*p,T*i+A*a+E*h+k*m,T*o+A*s+E*c+k*v,T*n+A*u+E*f+k*w,T*r+A*l+E*b+k*p,P*i+F*a+B*h+U*m,P*o+F*s+B*c+U*v,P*n+F*u+B*f+U*w,P*r+F*l+B*b+U*p]}},{key:"vec3Multiply",value:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3]]}},{key:"transformVector",value:function(t,e){for(var i=new Float32Array(4),o=0;o<4;++o){i[o]=0;for(var n=0;n<4;++n)i[o]+=e[n]*t[4*n+o]}return i}},{key:"inverse",value:function(t){var e=new Float32Array(16),i=t[0],o=t[1],n=t[2],r=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=t[8],c=t[9],f=t[10],b=t[11],m=t[12],v=t[13],w=t[14],p=t[15],y=f*p,d=w*b,L=u*p,x=w*l,g=u*b,G=f*l,_=n*p,R=w*r,T=n*b,A=f*r,E=n*l,k=u*r,P=h*v,F=m*c,B=a*v,U=m*s,C=a*c,O=h*s,D=i*v,M=m*o,S=i*c,j=h*o,X=i*s,Y=a*o,I=y*s+x*c+g*v-(d*s+L*c+G*v),V=d*o+_*c+A*v-(y*o+R*c+T*v),N=L*o+R*s+E*v-(x*o+_*s+k*v),W=G*o+T*s+k*c-(g*o+A*s+E*c),z=1/(i*I+a*V+h*N+m*W);return e[0]=z*I,e[1]=z*V,e[2]=z*N,e[3]=z*W,e[4]=z*(d*a+L*h+G*m-(y*a+x*h+g*m)),e[5]=z*(y*i+R*h+T*m-(d*i+_*h+A*m)),e[6]=z*(x*i+_*a+k*m-(L*i+R*a+E*m)),e[7]=z*(g*i+A*a+E*h-(G*i+T*a+k*h)),e[8]=z*(P*l+U*b+C*p-(F*l+B*b+O*p)),e[9]=z*(F*r+D*b+j*p-(P*r+M*b+S*p)),e[10]=z*(B*r+M*l+X*p-(U*r+D*l+Y*p)),e[11]=z*(O*r+S*l+Y*b-(C*r+j*l+X*b)),e[12]=z*(B*f+O*w+F*u-(C*w+P*u+U*f)),e[13]=z*(S*w+P*n+M*f-(D*f+j*w+F*n)),e[14]=z*(D*u+Y*w+U*n-(X*w+B*n+M*u)),e[15]=z*(X*f+C*n+j*u-(S*u+Y*f+O*n)),e}}]),t}());function p(t){return t*Math.PI/180}function y(t){return 0==(t&t-1)}function d(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var L,x=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webGL=function(t){var e=t.getContext("experimental-webgl");return window.addEventListener("resize",function(){t.width=t.offsetWidth,t.height=t.offsetHeight}),e}(e),this.canvas=e,this.width=e.width,this.height=e.height,this.polygons=[],this.objects=[],this.textures=[],this.camera=null,this.debugger=null,this.controls=null,this.selectedObject=null,this._globalPossitionBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalPossitionBuffer),this._globalTextureBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._globalTextureBuffer),e.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight}),this.initShaders(),this.noTexture=new c,this.noTexture.setColorRGBA(219,58,52,255),this.bindTexture(this.noTexture)}var e,i,n;return e=t,(i=[{key:"initShaders",value:function(){var t,e,i,n,r,a=o("attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_normal;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_objectRotation;\r\nuniform vec3 u_lightWorldPosition;\r\nuniform mat4 u_cameraMatrix;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_surfaceToLight;\r\n\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * a_position;\r\n    \r\n    v_texcoord = a_texcoord;\r\n    v_normal = vec3(u_objectRotation * a_normal);\r\n\r\n    vec3 surfaceWorldPosition = (u_cameraMatrix * a_position).xyz;\r\n    \r\n    v_surfaceToLight = u_lightWorldPosition; // - surfaceWorldPosition;\r\n}","vertex",this.webGL),s=o("precision mediump float;\r\n\r\nvarying vec2 v_texcoord;\r\nvarying vec3 v_normal;\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec3 u_reverseLightDirection;\r\nvarying vec3 v_surfaceToLight;\r\n\r\nvoid main() {\r\n    vec3 normal = normalize(v_normal);\r\n    // float light = dot(normal, u_reverseLightDirection);\r\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n    float light = dot(v_normal, surfaceToLightDirection);\r\n    if (light < 0.5)\r\n        light = 0.5;\r\n    \r\n    gl_FragColor = texture2D(u_texture, v_texcoord);\r\n    gl_FragColor.rgb *= (light);\r\n    if(gl_FragColor.a < 0.2)\r\n        discard;\r\n}","fragment",this.webGL);this.shaderProgram=(t=this.webGL,e=a,i=s,n=!1,r=t.createProgram(),t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),t.useProgram(r),n&&(t.deleteShader(e),t.deleteShader(i)),r),this.positionLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_position"),this.texcoordLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_texcoord"),this.textureLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_texture"),this.matrixLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_matrix"),this.objectRotationLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_objectRotation"),this.normalLocation=this.webGL.getAttribLocation(this.shaderProgram,"a_normal"),this.everseLightDirectionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_reverseLightDirection"),this.lightWorldPositionLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_lightWorldPosition"),this.cameraLocation=this.webGL.getUniformLocation(this.shaderProgram,"u_cameraMatrix"),this.webGL.useProgram(this.shaderProgram),this.webGL.viewport(0,0,this.width,this.height),this.webGL.enable(this.webGL.CULL_FACE),this.webGL.enable(this.webGL.DEPTH_TEST)}},{key:"setCamera",value:function(t){this.camera=t}},{key:"bindTexture",value:function(t){var e=this;t._textureBlockLocation=this.textures.length,this.textures.push(t),t._WebGLtexture=this.webGL.createTexture(),this.webGL.activeTexture(this.webGL.TEXTURE0+t._textureBlockLocation),this.webGL.bindTexture(this.webGL.TEXTURE_2D,t._WebGLtexture),t.loaded?(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t),this.webGL.generateMipmap(this.webGL.TEXTURE_2D),y(image.width)&&y(image.height)?this.webGL.generateMipmap(this.webGL.TEXTURE_2D):(this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_S,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_WRAP_T,this.webGL.CLAMP_TO_EDGE),this.webGL.texParameteri(this.webGL.TEXTURE_2D,this.webGL.TEXTURE_MIN_FILTER,this.webGL.LINEAR))):(this.webGL.texImage2D(this.webGL.TEXTURE_2D,0,this.webGL.RGBA,1,1,0,this.webGL.RGBA,this.webGL.UNSIGNED_BYTE,t.color),t.addEventListener("load",function(){e.webGL.activeTexture(e.webGL.TEXTURE0+t._textureBlockLocation),e.webGL.texImage2D(e.webGL.TEXTURE_2D,0,e.webGL.RGBA,e.webGL.RGBA,e.webGL.UNSIGNED_BYTE,t),y(t.width)&&y(t.height)?e.webGL.generateMipmap(e.webGL.TEXTURE_2D):(e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_S,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_WRAP_T,e.webGL.CLAMP_TO_EDGE),e.webGL.texParameteri(e.webGL.TEXTURE_2D,e.webGL.TEXTURE_MIN_FILTER,e.webGL.LINEAR))}))}},{key:"update",value:function(){var t,e,i,o,n=this;null!=this.camera._controlFunction&&this.camera._controlFunction(),this.selectedObject=null,this.polygons.forEach(function(r){(t=new v).perspective(n.camera.fieldOfViewRad,n.width,n.height,1,2e4),t.multiply(n.camera.inserved),(o=new v).multiply(w.inverse(w.translation(r.rotationPoint[0],r.rotationPoint[1],r.rotationPoint[2]))),o.translate(r.position[0],r.position[1],r.position[2]),e=w.multiply(w.rotationX(r.rotation[0]),w.rotationY(r.rotation[1])),e=w.multiply(e,w.rotationZ(r.rotation[2])),null!=r.parentRotation&&(i=w.multiply(w.rotationX(r.parentRotation[0]),w.rotationY(r.parentRotation[1])),i=w.multiply(i,w.rotationZ(r.parentRotation[2])),r._world=i,e=w.multiply(i,e)),o.multiply(e),o.translate(r.rotationPoint[0],r.rotationPoint[1],r.rotationPoint[2]),o.scale(1,1,1),t.multiply(o.matrix),r._matrix=t.matrix,r._rotataionMatrix=e}),this.objects.forEach(function(r){(t=new v).perspective(n.camera.fieldOfViewRad,n.width,n.height,1,2e4),t.multiply(n.camera.inserved),(o=new v).multiply(w.inverse(w.translation(r.rotationPoint[0],r.rotationPoint[1],r.rotationPoint[2]))),o.translate(r.position[0],r.position[1],r.position[2]),e=w.multiply(w.rotationX(r.rotation[0]),w.rotationY(r.rotation[1])),e=w.multiply(e,w.rotationZ(r.rotation[2])),i=w.multiply(w.rotationX(r.parentRotation[0]),w.rotationY(r.parentRotation[1])),i=w.multiply(i,w.rotationZ(r.parentRotation[2])),r._world=i,e=w.multiply(i,e),o.multiply(e),o.translate(r.rotationPoint[0],r.rotationPoint[1],r.rotationPoint[2]),o.scale(r.scaling[0],r.scaling[1],r.scaling[2]),t.multiply(o.matrix);var a=!1;r.collisionBoxes.forEach(function(e){for(var i=[],o=0;o<e.x.length;o++)for(var s=e.x[o],u=0;u<e.y.length;u++)for(var l=e.y[u],h=0;h<e.z.length;h++){var c=e.z[h],f=w.transformVector(t.matrix,[s,l,c,1]);f[0]=f[0]/f[3],f[1]=f[1]/f[3],f[0]=(.5*f[0]+.5)*n.width,f[1]=(-.5*f[1]+.5)*n.height,f[0]>-n.width&&f[0]<n.width&&f[1]>-n.height&&f[1]<n.height&&i.push({x:f[0],y:f[1]})}for(var b=[1e4,1e4],m=[-1e4,-1e4],v=0;v<i.length;v++){var p=i[v];p.x<b[0]?b[0]=p.x:p.x>m[0]&&(m[0]=p.x),p.y<b[1]?b[1]=p.y:p.y>m[1]&&(m[1]=p.y)}n.controls.mouse.x>b[0]&&n.controls.mouse.x<m[0]&&n.controls.mouse.y>b[1]&&n.controls.mouse.y<m[1]&&(a=!0);var y=n.controls.mouse;a&&(n.selectedObject=r,n.debugger.logArray[2].output=function(){return"Hitbox x "+y.x+" > "+b[0]+" && "+y.x+" < "+m[0]},n.debugger.logArray[3].output=function(){return"Hitbox y "+y.y+" > "+b[1]+" && "+y.y+" < "+m[1]})});var s=n.selectedObject;n.debugger.logArray[4].output=null!=s?function(){return"Mouse over "+s.name}:function(){return"There are no objects over mouse"},r._matrix=t.matrix,r._rotataionMatrix=e})}},{key:"draw",value:function(){var t,e,i,o=this;this.webGL.clear(this.webGL.COLOR_BUFFER_BIT|this.webGL.DEPTH_BUFFER_BIT),this.webGL.uniform3fv(this.everseLightDirectionLocation,(t=[-.1,.5,1],e=new Float32Array(3),(i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))>1e-5&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i,e))),this.webGL.uniform3fv(this.lightWorldPositionLocation,[0,100,400]),this.webGL.uniformMatrix4fv(this.cameraLocation,!1,this.camera.matrix),this.polygons.forEach(function(t){o.webGL.enableVertexAttribArray(o.positionLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._vertexesBuffer),o.webGL.vertexAttribPointer(o.positionLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.texcoordLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._coordsBuffer),o.webGL.vertexAttribPointer(o.texcoordLocation,2,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.normalLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,t._normalBuffer),o.webGL.vertexAttribPointer(o.normalLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.uniform1i(o.textureLocation,t.texture._textureBlockLocation),o.webGL.uniformMatrix4fv(o.matrixLocation,!1,t._matrix),o.webGL.uniformMatrix4fv(o.objectRotationLocation,!1,t._world),o.webGL.drawArrays(o.webGL.TRIANGLES,0,3)}),this.objects.forEach(function(t){t.faces.forEach(function(e){o.webGL.enableVertexAttribArray(o.positionLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,e.vertexesBuffer),o.webGL.vertexAttribPointer(o.positionLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.texcoordLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,e.coordsBuffer),o.webGL.vertexAttribPointer(o.texcoordLocation,2,o.webGL.FLOAT,!1,0,0),o.webGL.enableVertexAttribArray(o.normalLocation),o.webGL.bindBuffer(o.webGL.ARRAY_BUFFER,e.normalBuffer),o.webGL.vertexAttribPointer(o.normalLocation,3,o.webGL.FLOAT,!1,0,0),o.webGL.uniform1i(o.textureLocation,t.texture._textureBlockLocation),o.webGL.uniformMatrix4fv(o.matrixLocation,!1,t._matrix),o.webGL.uniformMatrix4fv(o.objectRotationLocation,!1,t._world),o.webGL.drawArrays(o.webGL.TRIANGLES,0,e.vertexes.length/e.vertexesCount)})}),null!=this.debugger&&this.debugger.updateInfo()}},{key:"render",value:function(){this.update(),this.draw()}},{key:"run",value:function(){L=this,g()}}])&&d(e.prototype,i),n&&d(e,n),t}();function g(){requestAnimationFrame(g),L.render()}function G(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var o=(new Date).getTime(),n=Math.max(0,16-(o-t)),r=window.setTimeout(function(){e(o+n)},n);return t=o+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=[0,0,100],this.up=[0,1,0],this.target=[0,0,0],this.fieldOfView=90,this.fieldOfViewRad=p(90),this.matrix=w.unit(),this.position=[0,0,0],this.rotation=[0,0,0],this._collisions=!1,this._lookUpMatrix=null}var e,i,o;return e=t,(i=[{key:"setFieldOfView",value:function(t){this.fieldOfView=t,this.fieldOfViewRad=p(t)}},{key:"setCollisions",value:function(t){this._collisions=t}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.computeMatrix()}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i,this.computeMatrix()}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i,this.computeMatrix()}},{key:"setRotation",value:function(t,e,i){this.rotation=[t,e,i],this.computeMatrix()}},{key:"computeMatrix",value:function(){this.matrix=w.unit(),this.matrix=w.multiply(this.matrix,w.translation(this.position[0],this.position[1],this.position[2]));var t=new v;t.multiply(w.rotationY(p(this.rotation[1]))),t.multiply(w.rotationX(p(this.rotation[0]))),t.multiply(w.rotationZ(p(this.rotation[2]))),this.matrix=w.multiply(this.matrix,t.matrix),null!=this._lookUpMatrix&&(this.matrix=w.multiply(this.matrix,this.lookAt(camera._lookUpMatrix,[0,1,0]))),this.rotationMatrix=w.inverse(t.matrix),this.inserved=w.inverse(this.matrix)}},{key:"setControl",value:function(t){this._controlFunction=t}},{key:"setLookUp",value:function(t,e,i){this._lookUpMatrix=null!=t?[t,e,i]:null}},{key:"lookAt",value:function(t,e){if(null!=t){var i=normalize(subVec3(this.position,t)),o=normalize(cross(e,i)),n=normalize(cross(i,o));return[o[0],o[1],o[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,this.position[0],this.position[1],this.position[2],1]}return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]}}])&&G(e.prototype,i),o&&G(e,o),t}();function R(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var T=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.controls=this,this.keys=[],this._handlers=[],this._mouseHandlers=[null,null,null,null,null,null],this.mouse={x:0,y:0,buttons:[!1,!1,!1]};for(var i=this,o=0;o<255;o++)this.keys[o]=!1,this._handlers[o]=null;window.onkeydown=function(t){return i.keys[t.keyCode]=!0,null!=i._handlers[t.keyCode]&&i._handlers[t.keyCode](),!1},window.onkeyup=function(t){return i.keys[t.keyCode]=!1,!1},e.canvas.addEventListener("mousemove",function(t){var o=e.canvas.getBoundingClientRect(),n=t.clientX-o.left,r=t.clientY-o.top;i.mouse.x=n,i.mouse.y=r},!1),window.onmousedown=function(t){return i.mouse.buttons[t.button]=!0,null!=i._mouseHandlers[2+t.button]&&i._mouseHandlers[2+t.button](),!1},window.onmouseup=function(t){return i.mouse.buttons[t.button]=!1,!1}}var e,i,o;return e=t,(i=[{key:"onKeyDown",value:function(t,e){this._handlers[t]=e}},{key:"onMouseDown",value:function(t,e){this._mouseHandlers[2+t]=e}},{key:"onMouseMove",value:function(t){engine.canvas.addEventListener("mousemove",t,!1)}}])&&R(e.prototype,i),o&&R(e,o),t}();function A(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var E=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.debugger=this,this.logArray=[],this.element=null}var e,i,o;return e=t,(i=[{key:"setElemenent",value:function(t){this.element=t}},{key:"addLog",value:function(t,e,i,o,n){n=n||this.defaultOutput,this.logArray.push({name:t,object:e,value:i,view:o,output:n}),this.addView(o)}},{key:"createLogView",value:function(){return document.createElement("p")}},{key:"defaultOutput",value:function(t){return t.name+" : "+t.object[t.value]}},{key:"addView",value:function(t){this.element.appendChild(t)}},{key:"updateInfo",value:function(){this.logArray.forEach(function(t){t.view.innerText=t.output(t)})}}])&&A(e.prototype,i),o&&A(e,o),t}();function k(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var P=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&e.polygons.push(this),this.webGL=e.webGL,this.points=[],this.texture=null,this.vertexes=[],this.position=[0,0,0],this.rotation=[0,0,0],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.normals=[0,1,0,0,1,0,0,1,0],this._vertexesBuffer=null}var e,i,o;return e=t,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setTextureCoords",value:function(t){this.textureCoords=t,this._coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.textureCoords),this.webGL.STATIC_DRAW)}},{key:"setVertexes",value:function(t){this.vertexes=t,this._vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.vertexes),this.webGL.STATIC_DRAW)}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"update",value:function(){}},{key:"setNormals",value:function(t){this.normals=t,this._normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,this._normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(this.normals),this.webGL.STATIC_DRAW)}}])&&k(e.prototype,i),o&&k(e,o),t}();function F(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var B=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.polygons=new Array(2),this.position=[0,0,0],this.rotationPoint=[0,0,0];var i=new P(e);i.setVertexes([0,0,0,100,100,0,0,100,0]),i.setTextureCoords([0,1,1,0,0,0]),this.polygons[0]=i,(i=new P(e)).setVertexes([100,100,0,0,0,0,100,0,0]),i.setTextureCoords([1,0,0,1,1,1]),this.polygons[1]=i,this.setNormals([0,0,1,0,0,1,0,0,1])}var e,i,o;return e=t,(i=[{key:"setTexture",value:function(t){this.polygons[0].setTexture(t),this.polygons[1].setTexture(t)}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.polygons[0].setVertexes([0,0,0,t,e,0,0,e,0]),this.polygons[1].setVertexes([t,e,0,0,0,0,t,0,0])}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.polygons[0].setPosition(t,e,i),this.polygons[1].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){var o=p(t),n=p(e),r=p(i);this.polygons[0].rotate(o,n,r),this.polygons[1].rotate(o,n,r)}},{key:"setParentRotation",value:function(t,e,i){this.polygons[0].setParentRotation(t,e,i),this.polygons[1].setParentRotation(t,e,i)}},{key:"setRotationPoint",value:function(t,e,i){this.polygons[0].setRotationPoint(t,e,i),this.polygons[1].setRotationPoint(t,e,i)}},{key:"setNormals",value:function(t){this.polygons[0].setNormals(t),this.polygons[1].setNormals(t)}}])&&F(e.prototype,i),o&&F(e,o),t}();function U(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var C=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.faces=[new B(e),new B(e),new B(e),new B(e),new B(e),new B(e)],this.position=[0,0,0],this.rotation=[0,0,0],this.faces[0].rotate(0,0,0),this.faces[0].setRotationPoint(-100,-100,100),this.faces[0].setPosition(0,0,0),this.faces[0].setNormals([0,0,1,0,0,1,0,0,1]),this.faces[1].rotate(0,90,0),this.faces[1].setRotationPoint(-100,-100,100),this.faces[1].position=[0,0,0],this.faces[1].setNormals([1,0,0,1,0,0,1,0,0]),this.faces[2].rotate(0,-180,0),this.faces[2].setRotationPoint(-100,-100,100),this.faces[2].position=[0,0,0],this.faces[2].setNormals([0,0,-1,0,0,-1,0,0,-1]),this.faces[3].rotate(0,270,0),this.faces[3].setRotationPoint(-100,-100,100),this.faces[3].position=[0,0,0],this.faces[3].setNormals([-1,0,0,-1,0,0,-1,0,0]),this.faces[4].rotate(-90,0,0),this.faces[4].setRotationPoint(-100,-100,100),this.faces[4].position=[0,0,0],this.faces[4].setNormals([0,1,0,0,1,0,0,1,0]),this.faces[5].rotate(90,0,0),this.faces[5].setRotationPoint(-100,-100,100),this.faces[5].position=[0,0,0],this.faces[5].setNormals([0,-1,0,0,-1,0,0,-1,0])}var e,i,o;return e=t,(i=[{key:"_updateFaces",value:function(){this.faces[0].setPosition(this.position[0],this.position[1],this.position[2])}},{key:"setTexture",value:function(t,e,i,o,n,r){this.faces[0].setTexture(t),this.faces[1].setTexture(e),this.faces[2].setTexture(i),this.faces[3].setTexture(o),this.faces[4].setTexture(n),this.faces[5].setTexture(r)}},{key:"setSize",value:function(t,e,i){this.width=t,this.height=e,this.depth=i,this.faces.forEach(function(o){o.setSize(t,e),o.setRotationPoint(-t/2,-e/2,i/2)})}},{key:"setPosition",value:function(t,e,i){this.position=[t,e,i],this.faces[0].setPosition(t,e,i),this.faces[1].setPosition(t,e,i),this.faces[2].setPosition(t,e,i),this.faces[3].setPosition(t,e,i),this.faces[4].setPosition(t,e,i),this.faces[5].setPosition(t,e,i)}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i;var o=p(this.rotation[0]),n=p(this.rotation[1]),r=p(this.rotation[2]);this.faces.forEach(function(t){t.setParentRotation(o,n,r)})}},{key:"setRotation",value:function(t,e,i){var o=p(t),n=p(e),r=p(i);this.faces.forEach(function(t){t.setParentRotation(o,n,r)})}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}}])&&U(e.prototype,i),o&&U(e,o),t}();function O(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var D=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e.objects.push(this),this.webGL=e.webGL,this.texture=e.noTexture,this.position=[0,0,0],this.rotation=[0,0,0],this.scaling=[1,1,1],this.rotationPoint=[0,0,0],this.parentRotation=[0,0,0],this.faces=[],this.collisionBoxes=[]}var e,i,o;return e=t,(i=[{key:"setTexture",value:function(t){this.texture=t}},{key:"setPosition",value:function(t,e,i){this.position[0]=t,this.position[1]=e,this.position[2]=i}},{key:"move",value:function(t,e,i){this.position[0]+=t,this.position[1]+=e,this.position[2]+=i}},{key:"rotate",value:function(t,e,i){this.rotation[0]+=t,this.rotation[1]+=e,this.rotation[2]+=i}},{key:"setRotation",value:function(t,e,i){this.rotation[0]=t,this.rotation[1]=e,this.rotation[2]=i}},{key:"setRotationPoint",value:function(t,e,i){this.rotationPoint=[t,e,i]}},{key:"setParentRotation",value:function(t,e,i){this.parentRotation=[t,e,i]}},{key:"scale",value:function(t,e,i){this.scaling=[t,e,i]}},{key:"animation",value:function(){this.rotate(0,0,0)}},{key:"animate",value:function(t,e){e=e||this.animation,setInterval(e,1e3/t)}},{key:"compile",value:function(t){var e=this,i=[],o=[],n=[],r=t.split("\n"),a={x:[0,0],y:[0,0],z:[0,0]};r.forEach(function(t){for(var r=t.split(" "),s=r.length;s--;)""!=r[s]&&"\r"!=r[s]||r.splice(s,1);if("v"==r[0]){var u=parseFloat(r[1]),l=parseFloat(r[2]),h=parseFloat(r[3]);a.x[1]<u&&(a.x[1]=u),a.y[1]<l&&(a.y[1]=l),a.z[1]<h&&(a.z[1]=h),a.x[0]>u&&(a.x[0]=u),a.y[0]>l&&(a.y[0]=l),a.z[0]>h&&(a.z[0]=h),i.push([u,l,h])}else if("vn"==r[0])n.push([parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])]);else if("vt"==r[0])o.push([parseFloat(r[1]),parseFloat(r[2])]);else if("f"==r[0])for(var c=function(t){var a=r[t].split("/");if("\r"==a[length-1])return"break";for(var s=null,u=null,l=void 0,h=0;h<e.faces.length;h++){var c=e.faces[h];c.vertexesCount==r.length-1&&(s=c.vertexes,u=c.textureCoords,l=c.normals)}null==s&&(e.faces.push({vertexesCount:r.length-1,vertexes:[],textureCoords:[],normals:[]}),s=e.faces[e.faces.length-1].vertexes,u=e.faces[e.faces.length-1].textureCoords,l=e.faces[e.faces.length-1].normals);var f=parseFloat(a[0]);f<0&&(f=i.length+f+1);var b=parseFloat(a[1]);b<0&&(b=o.length+b+1);var m=parseFloat(a[2]);m<0&&(m=n.length+m+1),i[f-1].forEach(function(t){s.push(t)}),o.length>0&&o[b-1].forEach(function(t){u.push(t)}),null!=a[2]?n[m-1].forEach(function(t){l.push(t)}):l.push(0,0,0)},f=1;f<r.length;f++){if("break"===c(f))break}});for(var s=0;s<this.faces.length;s++){var u=this.faces[s];u.vertexesBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,u.vertexesBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(u.vertexes),this.webGL.STATIC_DRAW),u.coordsBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,u.coordsBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(u.textureCoords),this.webGL.STATIC_DRAW),u.normalBuffer=this.webGL.createBuffer(),this.webGL.bindBuffer(this.webGL.ARRAY_BUFFER,u.normalBuffer),this.webGL.bufferData(this.webGL.ARRAY_BUFFER,new Float32Array(u.normals),this.webGL.STATIC_DRAW)}this.collisionBoxes.push(a)}},{key:"loadFromObj",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4==i.readyState&&e.compile(i.responseText)},i.send()}}])&&O(e.prototype,i),o&&O(e,o),t}();i.d(e,"Engine",function(){return x}),i.d(e,"Camera",function(){return _}),i.d(e,"Controls",function(){return T}),i.d(e,"Debugger",function(){return E}),i.d(e,"Texture",function(){return c}),i.d(e,"Rect",function(){return B}),i.d(e,"Cube",function(){return C}),i.d(e,"Object",function(){return D})}])});